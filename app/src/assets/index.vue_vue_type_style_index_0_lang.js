import{c as N,j as le,a as Q,b as te,aa as ce,ab as ke,d as ae,u as ve,by as Ce,n as he,A as ze,h as k,cv as De,B as Re,cw as Ne,E as Te,bq as Ee,l as K,a2 as P,q as Fe,a6 as de,af as pe,x as ue,ag as Be,N as me,cx as Oe,bb as ge,aS as Me,bI as _e,b9 as be,r as x,b3 as Pe,o as ye,y as Le,C as xe,k as se,an as V,aq as oe,ar as B,ap as f,aw as I,as as q,ax as W,au as j,ao as re,bN as fe,a7 as ee,aB as we,bM as je,cy as Ue,a$ as Se,aF as qe,bO as Ve,b4 as Ke,cz as Ae,bR as ne,az as He,aA as We}from"./index.js";import{S as Ge}from"./ShoppingOutlined.js";import{N as Qe}from"./Icon.js";import{_ as Ye}from"./Input.js";import{N as Ie}from"./DataTable.js";import{l as Je}from"./lodash.js";import{I as Xe}from"./inventory-loading.js";import{g as Ze}from"./get-slot.js";import{F as et,e as tt}from"./Dropdown.js";import{_ as nt}from"./Divider.js";import{_ as st}from"./Space.js";import{_ as ot,N as rt}from"./Tabs.js";const at=N("steps",`
 width: 100%;
 display: flex;
`,[N("step",`
 position: relative;
 display: flex;
 flex: 1;
 `,[le("disabled","cursor: not-allowed"),le("clickable",`
 cursor: pointer;
 `),Q("&:last-child",[N("step-splitor","display: none;")])]),N("step-splitor",`
 background-color: var(--n-splitor-color);
 margin-top: calc(var(--n-step-header-font-size) / 2);
 height: 1px;
 flex: 1;
 align-self: flex-start;
 margin-left: 12px;
 margin-right: 12px;
 transition:
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 `),N("step-content","flex: 1;",[N("step-content-header",`
 color: var(--n-header-text-color);
 margin-top: calc(var(--n-indicator-size) / 2 - var(--n-step-header-font-size) / 2);
 line-height: var(--n-step-header-font-size);
 font-size: var(--n-step-header-font-size);
 position: relative;
 display: flex;
 font-weight: var(--n-step-header-font-weight);
 margin-left: 9px;
 transition:
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 `,[te("title",`
 white-space: nowrap;
 flex: 0;
 `)]),te("description",`
 color: var(--n-description-text-color);
 margin-top: 12px;
 margin-left: 9px;
 transition:
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 `)]),N("step-indicator",`
 background-color: var(--n-indicator-color);
 box-shadow: 0 0 0 1px var(--n-indicator-border-color);
 height: var(--n-indicator-size);
 width: var(--n-indicator-size);
 border-radius: 50%;
 display: flex;
 align-items: center;
 justify-content: center;
 transition:
 background-color .3s var(--n-bezier),
 box-shadow .3s var(--n-bezier);
 `,[N("step-indicator-slot",`
 position: relative;
 width: var(--n-indicator-icon-size);
 height: var(--n-indicator-icon-size);
 font-size: var(--n-indicator-icon-size);
 line-height: var(--n-indicator-icon-size);
 `,[te("index",`
 display: inline-block;
 text-align: center;
 position: absolute;
 left: 0;
 top: 0;
 white-space: nowrap;
 font-size: var(--n-indicator-index-font-size);
 width: var(--n-indicator-icon-size);
 height: var(--n-indicator-icon-size);
 line-height: var(--n-indicator-icon-size);
 color: var(--n-indicator-text-color);
 transition: color .3s var(--n-bezier);
 `,[ce()]),N("icon",`
 color: var(--n-indicator-text-color);
 transition: color .3s var(--n-bezier);
 `,[ce()]),N("base-icon",`
 color: var(--n-indicator-text-color);
 transition: color .3s var(--n-bezier);
 `,[ce()])])]),le("vertical","flex-direction: column;",[ke("show-description",[Q(">",[N("step","padding-bottom: 8px;")])]),Q(">",[N("step","margin-bottom: 16px;",[Q("&:last-child","margin-bottom: 0;"),Q(">",[N("step-indicator",[Q(">",[N("step-splitor",`
 position: absolute;
 bottom: -8px;
 width: 1px;
 margin: 0 !important;
 left: calc(var(--n-indicator-size) / 2);
 height: calc(100% - var(--n-indicator-size));
 `)])]),N("step-content",[te("description","margin-top: 8px;")])])])])])]);function it(n,m){return typeof n!="object"||n===null||Array.isArray(n)?null:(n.props||(n.props={}),n.props.internalIndex=m+1,n)}function lt(n){return n.map((m,w)=>it(m,w))}const ct=Object.assign(Object.assign({},he.props),{current:Number,status:{type:String,default:"process"},size:{type:String,default:"medium"},vertical:Boolean,"onUpdate:current":[Function,Array],onUpdateCurrent:[Function,Array]}),$e=Re("n-steps"),ut=ae({name:"Steps",props:ct,setup(n,{slots:m}){const{mergedClsPrefixRef:w,mergedRtlRef:s}=ve(n),T=Ce("Steps",s,w),E=he("Steps","-steps",at,Ne,n,w);return ze($e,{props:n,mergedThemeRef:E,mergedClsPrefixRef:w,stepsSlots:m}),{mergedClsPrefix:w,rtlEnabled:T}},render(){const{mergedClsPrefix:n}=this;return k("div",{class:[`${n}-steps`,this.rtlEnabled&&`${n}-steps--rtl`,this.vertical&&`${n}-steps--vertical`]},lt(De(Ze(this))))}}),dt={status:String,title:String,description:String,disabled:Boolean,internalIndex:{type:Number,default:0}},pt=ae({name:"Step",props:dt,setup(n){const m=Te($e,null);m||Ee("step","`n-step` must be placed inside `n-steps`.");const{inlineThemeDisabled:w}=ve(),{props:s,mergedThemeRef:T,mergedClsPrefixRef:E,stepsSlots:a}=m,$=K(()=>s.vertical),L=K(()=>{const{status:h}=n;if(h)return h;{const{internalIndex:g}=n,{current:z}=s;if(z===void 0)return"process";if(g<z)return"finish";if(g===z)return s.status||"process";if(g>z)return"wait"}return"process"}),R=K(()=>{const{value:h}=L,{size:g}=s,{common:{cubicBezierEaseInOut:z},self:{stepHeaderFontWeight:A,[P("stepHeaderFontSize",g)]:O,[P("indicatorIndexFontSize",g)]:_,[P("indicatorSize",g)]:F,[P("indicatorIconSize",g)]:H,[P("indicatorTextColor",h)]:Y,[P("indicatorBorderColor",h)]:J,[P("headerTextColor",h)]:X,[P("splitorColor",h)]:M,[P("indicatorColor",h)]:G,[P("descriptionTextColor",h)]:Z}}=T.value;return{"--n-bezier":z,"--n-description-text-color":Z,"--n-header-text-color":X,"--n-indicator-border-color":J,"--n-indicator-color":G,"--n-indicator-icon-size":H,"--n-indicator-index-font-size":_,"--n-indicator-size":F,"--n-indicator-text-color":Y,"--n-splitor-color":M,"--n-step-header-font-size":O,"--n-step-header-font-weight":A}}),v=w?Fe("step",K(()=>{const{value:h}=L,{size:g}=s;return`${h[0]}${g[0]}`}),R,s):void 0,C=K(()=>{if(n.disabled)return;const{onUpdateCurrent:h,"onUpdate:current":g}=s;return h||g?()=>{h&&de(h,n.internalIndex),g&&de(g,n.internalIndex)}:void 0});return{stepsSlots:a,mergedClsPrefix:E,vertical:$,mergedStatus:L,handleStepClick:C,cssVars:w?void 0:R,themeClass:v==null?void 0:v.themeClass,onRender:v==null?void 0:v.onRender}},render(){const{mergedClsPrefix:n,onRender:m,handleStepClick:w,disabled:s}=this,T=pe(this.$slots.default,E=>{const a=E||this.description;return a?k("div",{class:`${n}-step-content__description`},a):null});return m==null||m(),k("div",{class:[`${n}-step`,s&&`${n}-step--disabled`,!s&&w&&`${n}-step--clickable`,this.themeClass,T&&`${n}-step--show-description`,`${n}-step--${this.mergedStatus}-status`],style:this.cssVars,onClick:w},k("div",{class:`${n}-step-indicator`},k("div",{class:`${n}-step-indicator-slot`},k(Be,null,{default:()=>pe(this.$slots.icon,E=>{const{mergedStatus:a,stepsSlots:$}=this;return a==="finish"||a==="error"?a==="finish"?k(me,{clsPrefix:n,key:"finish"},{default:()=>ue($["finish-icon"],()=>[k(et,null)])}):a==="error"?k(me,{clsPrefix:n,key:"error"},{default:()=>ue($["error-icon"],()=>[k(Oe,null)])}):null:E||k("div",{key:this.internalIndex,class:`${n}-step-indicator-slot__index`},this.internalIndex)})})),this.vertical?k("div",{class:`${n}-step-splitor`}):null),k("div",{class:`${n}-step-content`},k("div",{class:`${n}-step-content-header`},k("div",{class:`${n}-step-content-header__title`},ue(this.$slots.title,()=>[this.title])),this.vertical?null:k("div",{class:`${n}-step-splitor`})),T))}}),mt={class:"flex justify-between items-center w-full"},ft={class:"flex items-center"},vt=f("h2",{class:"text-xl font-bold"},"有单退库详情",-1),ht={class:"grid grid-cols-2 gap-4 mb-4"},gt=f("strong",null,"退库人:",-1),_t=f("strong",null,"退库单号:",-1),bt={class:"grid grid-cols-1 gap-4 mt-4 mb-4"},yt=f("strong",null,"退库时间:",-1),xt={key:0,class:"mb-4"},wt={class:"flex items-center gap-4"},St=f("span",{class:"mr-2"},"扫码输入:",-1),It=f("div",{class:"text-sm text-gray-500 mt-1"},"提示：扫描条码后按回车键或点击添加按钮，只能扫描当前退库单中的耗材",-1),$t={class:"flex justify-end mt-4 space-x-3"},kt=f("div",{class:"flex justify-end mt-2"},[f("div",{class:"text-sm text-gray-500"},"点击【确认退库】按钮，确认退库信息无误后提交。")],-1),Ct=ae({__name:"dialog",props:{visible:{type:Boolean},rowData:{},warehouseName:{},formData:{},mqttData:{}},emits:["update:visible","submit","cancel","confirm","refresh"],setup(n,{emit:m}){const w=n,s=ge(),T=Me(),E=_e(),a=be(),$=K(()=>{var e;return(e=T.userInfo)==null?void 0:e.userId}),L=K(()=>{var e;return(e=T.userInfo)==null?void 0:e.userName}),R=x(!1),v=x(""),C=x(),h=x(""),g=x(!1),z=x([]),{visible:A,rowData:O}=Pe(w),_=x({items:[]}),F=()=>{var e,t;R.value=((e=a.systemSettings)==null?void 0:e.inventoryCountingMethod)==="scanner",console.log("有单退库 - 当前盘点方式:",(t=a.systemSettings)==null?void 0:t.inventoryCountingMethod,"扫码模式:",R.value)},H=e=>{g.value||(e.key==="Enter"?h.value.length>0&&(v.value=h.value,M(),h.value=""):e.key.length===1&&(h.value+=e.key))},Y=()=>{g.value=!0,C.value&&(C.value.readOnly=!1,C.value.focus({preventScroll:!0}))},J=()=>{g.value=!1,C.value&&(C.value.readOnly=!0,C.value.blur())},X=()=>{C.value&&(C.value.readOnly=!0)},M=async()=>{if(!v.value){s.error("请输入院内码或条形码");return}const e=v.value;if(v.value="",z.value.includes(e)){s.warning("该条码已经扫描过了");return}try{const{data:t}=await je({dataList:[e]});if(t){const{takeList:o,errorData:c,notInStockData:u,returnList:y}=t;if(o&&o.length>0){const S=o.filter(i=>{var d,p;return(p=(d=O.value)==null?void 0:d.items)==null?void 0:p.find(U=>U.rfid===i.rfid||U.code===i.code)}),b=o.filter(i=>{var d,p;return!((p=(d=O.value)==null?void 0:d.items)==null?void 0:p.find(U=>U.rfid===i.rfid||U.code===i.code))});if(b.length>0&&s.warning(`扫描到${b.length}个耗材不在当前退库单中，已忽略`,{duration:2e3}),S.length>0){const i=S.map(D=>{var d;return{...D,cabinet:{name:((d=E.getDeviceById(D.cabinetID))==null?void 0:d.name)||"未知货柜"},number:1}}).filter(D=>!_.value.items.some(d=>d.rfid===D.rfid));i.length>0?(_.value.items.push(...i),z.value.push(e),s.success(`成功添加 ${i.length} 个耗材`)):s.warning("该耗材已存在于列表中")}else b.length===0&&s.warning("扫描的耗材不在当前退库单中")}c&&c.length>0&&s.warning(`发现 ${c.length} 个异常耗材`),u&&u.length>0&&s.warning(`发现 ${u.length} 个未入库耗材`),y&&y.length>0&&s.warning(`发现 ${y.length} 个已退库耗材`),(!o||o.length===0)&&(!y||y.length===0)&&(!c||c.length===0)&&(!u||u.length===0)&&s.error("未找到对应的耗材信息")}}catch(t){console.error("扫码查询失败:",t),s.error("扫码查询失败，请重试")}finally{C.value&&C.value.focus()}},G=()=>{var c;const e=[],t={quantityErrors:[],codeErrors:[],cabinetErrors:[],missingItems:[]},o=((c=O.value)==null?void 0:c.items)||[];return _.value.items.length!==o.length&&e.push(`数据数量不一致：对话框中有${_.value.items.length}条记录，父组件中有${o.length}条记录`),_.value.items.forEach((u,y)=>{var b,i,D,d;const S=o.find(p=>p.rfid===u.rfid)||o.find(p=>p.code===u.code);if(!S){const p=`第${y+1}行：耗材"${u.name}"(编码:${u.code})在退库单中不存在`;e.push(p),t.missingItems.push(p);return}if(((b=u.cabinet)==null?void 0:b.name)!==((i=S.cabinet)==null?void 0:i.name)){const p=`第${y+1}行：退库货柜不一致，期望"${(D=S.cabinet)==null?void 0:D.name}"，实际"${(d=u.cabinet)==null?void 0:d.name}"`;e.push(p),t.cabinetErrors.push(p)}if(u.code!==S.code){const p=`第${y+1}行：耗材子编码不一致，期望"${S.code}"，实际"${u.code}"`;e.push(p),t.codeErrors.push(p)}if(u.number!==S.number){const p=`第${y+1}行：退库数量不一致，期望${S.number}，实际${u.number}`;e.push(p),t.quantityErrors.push(p)}}),o.forEach((u,y)=>{if(!_.value.items.find(b=>b.rfid===u.rfid||b.code===u.code)){const b=`退库单第${y+1}行：耗材"${u.name}"(编码:${u.code})未被扫描到`;e.push(b),t.missingItems.push(b)}}),{isValid:e.length===0,errors:e,analysisResult:t}},Z=[{title:"耗材名称",key:"name",width:120},{title:"子编码",key:"code",width:100},{title:"规格型号",key:"spec",width:120},{title:"批号",key:"batch",width:100},{title:"品牌",key:"brand",width:100},{title:"生产厂家",key:"manufacturer",width:120},{title:"货柜名称",key:"cabinet.name",width:100},{title:"退库数量",key:"number",width:80},{title:"唯一码",key:"rfid",width:150},{title:"操作",key:"actions",width:80,render:e=>k(ee,{size:"small",type:"error",onClick:()=>ie(e)},{default:()=>"移除"})}],ie=e=>{const t=_.value.items.findIndex(o=>o.rfid===e.rfid);t!==-1&&(_.value.items.splice(t,1),s.success("已移除该耗材"))},r=()=>{m("update:visible",!1),m("cancel")},l=async()=>{try{if(_.value.items.length===0){s.error("请先扫描要退库的耗材");return}const e=G();if(!e.isValid){const c=e.errors.join(`
`);s.error(`数据验证失败：
${c}`);return}const t={userID:Number($.value),orderNo:O.value.orderNo,type:"hasOrder",items:_.value.items.map(c=>({id:c.id||0,rfid:c.rfid,number:c.number,cabinetID:c.cabinetID||0}))};console.log("提交退库参数:",t);const o=await Ue(t);o&&o.data?(s.success("退库单提交成功"),_.value.items=[],m("update:visible",!1),m("refresh"),m("confirm",t)):s.error("退库单提交失败，请重试")}catch(e){console.error("退库单提交失败:",e),s.error("退库单提交失败，请检查网络连接")}};return ye(async()=>{console.log("有单退库对话框组件已挂载"),a.systemSettings||await a.initSystemSettings(),F(),R.value&&Le(()=>{X()})}),xe(()=>{console.log("对话框组件已卸载，清理资源"),R.value&&document.removeEventListener("keydown",H)}),se(()=>w.visible,e=>{R.value&&(e?document.addEventListener("keydown",H):document.removeEventListener("keydown",H))}),se(A,async e=>{e?(a.systemSettings||await a.initSystemSettings(),F(),R.value?(_.value.items=[],z.value=[],v.value=""):_.value.items=[]):(_.value.items=[],R.value&&(z.value=[],v.value=""))}),se(()=>w.mqttData,e=>{if(e&&e.length>0&&A.value){const t=e.filter(o=>!_.value.items.some(c=>c.rfid===o.rfid));t.length>0&&(_.value.items.push(...t),console.log("从父组件接收到新的MQTT数据:",t.length,"条记录"))}},{deep:!0}),(e,t)=>{const o=Qe,c=Ye,u=Ie,y=Se,S=qe;return V(),oe(S,{show:q(A),"onUpdate:show":r,preset:"card",closable:"",style:{width:"80%",height:"45rem",margin:"0 auto"},onKeydown:t[2]||(t[2]=fe(Ve(()=>{},["prevent"]),["enter"]))},{header:B(()=>[f("div",mt,[f("div",ft,[I(o,{component:q(Ge),class:"text-2xl text-blue-600 mr-2"},null,8,["component"]),vt])])]),default:B(()=>[I(y,null,{default:B(()=>{var b;return[f("div",ht,[f("div",null,[gt,W(" "+j(L.value||((b=q(O).user)==null?void 0:b.name)||""),1)]),f("div",null,[_t,W(" "+j(q(O).orderNo||""),1)])]),f("div",bt,[f("div",null,[yt,W(" "+j(q(O).time||""),1)])]),R.value?(V(),re("div",xt,[f("div",wt,[St,I(c,{ref_key:"scannerInputRef",ref:C,value:v.value,"onUpdate:value":t[0]||(t[0]=i=>v.value=i),valueModifiers:{trim:!0},placeholder:"请输入院内码",clearable:"","allow-input":i=>/^\d*$/.test(i),style:{width:"300px"},onKeyup:fe(M,["enter"]),onFocus:Y,onBlur:J},null,8,["value","allow-input","onKeyup"]),I(q(ee),{type:"primary",onClick:M,disabled:!v.value},{default:B(()=>[W("添加")]),_:1},8,["disabled"])]),It])):we("",!0),I(u,{columns:Z,data:_.value.items,"max-height":415,class:"fixed-header-table"},null,8,["data"]),f("div",$t,[I(q(ee),{onClick:t[1]||(t[1]=i=>r())},{default:B(()=>[W("取消")]),_:1}),I(q(ee),{type:"primary",onClick:l},{default:B(()=>[W("确认退库")]),_:1})]),kt]}),_:1})]),_:1},8,["show"])}}});const zt=f("div",{class:"flex items-center mb-2"},[f("h2",{class:"text-xl font-bold"},"有单退库")],-1),Dt={class:"text-sm text-gray-400 mb-4"},Rt={class:"mb-4 flex justify-between items-start"},Nt={class:"text-sm"},Tt={class:"text-gray-400"},Et={class:"text-gray-400 ml-6"},Ft={class:"text-gray-400 ml-6"},Bt={key:1,class:"text-center py-8 text-gray-500"},Gt=ae({__name:"index",setup(n){const m=ge(),w=_e(),s=be(),T=Ke(),E=x([]),a=x({}),$=x(!1),L=x(0),R=x({returnOrderCount:0,cabinetCount:0,materialCount:0}),v=x({orderNo:"",orderType:"hasOrder",reason:"other",time:"",items:[]}),C=x({}),h=K(()=>C.value[F.value]||"未知仓库"),g=x([]),z=x({});se($,r=>{r||(M.value=[],console.log("对话框关闭，清空processedMqttData"))});const A=async()=>{},O=x({}),_=()=>O.value[F.value],F=x(""),H=x(null),Y=()=>{const r=z.value[F.value];r&&(v.value={orderNo:r.orderNo,orderType:r.orderType,reason:r.reason,time:r.time,items:r.items},$.value=!0),m.success(`${F.value}开始退库操作`),console.log(`${F.value}: 打开退库详情对话框`)},J=r=>{var e;console.log("切换到标签页:",r);const l=z.value[r];l?(v.value.items=l.items,H.value={id:l.orderNo,key:l.orderNo,index:1,user:l.user,cabinet:((e=l.items[0])==null?void 0:e.cabinet)||{name:""},orderNo:l.orderNo,orderType:l.orderType,reason:l.reason,time:l.time},console.log("已切换到",r,"的数据:",l),console.log("表格数据已更新，当前商品数量:",v.value.items.length)):console.error("未找到标签页数据:",r)},X=[{title:"序号",key:"index",render:(r,l)=>l+1},{title:"耗材子编码",key:"code"},{title:"耗材名称",key:"name"},{title:"规格型号",key:"spec"},{title:"生产厂家",key:"manufacturer"},{title:"品牌",key:"brand"},{title:"单位",key:"unit"},{title:"唯一码",key:"rfid"},{title:"批号",key:"batch"},{title:"退库数量",key:"number"}],M=x([]),G=Je.debounce(async r=>{var l,e;try{a.value[r]&&(a.value[r].isStopInventory=!0);const t=(l=w.getDeviceBymac(r))==null?void 0:l.id;if(!t){m.error("未找到对应的货柜ID");return}if(!((e=a.value[r])!=null&&e.RFID)||a.value[r].RFID.length===0){console.log("未扫描到RFID标签，不处理");return}const o=await Ae({dataList:a.value[r].RFID,cabinetID:t});if(o&&o.data){console.log("API返回数据:",o.data);const c=o.data.takeList||[],u=o.data.errorData||[],y=o.data.notInStockData||[],S=o.data.returnList||[];u.length>0&&(console.warn("发现异常数据:",u),m.warning(`发现${u.length}个异常的耗材`)),y.length>0&&(console.warn("发现未入库耗材:",y),m.warning(`发现${y.length}个未入库耗材`)),S.length>0&&(console.warn("发现未入库耗材:",S),m.warning(`发现${S.length}个未入库耗材`));const b=c.map(i=>{var D;return{rfid:i.rfid,id:i.id,number:1,name:i.name,code:i.code,spec:i.spec,batch:i.batch,manufacturer:i.manufacturer,unit:i.unit||"-",brand:i.brand,cabinetID:t,cabinet:{name:((D=w.getDeviceBymac(r))==null?void 0:D.name)||"未知货柜"}}}).filter(i=>!M.value.some(D=>D.rfid===i.rfid));b.length>0?(M.value.push(...b),console.log("已添加新扫描到的耗材数据:",b.length,"条记录"),m.success(`成功识别${b.length}个耗材`),$.value||($.value=!0)):c.length===0&&a.value[r].RFID.length>0&&m.warning("未找到匹配的耗材信息，请确认RFID标签是否正确")}}catch(t){console.error("处理失败:",t)}finally{a.value[r].isStopInventory=!1,L.value=0,E.value=[],a.value[r].RFID=[],G.cancel()}},3e3);function Z(){var r;if(((r=s.systemSettings)==null?void 0:r.inventoryCountingMethod)!=="RFID"){console.log("有单退库 - 当前盘点方式不是RFID，跳过MQTT监听");return}T.subscribe(ne.RFID_TAGS,(l,e)=>{if(s.inventoryType==="outbound"){const{EPC:t,IP:o}=l,c=t.replace(/\s+/g,"").replace(/0{2}$/,"").padStart(18,"0");if(E.value.includes(c))return;E.value.push(c),L.value++,!$.value&&E.value.length>0&&($.value=!0),a.value&&a.value[o]&&!a.value[o].RFID.includes(c)?a.value[o].RFID.push(c):a.value[o]||(a.value[o]={MAC:o,RFID:[c],isStopInventory:!1})}}),T.subscribe(ne.RFID_INVENTORY_RESULT,async l=>{var t;const{ReaderId:e}=l;console.log("有单退库结果：",l),((t=a.value[e])==null?void 0:t.isStopInventory)===!1&&G(e)})}const ie=()=>{console.log("对话框确认事件触发")};return ye(async()=>{var r;console.log("有单退库父组件已挂载，开始初始化数据"),s.updateInventoryType("outbound"),s.systemSettings||await s.initSystemSettings(),console.log("有单退库 - 系统设置的盘点方式 (inventoryCountingMethod):",(r=s.systemSettings)==null?void 0:r.inventoryCountingMethod),Z(),await A(),console.log("有单退库数据初始化完成，当前显示退库单1的数据")}),xe(()=>{s.updateInventoryType("other"),T.unsubscribe(ne.RFID_TAGS),T.unsubscribe(ne.RFID_INVENTORY_RESULT),console.log("有单退库页面卸载")}),(r,l)=>{const e=nt,t=pt,o=ut,c=st,u=ee,y=ot,S=rt,b=tt,i=Ie,D=Se;return V(),re("div",null,[zt,f("div",Dt," 涉及退库单数："+j(R.value.returnOrderCount)+"个，退库货柜数："+j(R.value.cabinetCount)+"个，退货耗材数："+j(R.value.materialCount)+"个 ",1),I(e),I(c,{vertical:"",size:16,class:"mb-6"},{default:B(()=>{var d,p;return[I(o,{current:((d=_())==null?void 0:d.currentStep)||1,status:((p=_())==null?void 0:p.stepStatus)||"process"},{default:B(()=>[I(t,{title:" ",description:"选择退库单，点击”开始退库“"}),I(t,{title:" ",description:"开门取货"}),I(t,{title:" ",description:"关门"}),I(t,{title:" ",description:"确认退库"})]),_:1},8,["current","status"])]}),_:1}),g.value.length>0?(V(),oe(S,{key:0,value:F.value,"onUpdate:value":[l[0]||(l[0]=d=>F.value=d),J],type:"line",class:"mb-4"},{default:B(()=>[(V(!0),re(He,null,We(g.value,d=>(V(),oe(y,{key:d.id,name:d.id,tab:d.name},{default:B(()=>{var p,U;return[f("div",Rt,[f("div",Nt,[f("span",Tt,"退库单号："+j(((p=z.value[d.id])==null?void 0:p.orderNo)||""),1),f("span",Et,"生成时间："+j(((U=z.value[d.id])==null?void 0:U.time)||""),1),f("span",Ft,"退回仓库："+j(C.value[d.id]||""),1)]),I(u,{type:"primary",onClick:Y},{default:B(()=>[W("开始退库")]),_:1})])]}),_:2},1032,["name","tab"]))),128))]),_:1},8,["value"])):(V(),re("div",Bt,[I(b,{description:"暂无退库单数据"})])),g.value.length>0?(V(),oe(D,{key:2},{default:B(()=>[I(i,{columns:X,data:v.value.items,"max-height":415,class:"fixed-header-table"},null,8,["data"])]),_:1})):we("",!0),I(Xe,{"model-value":$.value,"onUpdate:modelValue":l[1]||(l[1]=d=>$.value=d),"current-count":L.value},null,8,["model-value","current-count"]),I(Ct,{visible:$.value,"row-data":v.value,"warehouse-name":h.value,mqttData:M.value,"onUpdate:visible":l[2]||(l[2]=d=>$.value=d),onConfirm:ie,onRefresh:r.fetchReturnOrderDetail},null,8,["visible","row-data","warehouse-name","mqttData","onRefresh"])])}}});export{Gt as _,pt as a,ut as b};
