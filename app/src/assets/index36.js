import{T as S}from"./table-paginate.js";import{p as T}from"./table-paginate2.js";import{d as Y,r as i,o as P,h as z,bK as h,an as U,ao as A,ap as a,aw as s,ar as d,as as o,a7 as c,ax as p,bS as R,bT as B,aC as H,aD as V}from"./index.js";import{l as j}from"./record.js";import{a as y}from"./Dropdown.js";import{_ as q}from"./Input.js";import{_ as E}from"./DatePicker.js";import{_ as F}from"./Form.js";import{N as K}from"./DataTable.js";import{_ as L}from"./_plugin-vue_export-helper.js";import"./use-merged-state.js";import"./use-compitable.js";import"./FocusDetector.js";import"./next-frame-once.js";import"./get.js";import"./format-length.js";import"./Icon.js";import"./ChevronRight.js";import"./TimePicker.js";import"./Checkbox.js";import"./RadioGroup.js";import"./get-slot.js";const m=v=>(H("data-v-8d49bf6d"),v=v(),V(),v),$={class:"query-area"},G={class:"grid grid-cols-4 gap-6"},J={class:"flex items-center"},Q=m(()=>a("label",{class:"mr-2",style:{width:"4rem"}},"取用人",-1)),W={class:"flex items-center"},X=m(()=>a("label",{class:"mr-2",style:{width:"4rem"}},"取用货柜",-1)),Z={class:"flex items-center"},ee=m(()=>a("label",{class:"mr-2",style:{width:"4rem"}},"取用耗材",-1)),te={class:"flex items-center"},ae=m(()=>a("label",{class:"mr-2",style:{width:"4rem"}},"处理方式",-1)),le={class:"flex items-center"},se={class:"flex items-center"},oe=m(()=>a("label",{class:"mr-2",style:{width:"4rem"}},"处理日期",-1)),ne={class:"flex items-center ml-4"},re={class:"flex justify-end mt-18"},ie={class:"mt-2"},de={class:"mt-4"},ue=Y({__name:"index",setup(v){const t=i({userID:null,handlingMethod:null,cabinetID:null,consumableName:null,date:null}),f=i([]),b=async()=>{try{const e=await R();e.data&&Array.isArray(e.data)&&(f.value=e.data)}catch(e){console.error("获取用户数据失败:",e)}},g=i([]),x=async()=>{try{const e=await B();e.data&&Array.isArray(e.data)&&(g.value=e.data)}catch(e){console.error("获取货柜数据失败:",e)}};P(async()=>{await b(),await x(),u()});const D=i([{label:"协商退回",value:"negotiateReturn"},{label:"本次允许",value:"thisTimeAllowed"}]),n=i({totalItems:100,pageSize:T,currentPage:1}),w=e=>{n.value.currentPage=e,u()},I=i([{title:"耗材子编码",key:"code"},{title:"耗材名称",key:"name"},{title:"规格型号",key:"spec"},{title:"单位",key:"unit"},{title:"唯一码",key:"rfid"},{title:"取用人",key:"userName"},{title:"取用时间",key:"takeTime"},{title:"处理方式",key:"handlingMethod",render:e=>z("span",{negotiateReturn:"协商退回",thisTimeAllowed:"本次允许"}[e.handlingMethod])},{title:"处理人",key:"handler"},{title:"处理时间",key:"handleTime"}]),_=i([]),u=async()=>{try{const e=await j({userID:t.value.userID,cabinetID:t.value.cabinetID,consumable:t.value.consumableName,date:t.value.date?[h(t.value.date[0]).format("YYYY-MM-DD"),h(t.value.date[1]).format("YYYY-MM-DD")]:void 0,page:n.value.currentPage,pagesize:n.value.pageSize,handlingMethod:t.value.handlingMethod});if(e.error){_.value=[],n.value.totalItems=0;return}_.value=e.data.items,n.value.totalItems=e.data.total}catch(e){console.error("获取越权处理记录列表失败:",e),_.value=[],n.value.totalItems=0}},k=()=>{t.value={userID:null,handlingMethod:null,cabinetID:null,consumableName:null,date:null},u()},M=()=>{const e=h().startOf("day");t.value.date=[e.valueOf(),e.valueOf()]},C=()=>{const e=h().subtract(1,"day").startOf("day");t.value.date=[e.valueOf(),e.valueOf()]},N=e=>{const l=new Date().setHours(0,0,0,0);return e>l},O=()=>{u()};return(e,l)=>(U(),A("div",null,[a("div",$,[s(o(F),{model:t.value,"label-width":100,"label-placement":"left",inline:""},{default:d(()=>[a("div",G,[a("div",J,[Q,s(o(y),{value:t.value.userID,"onUpdate:value":l[0]||(l[0]=r=>t.value.userID=r),options:f.value,placeholder:"请选择",style:{width:"180px"}},null,8,["value","options"])]),a("div",W,[X,s(o(y),{value:t.value.cabinetID,"onUpdate:value":l[1]||(l[1]=r=>t.value.cabinetID=r),options:g.value,placeholder:"请选择",style:{width:"180px"}},null,8,["value","options"])]),a("div",Z,[ee,s(o(q),{value:t.value.consumableName,"onUpdate:value":l[2]||(l[2]=r=>t.value.consumableName=r),placeholder:"请输入取用耗材",style:{width:"170px"}},null,8,["value"])]),a("div",te,[ae,s(o(y),{value:t.value.handlingMethod,"onUpdate:value":l[3]||(l[3]=r=>t.value.handlingMethod=r),options:D.value,placeholder:"请选择",style:{width:"180px"}},null,8,["value","options"])]),a("div",le,[a("div",se,[oe,s(o(E),{value:t.value.date,"onUpdate:value":l[4]||(l[4]=r=>t.value.date=r),type:"daterange",placeholder:"请选择日期范围","disabled-date":N,style:{width:"265px"}},null,8,["value"])]),a("div",ne,[s(o(c),{type:"primary",style:{"margin-left":"10px"},onClick:M},{default:d(()=>[p("今日")]),_:1}),s(o(c),{type:"primary",style:{"margin-left":"5px"},onClick:C},{default:d(()=>[p("昨日")]),_:1})])])]),a("div",re,[s(o(c),{type:"primary",onClick:u},{default:d(()=>[p("查询")]),_:1}),s(o(c),{type:"primary",style:{"margin-left":"8px"},onClick:k},{default:d(()=>[p("重置")]),_:1})])]),_:1},8,["model"])]),a("div",ie,[s(o(c),{type:"primary",onClick:O},{default:d(()=>[p("刷新")]),_:1})]),a("div",de,[s(o(K),{columns:I.value,data:_.value},null,8,["columns","data"])]),s(S,{total:n.value.totalItems,"page-size":n.value.pageSize,"current-page":n.value.currentPage,onPageChange:w},null,8,["total","page-size","current-page"])]))}});const Pe=L(ue,[["__scopeId","data-v-8d49bf6d"]]);export{Pe as default};
