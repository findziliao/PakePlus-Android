import{T as M}from"./table-paginate.js";import{p as V}from"./table-paginate2.js";import{j as q,k as E}from"./record.js";import{d as U,r as _,k as F,an as $,aq as S,ar as c,aw as s,ap as t,ax as i,au as g,as as r,aB as H,a$ as Q,a7 as y,aF as K,o as L,h as R,bK as D,ao as G,bS as J,aC as W,aD as X}from"./index.js";import{N as Y}from"./DataTable.js";import{a as C}from"./Dropdown.js";import{_ as Z}from"./Input.js";import{_ as ee}from"./DatePicker.js";import{_ as te}from"./Form.js";import{_ as ae}from"./_plugin-vue_export-helper.js";import"./format-length.js";import"./Checkbox.js";import"./use-merged-state.js";import"./RadioGroup.js";import"./get-slot.js";import"./FocusDetector.js";import"./next-frame-once.js";import"./get.js";import"./ChevronRight.js";import"./use-compitable.js";import"./Icon.js";import"./TimePicker.js";const le=t("div",{class:"flex justify-between items-center w-full"},[t("h2",{class:"text-xl font-bold"},"申领详情")],-1),se={class:"grid grid-cols-2 gap-4"},oe=t("strong",null,"申领人:",-1),ne=t("strong",null,"申领单号:",-1),re=t("strong",null,"申领类型:",-1),ie=t("strong",null,"申领结果:",-1),ue=t("strong",null,"申领时间:",-1),de={class:"flex justify-end mt-4"},pe=U({__name:"dialog",props:{visible:{type:Boolean},rowData:{}},emits:["update:visible","submit","cancel","handleReapply"],setup(f,{emit:h}){const a=f,u=_({items:[]}),x=async l=>{var m;try{const n=await q({id:l});if(n.error){u.value.items=[];return}u.value.items=((m=n.data)==null?void 0:m.items)||[]}catch(n){console.error("获取详情失败:",n),u.value.items=[]}},N=[{title:"耗材子编码",key:"code"},{title:"耗材名称",key:"name"},{title:"规格型号",key:"spec"},{title:"生产厂家",key:"manufacturer"},{title:"品牌",key:"brand"},{title:"单位",key:"unit"},{title:"当时库存量",key:"stockQuantity"},{title:"申领数量",key:"applyNumber"}];F(()=>a.visible,(l,m)=>{if(l&&!m&&a.rowData){const n=Number(a.rowData.id);x(n)}else l||(u.value.items=[])});const w=()=>{h("update:visible",!1),h("cancel")},d=()=>{var l;if(u.value.items.length===0){(l=window.$message)==null||l.error("当前申领单没有可重新申领的耗材");return}u.value.items.forEach(m=>{m.applyQuantity=m.applyNumber}),h("handleReapply",u.value.items)};return(l,m)=>{const n=Q,v=y,I=K;return $(),S(I,{show:l.visible,"onUpdate:show":w,preset:"card",closable:"",style:{width:"80%",height:"45rem",margin:"0 auto"}},{header:c(()=>[le]),default:c(()=>[s(n,null,{default:c(()=>[t("div",se,[t("div",null,[oe,i(" "+g(l.rowData.userName),1)]),t("div",null,[ne,i(" "+g(l.rowData.applyNo),1)]),t("div",null,[re,i(" "+g(l.rowData.type==="manual"?"手动申领":"自动申领"),1)]),t("div",null,[t("div",null,[ie,i(" "+g(l.rowData.result?"成功":"失败"),1)])]),t("div",null,[ue,i(" "+g(l.rowData.created_at),1)])]),s(r(Y),{columns:N,data:u.value.items,style:{"margin-top":"20px"},"max-height":415},null,8,["data"])]),_:1}),t("div",de,[s(v,{onClick:w},{default:c(()=>[i("返回")]),_:1}),l.rowData.result===!1?($(),S(v,{key:0,type:"primary",style:{"margin-left":"10px"},onClick:d},{default:c(()=>[i("重新申领")]),_:1})):H("",!0)])]),_:1},8,["show"])}}});const b=f=>(W("data-v-9bb03472"),f=f(),X(),f),ce={class:"query-area"},me={class:"grid grid-cols-4 gap-4"},_e={class:"flex items-center"},ve=b(()=>t("label",{class:"mr-2",style:{width:"4rem"}},"申领人",-1)),ye={class:"flex items-center"},fe=b(()=>t("label",{class:"mr-2",style:{width:"4rem"}},"申领类型",-1)),he={class:"flex items-center"},ge=b(()=>t("label",{class:"mr-2",style:{width:"4rem"}},"申领结果",-1)),be={class:"flex items-center"},we=b(()=>t("label",{class:"mr-2",style:{width:"4rem"}},"申领单号",-1)),ke={class:"flex items-center"},De={class:"flex items-center"},xe=b(()=>t("label",{class:"mr-2",style:{width:"4rem"}},"申领日期",-1)),Ne={class:"flex items-center ml-4"},Ie={class:"flex justify-end mt-18"},Ce={class:"mt-2"},$e={class:"mt-4"},Oe=U({__name:"index",emits:["apply-stock"],setup(f,{emit:h}){const a=_({userID:null,type:null,result:null,orderNo:null,date:null}),u=_([]),x=async()=>{try{const e=await J();e.data&&Array.isArray(e.data)&&(u.value=e.data)}catch(e){console.error("获取用户数据失败:",e)}};L(async()=>{await x(),v()});const N=_([{label:"手动申领",value:"manual"},{label:"自动申领",value:"auto"}]),w=_([{label:"成功",value:"true"},{label:"失败",value:"false"}]),d=_({totalItems:100,pageSize:V,currentPage:1}),l=e=>{d.value.currentPage=e},m=_([{title:"序号",key:"index",render:(e,o)=>o+1},{title:"申领单号",key:"applyNo"},{title:"申领人",key:"userName"},{title:"申领时间",key:"created_at"},{title:"申领总数",key:"number"},{title:"申领类型",key:"type",render:e=>e.type==="manual"?"手动申领":"自动申领"},{title:"申领结果",key:"result",render:e=>e.result===!1?R("span",{style:"color: red;"},"失败"):"成功"},{title:"操作",key:"actions",render:e=>R(y,{type:"primary",onClick:()=>T(e)},"详情")}]),n=_([]),v=async()=>{try{const e=await E({userID:a.value.userID,orderNo:a.value.orderNo,date:a.value.date?[D(a.value.date[0]).format("YYYY-MM-DD"),D(a.value.date[1]).format("YYYY-MM-DD")]:void 0,page:d.value.currentPage,pagesize:d.value.pageSize,type:a.value.type,result:a.value.result});if(e.error){n.value=[],d.value.totalItems=0;return}n.value=e.data.items,d.value.totalItems=e.data.total}catch(e){console.error("获取归还记录列表失败:",e),n.value=[],d.value.totalItems=0}},I=()=>{a.value={userID:null,type:null,result:null,orderNo:null,date:null},v()},P=()=>{const e=D().startOf("day");a.value.date=[e.valueOf(),e.valueOf()]},z=()=>{const e=D().subtract(1,"day").startOf("day");a.value.date=[e.valueOf(),e.valueOf()]},B=e=>{const o=new Date().setHours(0,0,0,0);return e>o},k=_(!1),O=_({}),T=e=>{O.value=e,k.value=!0},j=()=>{v()},A=e=>{h("apply-stock",{type:"apply",material:e}),k.value=!1};return(e,o)=>($(),G("div",null,[t("div",ce,[s(r(te),{model:a.value,"label-width":100,"label-placement":"left",inline:""},{default:c(()=>[t("div",me,[t("div",_e,[ve,s(r(C),{value:a.value.userID,"onUpdate:value":o[0]||(o[0]=p=>a.value.userID=p),options:u.value,placeholder:"请选择",style:{width:"180px"}},null,8,["value","options"])]),t("div",ye,[fe,s(r(C),{value:a.value.type,"onUpdate:value":o[1]||(o[1]=p=>a.value.type=p),options:N.value,placeholder:"请选择",style:{width:"180px"}},null,8,["value","options"])]),t("div",he,[ge,s(r(C),{value:a.value.result,"onUpdate:value":o[2]||(o[2]=p=>a.value.result=p),options:w.value,placeholder:"请选择",style:{width:"180px"}},null,8,["value","options"])]),t("div",be,[we,s(r(Z),{value:a.value.orderNo,"onUpdate:value":o[3]||(o[3]=p=>a.value.orderNo=p),placeholder:"请输入",style:{width:"180px"}},null,8,["value"])]),t("div",ke,[t("div",De,[xe,s(r(ee),{value:a.value.date,"onUpdate:value":o[4]||(o[4]=p=>a.value.date=p),type:"daterange",placeholder:"请选择日期范围","disabled-date":B,style:{width:"265px"}},null,8,["value"])]),t("div",Ne,[s(r(y),{type:"primary",style:{"margin-left":"10px"},onClick:P},{default:c(()=>[i("今日")]),_:1}),s(r(y),{type:"primary",style:{"margin-left":"5px"},onClick:z},{default:c(()=>[i("昨日")]),_:1})])])]),t("div",Ie,[s(r(y),{type:"primary",onClick:v},{default:c(()=>[i("查询")]),_:1}),s(r(y),{type:"primary",style:{"margin-left":"8px"},onClick:I},{default:c(()=>[i("重置")]),_:1})])]),_:1},8,["model"])]),t("div",Ce,[s(r(y),{type:"primary",onClick:j},{default:c(()=>[i("刷新")]),_:1})]),t("div",$e,[s(r(Y),{columns:m.value,data:n.value},null,8,["columns","data"])]),s(M,{total:d.value.totalItems,"page-size":d.value.pageSize,"current-page":d.value.currentPage,onPageChange:l},null,8,["total","page-size","current-page"]),s(pe,{visible:k.value,"onUpdate:visible":o[5]||(o[5]=p=>k.value=p),rowData:O.value,onHandleReapply:A},null,8,["visible","rowData"])]))}});const Xe=ae(Oe,[["__scopeId","data-v-9bb03472"]]);export{Xe as default};
