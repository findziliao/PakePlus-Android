import{T as j}from"./table-paginate.js";import{f as ne}from"./dictionary.js";import{p as O}from"./table-paginate2.js";import{b as le,_ as oe,s as ie,g as V,D as re,A as ue,a as se,i as ce,c as pe,d as de}from"./DocumentAttachOutline.js";import{d as q,an as R,ao as W,ap as N,r as _,bb as E,o as F,C as me,aq as L,ar as n,aw as t,as as k,a7 as Q,ax as f,au as D,a$ as K,aF as G,aB as _e,bh as ve,h as $}from"./index.js";import{_ as fe}from"./Input.js";import{_ as H}from"./FormItem.js";import{N as J,a as X}from"./Grid.js";import{_ as Y}from"./Form.js";import{N as Z}from"./DataTable.js";import{_ as ye,a as ge}from"./DescriptionsItem.js";import{_ as ke}from"./InputNumber.js";import{_ as be,a as he}from"./RadioGroup.js";import{_ as xe}from"./Space.js";import{S as Se}from"./Settings.js";import{N as M}from"./Dropdown.js";import{N as Pe}from"./Icon.js";import{_ as we}from"./_plugin-vue_export-helper.js";import"./use-merged-state.js";import"./format-length.js";import"./get.js";import"./next-frame-once.js";import"./get-slot.js";import"./Checkbox.js";import"./FocusDetector.js";import"./ChevronRight.js";import"./use-compitable.js";import"./Add.js";const Qe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ce=q({name:"CreateOutline",render:function(c,s){return R(),W("svg",Qe,s[0]||(s[0]=[N("path",{d:"M384 224v184a40 40 0 0 1-40 40H104a40 40 0 0 1-40-40V168a40 40 0 0 1 40-40h167.48",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),N("path",{d:"M459.94 53.25a16.06 16.06 0 0 0-23.22-.56L424.35 65a8 8 0 0 0 0 11.31l11.34 11.32a8 8 0 0 0 11.34 0l12.06-12c6.1-6.09 6.67-16.01.85-22.38z",fill:"currentColor"},null,-1),N("path",{d:"M399.34 90L218.82 270.2a9 9 0 0 0-2.31 3.93L208.16 299a3.91 3.91 0 0 0 4.86 4.86l24.85-8.35a9 9 0 0 0 3.93-2.31L422 112.66a9 9 0 0 0 0-12.66l-9.95-10a9 9 0 0 0-12.71 0z",fill:"currentColor"},null,-1)]))}}),Ie={class:"flex justify-end gap-2"},Ne=q({__name:"add-consumable-dialog",emits:["refresh"],setup(T,{expose:c,emit:s}){const x=_(!1),r=_([]),o=_({totalItems:100,pageSize:O,currentPage:1}),d=_(!1),C=E(),I=_([]);function z(){return[{type:"selection",fixed:"left"},{title:"耗材子编码",key:"subCode"},{title:"耗材名称",key:"name"},{title:"规格型号",key:"specifiacation"},{title:"生产厂家",key:"manufacturer"},{title:"品牌",key:"brand"},{title:"单位",key:"unit"},{title:"销售包装规格",key:"sellPkgSpec"},{title:"销售包装含量",key:"sellPkgUnitNum"},{title:"销售包装单位",key:"sellPkgUnit"}]}const A=z(),y=()=>{x.value=!0,g()};F(()=>{});const l=_({code:"",name:"",spec:"",brand:"",manufacturer:""}),P=i=>{r.value=i,console.log("选中行:",i)},p=async()=>{try{const i=I.value.filter(a=>r.value.includes(a.id));if(i.length===0){C.error("请至少选择一项耗材");return}const{error:e}=await le({list:i.map(a=>({code:a.subCode,name:a.name,spec:a.specifiacation,manufacturer:a.manufacturer,brand:a.brand,unit:a.unit,sellPkgSpec:a.sellPkgSpec,sellPkgUnit:a.sellPkgUnit,sellPkgUnitNum:a.sellPkgUnitNum}))});if(e)return;s("refresh"),x.value=!1,r.value=[],C.success("添加成功")}catch(i){console.error("添加库存预警耗材失败:",i),C.error("添加库存预警耗材失败: "+(i instanceof Error?i.message:"未知错误"))}},w=()=>{l.value={code:"",name:"",spec:"",brand:"",manufacturer:""},g()},g=async()=>{try{const{data:i,error:e}=await ne({...l.value,page:o.value.currentPage,pagesize:o.value.pageSize,type:""});if(e){C.error("获取所有耗材字典列表失败: "+e);return}i&&(I.value=i.items,o.value.totalItems=i.total)}catch(i){console.error("加载耗材数据失败:",i),C.error("加载耗材数据失败")}finally{d.value=!1}},m=async()=>{o.value.currentPage=1,await g()};async function S(i){o.value.currentPage=i,await g()}return me(()=>{r.value=[],l.value={code:"",name:"",spec:"",brand:"",manufacturer:""}}),c({open:y}),(i,e)=>{const a=fe,u=H,v=J,U=X,B=Y,b=oe,ee=Z,te=K,ae=G;return R(),L(ae,{show:x.value,"onUpdate:show":e[6]||(e[6]=h=>x.value=h)},{default:n(()=>[t(te,{style:{width:"80vw","max-width":"1200px"},title:"添加耗材",bordered:!1},{footer:n(()=>[N("div",Ie,[t(k(Q),{onClick:e[5]||(e[5]=h=>x.value=!1)},{default:n(()=>[f("取消")]),_:1}),t(k(Q),{type:"primary",onClick:p},{default:n(()=>[f("确定")]),_:1})])]),default:n(()=>[t(B,{model:l.value,"label-placement":"left","label-width":"auto"},{default:n(()=>[t(U,{cols:24,"x-gap":24},{default:n(()=>[t(v,{span:8},{default:n(()=>[t(u,{label:"耗材子编码"},{default:n(()=>[t(a,{value:l.value.code,"onUpdate:value":e[0]||(e[0]=h=>l.value.code=h)},null,8,["value"])]),_:1})]),_:1}),t(v,{span:8},{default:n(()=>[t(u,{label:"耗材名称"},{default:n(()=>[t(a,{value:l.value.name,"onUpdate:value":e[1]||(e[1]=h=>l.value.name=h)},null,8,["value"])]),_:1})]),_:1}),t(v,{span:8},{default:n(()=>[t(u,{label:"规格型号"},{default:n(()=>[t(a,{value:l.value.spec,"onUpdate:value":e[2]||(e[2]=h=>l.value.spec=h)},null,8,["value"])]),_:1})]),_:1}),t(v,{span:8},{default:n(()=>[t(u,{label:"品牌"},{default:n(()=>[t(a,{value:l.value.brand,"onUpdate:value":e[3]||(e[3]=h=>l.value.brand=h)},null,8,["value"])]),_:1})]),_:1}),t(v,{span:8},{default:n(()=>[t(u,{label:"生产厂家"},{default:n(()=>[t(a,{value:l.value.manufacturer,"onUpdate:value":e[4]||(e[4]=h=>l.value.manufacturer=h)},null,8,["value"])]),_:1})]),_:1}),t(v,{span:8,class:"flex items-center"},{default:n(()=>[t(k(Q),{type:"primary",onClick:m},{default:n(()=>[f("查询")]),_:1}),t(k(Q),{class:"ml-4",onClick:w},{default:n(()=>[f("重置")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),t(b,{class:"mb-4"},{default:n(()=>[f("已选中 "+D(r.value.length)+" 项耗材",1)]),_:1}),t(ee,{columns:k(A),data:I.value,"row-key":h=>h.id,"onUpdate:checkedRowKeys":P,loading:d.value},null,8,["columns","data","row-key","loading"]),t(j,{total:o.value.totalItems,"page-size":o.value.pageSize,"current-page":o.value.currentPage,onPageChange:S},null,8,["total","page-size","current-page"])]),_:1})]),_:1},8,["show"])}}}),Ue=N("span",{style:{color:"red"}},"注:定量补货数、安全库存、最大库存量、再订货点均不能为负",-1),ze={class:"flex justify-end gap-2"},Ae=q({__name:"editor",emits:["confirm"],setup(T,{expose:c,emit:s}){const x=_(),r=_(!1),o=_({idList:0,safeStockQuantity:0,quantityReplenishment:0,maxStockQuantity:0,reorderPointQuantity:0,participateInApplication:!0}),d=_({}),C=_(""),I=_([]),z=(y,l)=>{if(!["edit","batch"].includes(y)){console.error("Invalid dialog type:",y);return}if(C.value=y==="batch"?" 耗材库存批量编辑":"耗材库存设置",x.value=y,console.log("dialog",l),l&&y==="edit")o.value={...l},d.value={...l};else if(l&&y==="batch"){if(!Array.isArray(l)){console.error("Batch data must be an array");return}I.value=l,d.value.sellPkgUnitNum=l[0].sellPkgUnitNum,console.log("currentItem",d.value.sellPkgUnitNum),o.value.idList=l.map(P=>P.id),o.value.safeStockQuantity=l[0].safeStockQuantity||0,o.value.quantityReplenishment=l[0].quantityReplenishment||0,o.value.maxStockQuantity=l[0].maxStockQuantity||0,o.value.reorderPointQuantity=l[0].reorderPointQuantity||0,o.value.participateInApplication=l[0].participateInApplication||!0}r.value=!0},A=async()=>{var p,w,g;const y=d.value.sellPkgUnitNum;console.log("sellPkgUnitNum",y);const l=[],P=[{key:"quantityReplenishment",label:"定量补货数"},{key:"maxStockQuantity",label:"最大库存量"},{key:"reorderPointQuantity",label:"再订货点"}];for(const m of P){const S=m.key,i=o.value[S],e=Number(i),a=Number(y);e%a!==0&&(l.push(m.label),o.value[S]=Math.ceil(e/a)*a)}if(l.length>0){(p=window.$message)==null||p.warning(`${l.join("、")}需要是销售包装含量(${y})的整倍数，已自动调整`);return}try{let m={list:[]};x.value==="batch"?m.list=I.value.map(i=>({id:i.id,code:i.code,maxStockQuantity:o.value.maxStockQuantity,participateInApplication:o.value.participateInApplication,quantityReplenishment:o.value.quantityReplenishment,reorderPointQuantity:o.value.reorderPointQuantity,safeStockQuantity:o.value.safeStockQuantity})):m.list=[{id:d.value.id,code:d.value.code,maxStockQuantity:o.value.maxStockQuantity,participateInApplication:o.value.participateInApplication,quantityReplenishment:o.value.quantityReplenishment,reorderPointQuantity:o.value.reorderPointQuantity,safeStockQuantity:o.value.safeStockQuantity}],(await ie(m)).data&&((w=window.$message)==null||w.success("设置成功"),s("confirm",{id:d.value.id,...o.value,code:d.value.code,maxStockQuantity:o.value.maxStockQuantity,quantityReplenishment:o.value.quantityReplenishment,reorderPointQuantity:o.value.reorderPointQuantity,safeStockQuantity:o.value.safeStockQuantity,participateInApplication:o.value.participateInApplication}),r.value=!1)}catch(m){console.error("设置库存预警值失败:",m),(g=window.$message)==null||g.error("设置库存预警值失败")}};return c({open:z}),(y,l)=>{const P=ye,p=ge,w=ke,g=H,m=J,S=X,i=be,e=xe,a=he,u=Y,v=Q,U=K,B=G;return R(),L(B,{show:r.value,"onUpdate:show":l[6]||(l[6]=b=>r.value=b),title:C.value,preset:"card",style:{width:"650px"}},{default:n(()=>[t(U,{style:{width:"600px"},bordered:!1},{footer:n(()=>[N("div",ze,[t(v,{onClick:l[5]||(l[5]=b=>r.value=!1)},{default:n(()=>[f("取消")]),_:1}),t(v,{type:"primary",onClick:A},{default:n(()=>[f("确定")]),_:1})])]),default:n(()=>[x.value==="edit"?(R(),L(p,{key:0,"label-placement":"left",column:2,class:"mb-4 pl-10"},{default:n(()=>[t(P,{label:"耗材名称"},{default:n(()=>[f(D(d.value.name),1)]),_:1}),t(P,{label:"耗材子编码"},{default:n(()=>[f(D(d.value.code),1)]),_:1}),t(P,{label:"规格型号"},{default:n(()=>[f(D(d.value.spec),1)]),_:1}),t(P,{label:"品牌"},{default:n(()=>[f(D(d.value.brand),1)]),_:1})]),_:1})):_e("",!0),t(u,{model:o.value,"label-placement":"left","label-width":"120px"},{default:n(()=>[t(S,{cols:2,"x-gap":24,"item-responsive":!0},{default:n(()=>[t(m,{span:1},{default:n(()=>[t(g,{label:"安全库存"},{default:n(()=>[t(w,{value:o.value.safeStockQuantity,"onUpdate:value":l[0]||(l[0]=b=>o.value.safeStockQuantity=b),min:0,clearable:""},null,8,["value"])]),_:1})]),_:1}),t(m,{span:1},{default:n(()=>[t(g,{label:"定量补货数"},{default:n(()=>[t(w,{value:o.value.quantityReplenishment,"onUpdate:value":l[1]||(l[1]=b=>o.value.quantityReplenishment=b),min:0,clearable:""},null,8,["value"])]),_:1})]),_:1}),t(m,{span:1},{default:n(()=>[t(g,{label:"最大库存量"},{default:n(()=>[t(w,{value:o.value.maxStockQuantity,"onUpdate:value":l[2]||(l[2]=b=>o.value.maxStockQuantity=b),min:0,clearable:""},null,8,["value"])]),_:1})]),_:1}),t(m,{span:1},{default:n(()=>[t(g,{label:"再订货点"},{default:n(()=>[t(w,{value:o.value.reorderPointQuantity,"onUpdate:value":l[3]||(l[3]=b=>o.value.reorderPointQuantity=b),min:0,clearable:""},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(g,{label:"是否参与申领"},{default:n(()=>[t(a,{value:o.value.participateInApplication,"onUpdate:value":l[4]||(l[4]=b=>o.value.participateInApplication=b)},{default:n(()=>[t(e,null,{default:n(()=>[t(i,{value:!0,label:"是"}),t(i,{value:!1,label:"否"})]),_:1})]),_:1},8,["value"])]),_:1}),Ue]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),$e={class:"inventory-setting"},De={class:"mb-4 flex items-center",style:{"font-size":"22px"}},Re={class:"toolbar mb-4 flex gap-2 justify-end"},qe=q({__name:"index",setup(T){const c=_({totalItems:100,pageSize:O,currentPage:1}),s=_([]);F(async()=>{try{const e=await V({page:c.value.currentPage,pagesize:c.value.pageSize});e.data&&(s.value=e.data.items.map(a=>({...a,maxStockQuantity:a.maxStockQuantity})),c.value={totalItems:e.data.total,pageSize:e.data.pagesize,currentPage:e.data.page})}catch(e){console.error("获取数据失败:",e),r.error("获取数据失败")}});const x=_(),r=E(),o=ve(),d=async()=>{try{const{data:e,error:a}=await ce({targetModel:"stock"});if(a){r.error("导入失败: "+a);return}e&&(r.success("导入成功"),S())}catch(e){console.error("导入耗材字典失败:",e),r.error("导入耗材字典失败")}},C=()=>{var e;(e=I.value)==null||e.open()},I=_(),z=A();function A(){return[{type:"selection",fixed:"left"},{title:"序号",key:"index",render:(e,a)=>a+1},{title:"耗材子编码",key:"code"},{title:"耗材名称",key:"name"},{title:"规格型号",key:"spec"},{title:"生产厂家",key:"manufacturer"},{title:"品牌",key:"brand"},{title:"单位",key:"unit"},{title:"销售包装规格",key:"sellPkgSpec"},{title:"销售包装含量",key:"sellPkgUnitNum"},{title:"销售包装单位",key:"sellPkgUnit"},{title:"定量补货数",key:"quantityReplenishment"},{title:"安全库存",key:"safeStockQuantity"},{title:"最大库存量",key:"maxStockQuantity"},{title:"再订货点",key:"reorderPointQuantity"},{title:"是否参与申领",key:" participateInApplication",render:e=>e.participateInApplication?$(M,{type:"success"},{default:()=>"是"}):$(M,{type:"error"},{default:()=>"否"})},{title:"操作",key:"actions",render:e=>$("div",{class:"flex gap-2"},[$(Q,{text:!0,type:"primary",onClick:()=>{var a;return(a=x.value)==null?void 0:a.open("edit",e)}},{default:()=>"编辑"}),$(Q,{text:!0,type:"error",onClick:()=>P(e)},{default:()=>"删除"})])}]}const y=async e=>{try{s.value=[...s.value,...e.map(a=>({...a,maxStockQuantity:0,code:a.subCode||a.code,spec:a.specifiacation}))]}catch(a){console.error("添加耗材失败:",a),r.error("添加耗材失败")}},l=()=>{if(p.value.length===0){r.warning("请先选择要删除的记录");return}o.warning({title:"警告",content:`是否确认不再监测 ${p.value.map(e=>{var a;return(a=s.value.find(u=>u.id===e))==null?void 0:a.name}).join(", ")} 这些耗材?
        `,positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{try{await pe(p.value),r.success("批量删除成功！"),await S(),p.value=[]}catch(e){console.error("批量删除失败:",e),r.error("批量删除失败")}},onNegativeClick:()=>{}})},P=e=>{console.log("删除操作",e),o.warning({title:"警告",content:`是否确认不再监测 ${e.name} 耗材？`,positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{try{await de({ID:e.id}),r.success("删除成功！"),await S()}catch(a){console.error("删除失败:",a),r.error("删除失败")}},onNegativeClick:()=>{}})},p=_([]),w=e=>{p.value=e},g=()=>{var a;if(p.value.length===0){r.warning("请先选择要编辑的记录");return}if(new Set(p.value.map(u=>{var v;return(v=s.value.find(U=>U.id===u))==null?void 0:v.sellPkgUnitNum})).size>1){r.error("批量编辑耗材的销售包装含量必须相同！");return}(a=x.value)==null||a.open("batch",p.value.map(u=>s.value.find(v=>v.id===u)))},m=e=>{c.value.currentPage=e,c.value.pageSize=e,c.value.totalItems=e},S=async()=>{try{p.value=[];const e=await V({page:c.value.currentPage,pagesize:c.value.pageSize});e.data&&e.data.items?(s.value=e.data.items.map(a=>({...a,maxStockQuantity:a.maxStockQuantity,quantityReplenishment:a.quantityReplenishment,safeStockQuantity:a.safeStockQuantity,reorderPointQuantity:a.reorderPointQuantity,participateInApplication:a.participateInApplication})),c.value={totalItems:e.data.total,pageSize:e.data.pagesize,currentPage:e.data.page}):(s.value=[],c.value={totalItems:0,pageSize:c.value.pageSize,currentPage:1})}catch(e){console.error("获取数据失败:",e),r.error("获取数据失败"),s.value=[]}},i=e=>{const a=s.value.findIndex(u=>u.id===e.id);a!==-1&&(s.value[a]={...s.value[a],...e}),S(),p.value=[]};return(e,a)=>{const u=Pe,v=Z;return R(),W("div",$e,[N("div",De,[t(u,null,{default:n(()=>[t(k(Se))]),_:1}),f("耗材库存预警设置 ")]),N("div",Re,[t(k(Q),{type:"primary",onClick:d},{icon:n(()=>[t(u,null,{default:n(()=>[t(k(re))]),_:1})]),default:n(()=>[f(" 从本地耗材字典导入 ")]),_:1}),t(k(Q),{type:"primary",onClick:C},{icon:n(()=>[t(u,null,{default:n(()=>[t(k(ue))]),_:1})]),default:n(()=>[f(" 添加 ")]),_:1}),t(k(Q),{onClick:g,type:"primary"},{icon:n(()=>[t(u,null,{default:n(()=>[t(k(Ce))]),_:1})]),default:n(()=>[f(" 批量编辑 ")]),_:1}),t(k(Q),{type:"error",onClick:l},{icon:n(()=>[t(u,null,{default:n(()=>[t(k(se))]),_:1})]),default:n(()=>[f(" 批量删除 ")]),_:1})]),t(v,{columns:k(z),data:s.value,"row-key":U=>U.id,"checked-row-keys":p.value,"onUpdate:checkedRowKeys":w},null,8,["columns","data","row-key","checked-row-keys"]),t(j,{total:c.value.totalItems,"page-size":c.value.pageSize,"current-page":c.value.currentPage,onPageChange:m},null,8,["total","page-size","current-page"]),t(Ne,{ref_key:"addDialog",ref:I,onRefresh:S,onConfirm:y},null,512),t(Ae,{ref_key:"editorDialog",ref:x,onConfirm:i},null,512)])}}});const pt=we(qe,[["__scopeId","data-v-111e060f"]]);export{pt as default};
