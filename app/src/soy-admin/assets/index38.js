import{T as B}from"./table-paginate.js";import{p as M}from"./table-paginate2.js";import{e as A,T as C,g as j}from"./record.js";import{d as N,r as u,k as V,an as T,aq as q,ar as d,aw as s,ap as t,ax as p,au as g,as as n,a$ as F,aF as E,o as H,h as K,a7 as h,bK as w,ao as L,bS as G,bT as J,aC as Q,aD as W}from"./index.js";import{N as S}from"./DataTable.js";import{a as O}from"./Dropdown.js";import{_ as X}from"./Input.js";import{_ as Z}from"./DatePicker.js";import{_ as ee}from"./Form.js";import{_ as te}from"./_plugin-vue_export-helper.js";import"./format-length.js";import"./Checkbox.js";import"./use-merged-state.js";import"./RadioGroup.js";import"./get-slot.js";import"./FocusDetector.js";import"./next-frame-once.js";import"./get.js";import"./ChevronRight.js";import"./use-compitable.js";import"./Icon.js";import"./TimePicker.js";const ae=t("div",{class:"flex justify-between items-center w-full"},[t("h2",{class:"text-xl font-bold"},"归还详情")],-1),se={class:"grid grid-cols-2 gap-4"},le=t("strong",null,"归还人:",-1),oe=t("strong",null,"归还单号:",-1),re=t("strong",null,"开门时间:",-1),ne=t("strong",null,"关门时间:",-1),ie=N({__name:"dialog",props:{visible:{type:Boolean},rowData:{}},emits:["update:visible","submit","cancel"],setup(v,{emit:a}){const y=v,m=u({items:[]}),b=async r=>{var _;try{const o=await A({ID:r,type:C.Return});if(o.error){m.value.items=[];return}m.value.items=((_=o.data)==null?void 0:_.items)||[]}catch(o){console.error("获取详情失败:",o),m.value.items=[]}},k=[{title:"耗材子编码",key:"code"},{title:"耗材名称",key:"name"},{title:"规格型号",key:"spec"},{title:"生产厂家",key:"manufacturer"},{title:"品牌",key:"brand"},{title:"单位",key:"unit"},{title:"唯一码",key:"rfid"},{title:"批号",key:"batch"},{title:"取用数量",key:"number"}];V(()=>y.visible,(r,_)=>{if(r&&!_&&y.rowData){const o=Number(y.rowData.id);b(o)}else r||(m.value.items=[])});const i=()=>{a("update:visible",!1),a("cancel")};return(r,_)=>{const o=F,f=E;return T(),q(f,{show:r.visible,"onUpdate:show":i,preset:"card",closable:"",style:{width:"80%",height:"45rem",margin:"0 auto"}},{header:d(()=>[ae]),default:d(()=>[s(o,null,{default:d(()=>[t("div",se,[t("div",null,[le,p(" "+g(r.rowData.user.name),1)]),t("div",null,[oe,p(" "+g(r.rowData.id),1)]),t("div",null,[re,p(" "+g(r.rowData.openDoorTime),1)]),t("div",null,[ne,p(" "+g(r.rowData.closeDoorTime),1)])]),s(n(S),{columns:k,data:m.value.items,style:{"margin-top":"20px"},"max-height":415},null,8,["data"])]),_:1})]),_:1},8,["show"])}}});const D=v=>(Q("data-v-76bf27e3"),v=v(),W(),v),ce={class:"query-area"},ue={class:"grid grid-cols-5 gap-6"},de={class:"flex items-center"},pe=D(()=>t("label",{class:"mr-2",style:{width:"3rem"}},"归还人",-1)),me={class:"flex items-center"},_e=D(()=>t("label",{class:"mr-2",style:{width:"4rem"}},"归还货柜",-1)),ve={class:"flex items-center"},ye=D(()=>t("label",{class:"mr-2",style:{width:"4rem"}},"归还单号",-1)),fe={class:"flex items-center"},he={class:"flex items-center"},be=D(()=>t("label",{class:"mr-2",style:{width:"4rem"}},"归还日期",-1)),ge={class:"flex items-center ml-2"},we={class:"flex justify-end mt-18"},De={class:"mt-2"},ke={class:"mt-4"},xe=N({__name:"index",setup(v){const a=u({userID:null,cabinetId:null,recordOrderNumber:null,date:null}),y=u([]),m=async()=>{try{const e=await G();e.data&&Array.isArray(e.data)&&(y.value=e.data)}catch(e){console.error("获取用户数据失败:",e)}},b=u([]),k=async()=>{try{const e=await J();e.data&&Array.isArray(e.data)&&(b.value=e.data)}catch(e){console.error("获取货柜数据失败:",e)}};H(async()=>{await m(),await k(),f()});const i=u({totalItems:100,pageSize:M,currentPage:1}),r=e=>{i.value.currentPage=e},_=u([{title:"序号",key:"index",render:(e,l)=>l+1},{title:"归还单号",key:"id"},{title:"归还人",key:"user.name"},{title:"开门时间",key:"openDoorTime"},{title:"关门时间",key:"closeDoorTime"},{title:"归还总数",key:"returnNum"},{title:"归还货柜",key:"cabinet.name"},{title:"操作",key:"actions",render:e=>K(h,{type:"primary",onClick:()=>U(e)},"详情")}]),o=u([]),f=async()=>{try{const e=await j({userID:a.value.userID,cabinetId:a.value.cabinetId,recordOrderNumber:a.value.recordOrderNumber,date:a.value.date?[w(a.value.date[0]).format("YYYY-MM-DD"),w(a.value.date[1]).format("YYYY-MM-DD")]:void 0,page:i.value.currentPage,pagesize:i.value.pageSize,type:C.Return});if(e.error){o.value=[],i.value.totalItems=0;return}o.value=e.data.items,i.value.totalItems=e.data.total}catch(e){console.error("获取归还记录列表失败:",e),o.value=[],i.value.totalItems=0}},$=()=>{a.value={userID:null,cabinetId:null,recordOrderNumber:null,date:null},f()},R=()=>{const e=w().startOf("day");a.value.date=[e.valueOf(),e.valueOf()]},Y=()=>{const e=w().subtract(1,"day").startOf("day");a.value.date=[e.valueOf(),e.valueOf()]},P=e=>{const l=new Date().setHours(0,0,0,0);return e>l},x=u(!1),I=u({}),U=e=>{I.value=e,x.value=!0},z=()=>{console.log("执行表格刷新逻辑"),f()};return(e,l)=>(T(),L("div",null,[t("div",ce,[s(n(ee),{model:a.value,"label-width":100,"label-placement":"left",inline:""},{default:d(()=>[t("div",ue,[t("div",de,[pe,s(n(O),{value:a.value.userID,"onUpdate:value":l[0]||(l[0]=c=>a.value.userID=c),options:y.value,placeholder:"请选择归还人",style:{width:"180px"},clearable:""},null,8,["value","options"])]),t("div",me,[_e,s(n(O),{value:a.value.cabinetId,"onUpdate:value":l[1]||(l[1]=c=>a.value.cabinetId=c),options:b.value,placeholder:"请选择归还货柜",style:{width:"180px"},clearable:""},null,8,["value","options"])]),t("div",ve,[ye,s(n(X),{value:a.value.recordOrderNumber,"onUpdate:value":l[2]||(l[2]=c=>a.value.recordOrderNumber=c),placeholder:"请输入归还单号",style:{width:"180px"}},null,8,["value"])]),t("div",fe,[t("div",he,[be,s(n(Z),{value:a.value.date,"onUpdate:value":l[3]||(l[3]=c=>a.value.date=c),type:"daterange",placeholder:"请选择日期范围","disabled-date":P,style:{width:"265px"}},null,8,["value"])]),t("div",ge,[s(n(h),{type:"primary",style:{"margin-left":"20px"},onClick:R},{default:d(()=>[p("今日")]),_:1}),s(n(h),{type:"primary",style:{"margin-left":"15px"},onClick:Y},{default:d(()=>[p("昨日")]),_:1})])])]),t("div",we,[s(n(h),{type:"primary",onClick:f},{default:d(()=>[p("查询")]),_:1}),s(n(h),{type:"primary",style:{"margin-left":"8px"},onClick:$},{default:d(()=>[p("重置")]),_:1})])]),_:1},8,["model"])]),t("div",De,[s(n(h),{type:"primary",onClick:z},{default:d(()=>[p("刷新")]),_:1})]),t("div",ke,[s(n(S),{columns:_.value,data:o.value},null,8,["columns","data"])]),s(B,{total:i.value.totalItems,"page-size":i.value.pageSize,"current-page":i.value.currentPage,onPageChange:r},null,8,["total","page-size","current-page"]),s(ie,{visible:x.value,"onUpdate:visible":l[4]||(l[4]=c=>x.value=c),rowData:I.value},null,8,["visible","rowData"])]))}});const Le=te(xe,[["__scopeId","data-v-76bf27e3"]]);export{Le as default};
