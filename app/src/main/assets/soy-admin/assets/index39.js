import{T as A}from"./table-paginate.js";import{p as E}from"./table-paginate2.js";import{h as j,O as T,i as V}from"./record.js";import{d as S,r as i,k as q,an as $,aq as F,ar as c,aw as o,ap as t,ax as d,au as g,as as n,a$ as K,aF as H,o as L,h as G,a7 as f,bK as w,ao as J,bS as Q,bT as W,aC as X,aD as Z}from"./index.js";import{N as U}from"./DataTable.js";import{a as D}from"./Dropdown.js";import{_ as ee}from"./Input.js";import{_ as te}from"./DatePicker.js";import{_ as ae}from"./Form.js";import{_ as le}from"./_plugin-vue_export-helper.js";import"./format-length.js";import"./Checkbox.js";import"./use-merged-state.js";import"./RadioGroup.js";import"./get-slot.js";import"./FocusDetector.js";import"./next-frame-once.js";import"./get.js";import"./ChevronRight.js";import"./use-compitable.js";import"./Icon.js";import"./TimePicker.js";const se=t("div",{class:"flex justify-between items-center w-full"},[t("h2",{class:"text-xl font-bold"},"退库详情")],-1),oe={class:"grid grid-cols-2 gap-4"},re=t("strong",null,"退库人:",-1),ne=t("strong",null,"退库单号:",-1),ie=t("strong",null,"退库类型:",-1),ue=t("strong",null,"退库原因:",-1),de={class:"grid grid-cols-1 gap-4 mt-4"},ce=t("strong",null,"退库时间:",-1),pe=S({__name:"dialog",props:{visible:{type:Boolean},rowData:{}},emits:["update:visible","submit","cancel"],setup(_,{emit:a}){const y=_,x=i([{label:"近效期",value:"nearExpiry"},{label:"已过期",value:"expired"},{label:"其他",value:"other"}]),p=i({items:[]}),k=async l=>{var v;try{const u=await j({ID:l,type:T.Return});if(u.error){p.value.items=[];return}p.value.items=((v=u.data)==null?void 0:v.items)||[]}catch(u){console.error("获取详情失败:",u),p.value.items=[]}},I=[{title:"退库货柜",key:"cabinet.name"},{title:"耗材子编码",key:"code"},{title:"耗材名称",key:"name"},{title:"规格型号",key:"spec"},{title:"生产厂家",key:"manufacturer"},{title:"品牌",key:"brand"},{title:"单位",key:"unit"},{title:"唯一码",key:"rfid"},{title:"批号",key:"batch"},{title:"退库数量",key:"number"}];q(()=>y.visible,(l,v)=>{if(l&&!v&&y.rowData){const u=Number(y.rowData.id);k(u)}else l||(p.value.items=[])});const O=()=>{a("update:visible",!1),a("cancel")};return(l,v)=>{const u=K,h=H;return $(),F(h,{show:l.visible,"onUpdate:show":O,preset:"card",closable:"",style:{width:"80%",height:"45rem",margin:"0 auto"}},{header:c(()=>[se]),default:c(()=>[o(u,null,{default:c(()=>{var m;return[t("div",oe,[t("div",null,[re,d(" "+g(l.rowData.user.name),1)]),t("div",null,[ne,d(" "+g(l.rowData.orderNo),1)]),t("div",null,[ie,d(" "+g(l.rowData.orderType==="hasOrder"?"有单入库":"无单入库"),1)]),t("div",null,[ue,d(" "+g(((m=x.value.find(R=>R.value===l.rowData.reason))==null?void 0:m.label)||"其他"),1)])]),t("div",de,[t("div",null,[ce,d(" "+g(l.rowData.time),1)])]),o(n(U),{columns:I,data:p.value.items,style:{"margin-top":"20px"},"max-height":415,class:"fixed-header-table"},null,8,["data"])]}),_:1})]),_:1},8,["show"])}}});const b=_=>(X("data-v-7464cc09"),_=_(),Z(),_),ve={class:"query-area"},me={class:"grid grid-cols-5 gap-6"},_e={class:"flex items-center"},ye=b(()=>t("label",{class:"mr-2",style:{width:"4rem"}},"退库人",-1)),he={class:"flex items-center"},fe=b(()=>t("label",{class:"mr-2",style:{width:"4rem"}},"退库货柜",-1)),be={class:"flex items-center"},ge=b(()=>t("label",{class:"mr-2",style:{width:"4rem"}},"退库类型",-1)),we={class:"flex items-center"},De=b(()=>t("label",{class:"mr-2",style:{width:"4rem"}},"退库原因",-1)),xe={class:"flex items-center"},ke=b(()=>t("label",{class:"mr-2",style:{width:"4rem"}},"退库单号",-1)),Ie={class:"flex items-center"},Oe={class:"flex items-center"},Re=b(()=>t("label",{class:"mr-2",style:{width:"4rem"}},"退库日期",-1)),Ne={class:"flex items-center ml-4"},Ce={class:"flex justify-end mt-18"},Te={class:"mt-2"},Se={class:"mt-4"},$e=S({__name:"index",setup(_){const a=i({userID:null,cabinetID:null,orderNo:null,returnReason:null,operationType:"return",date:null,type:null}),y=i([]),x=async()=>{try{const e=await Q();e.data&&Array.isArray(e.data)&&(y.value=e.data)}catch(e){console.error("获取用户数据失败:",e)}},p=i([]),k=async()=>{try{const e=await W();e.data&&Array.isArray(e.data)&&(p.value=e.data)}catch(e){console.error("获取货柜数据失败:",e)}};L(async()=>{await x(),await k(),m()});const I=i([{label:"有单退库",value:"hasOrder"},{label:"无单退库",value:"noOrder"}]),O=i([{label:"近效期",value:"nearExpiry"},{label:"已过期",value:"expired"},{label:"其他",value:"other"}]),l=i({totalItems:100,pageSize:E,currentPage:1}),v=e=>{console.log("当前页码:",e),l.value.currentPage=e},u=i([{title:"序号",key:"index",render:(e,s)=>s+1},{title:"退库单号",key:"orderNo"},{title:"退库人",key:"user.name"},{title:"退库时间",key:"time"},{title:"退库类型",key:"orderType",render:e=>e.orderType==="hasOrder"?"有单退库":"无单退库"},{title:"退库总数",key:"number"},{title:"退库原因",key:"reason",render:e=>{const s={nearExpiry:"近效期",expired:"已过期",other:"其他"},r=e.reason;return s[r]||"其他"}},{title:"退库货柜",key:"cabinet.name"},{title:"操作",key:"actions",render:e=>G(f,{type:"primary",onClick:()=>B(e)},"详情")}]),h=i([]),m=async()=>{console.log("搜索参数:",a.value);try{const e=await V({userID:a.value.userID,cabinetID:a.value.cabinetID,orderNo:a.value.orderNo,returnReason:a.value.returnReason,date:a.value.date?[w(a.value.date[0]).format("YYYY-MM-DD"),w(a.value.date[1]).format("YYYY-MM-DD")]:null,page:l.value.currentPage,pagesize:l.value.pageSize,operationType:T.Return,type:a.value.type});if(e.error){h.value=[],l.value.totalItems=0;return}h.value=e.data.items,l.value.totalItems=e.data.total}catch(e){console.error("获取退库记录列表失败:",e),h.value=[],l.value.totalItems=0}},R=()=>{a.value={userID:null,cabinetID:null,orderNo:null,returnReason:null,operationType:"return",date:null,type:null},m()},Y=()=>{const e=w().startOf("day");a.value.date=[e.valueOf(),e.valueOf()]},z=()=>{const e=w().subtract(1,"day").startOf("day");a.value.date=[e.valueOf(),e.valueOf()]},P=e=>{const s=new Date().setHours(0,0,0,0);return e>s},N=i(!1),C=i({}),B=e=>{C.value=e,N.value=!0},M=()=>{m()};return(e,s)=>($(),J("div",null,[t("div",ve,[o(n(ae),{model:a.value,"label-width":100,"label-placement":"left",inline:""},{default:c(()=>[t("div",me,[t("div",_e,[ye,o(n(D),{value:a.value.userID,"onUpdate:value":s[0]||(s[0]=r=>a.value.userID=r),options:y.value,placeholder:"请选择",style:{width:"180px"}},null,8,["value","options"])]),t("div",he,[fe,o(n(D),{value:a.value.cabinetID,"onUpdate:value":s[1]||(s[1]=r=>a.value.cabinetID=r),options:p.value,placeholder:"请选择",style:{width:"180px"}},null,8,["value","options"])]),t("div",be,[ge,o(n(D),{value:a.value.type,"onUpdate:value":s[2]||(s[2]=r=>a.value.type=r),options:I.value,placeholder:"请选择",style:{width:"180px"}},null,8,["value","options"])]),t("div",we,[De,o(n(D),{value:a.value.returnReason,"onUpdate:value":s[3]||(s[3]=r=>a.value.returnReason=r),options:O.value,placeholder:"请选择",style:{width:"180px"}},null,8,["value","options"])]),t("div",xe,[ke,o(n(ee),{value:a.value.orderNo,"onUpdate:value":s[4]||(s[4]=r=>a.value.orderNo=r),placeholder:"请输入",style:{width:"180px"}},null,8,["value"])]),t("div",Ie,[t("div",Oe,[Re,o(n(te),{value:a.value.date,"onUpdate:value":s[5]||(s[5]=r=>a.value.date=r),type:"daterange",placeholder:"请选择日期范围","disabled-date":P,style:{width:"265px"}},null,8,["value"])]),t("div",Ne,[o(n(f),{type:"primary",style:{"margin-left":"10px"},onClick:Y},{default:c(()=>[d("今日")]),_:1}),o(n(f),{type:"primary",style:{"margin-left":"5px"},onClick:z},{default:c(()=>[d("昨日")]),_:1})])])]),t("div",Ce,[o(n(f),{type:"primary",onClick:m},{default:c(()=>[d("查询")]),_:1}),o(n(f),{type:"primary",style:{"margin-left":"8px"},onClick:R},{default:c(()=>[d("重置")]),_:1})])]),_:1},8,["model"])]),t("div",Te,[o(n(f),{type:"primary",onClick:M},{default:c(()=>[d("刷新")]),_:1})]),t("div",Se,[o(n(U),{columns:u.value,data:h.value},null,8,["columns","data"])]),o(A,{total:l.value.totalItems,"page-size":l.value.pageSize,"current-page":l.value.currentPage,onPageChange:v},null,8,["total","page-size","current-page"]),o(pe,{visible:N.value,"onUpdate:visible":s[6]||(s[6]=r=>N.value=r),rowData:C.value},null,8,["visible","rowData"])]))}});const tt=le($e,[["__scopeId","data-v-7464cc09"]]);export{tt as default};
