import{p as B}from"./table-paginate2.js";import{d as M,r as p,bb as F,an as D,aq as E,ar as o,aw as s,ap as k,ax as h,au as L,eB as P,eC as A,a7 as w,a$ as q,aF as O,bh as R,o as V,ao as j,as as C,eD as K,cc as G,aC as H,aD as J,h as v,eE as Q,eF as W}from"./index.js";import{_ as X}from"./Divider.js";import{a as Y}from"./Dropdown.js";import{_ as Z}from"./FormItem.js";import{_ as ee}from"./Input.js";import{_ as te}from"./Form.js";import{S as ae}from"./Settings.js";import{N as se}from"./Icon.js";import{N as ne}from"./DataTable.js";import{_ as le}from"./_plugin-vue_export-helper.js";import"./use-merged-state.js";import"./use-compitable.js";import"./FocusDetector.js";import"./next-frame-once.js";import"./get.js";import"./format-length.js";import"./ChevronRight.js";import"./Checkbox.js";import"./RadioGroup.js";import"./get-slot.js";const oe={class:"flex justify-end gap-3 px-4 py-3"},ie=M({__name:"editinterface",props:{currentData:{}},emits:["submit","update:show"],setup(y,{expose:N,emit:f}){const _=p(!1),u=p(!1),x=F(),l=p({type:"",interfaceChineseName:"",interfaceName:"",value:"",status:"enable"}),S=[{label:"SPD",value:"spd"},{label:"账号",value:"account"},{label:"密码",value:"password"},{label:"SPD地址",value:"spdAddress"}],d=[{label:"启用",value:"enable"},{label:"停用",value:"stop"}],c=()=>{l.value={type:"",interfaceChineseName:"",interfaceName:"",value:"",status:""}},b=async()=>{var t,a;const e=[{field:"type",label:"接口类型"},{field:"interfaceChineseName",label:"接口中文名称"},{field:"interfaceName",label:"接口名称"},{field:"value",label:"接口值"},{field:"status",label:"接口状态"}].find(n=>!l.value[n.field]);if(e){(t=window.$message)==null||t.error(`请填写${e.label}`);return}try{if(u.value){let{data:n,error:r}=await P({list:[{...l.value,id:l.value.id}]});if(r)return;x.success(n+"")}else{let{data:n,error:r}=await A(l.value);if(r)return;x.success(n+"")}f("submit",l.value),f("update:show",!1),c()}catch(n){(a=window.$message)==null||a.error(u.value?"接口修改失败":"新增接口失败"),console.error("提交失败:",n)}};function $(m){m?(u.value=!0,l.value={...m}):(u.value=!1,c()),f("update:show",!0)}function g(){u.value=!1,_.value=!1,c(),f("update:show",!1)}return N({open:$,close:g}),(m,e)=>{const t=X,a=Y,n=Z,r=ee,z=te,I=w,T=q,U=O;return D(),E(U,{show:_.value,"onUpdate:show":[e[5]||(e[5]=i=>_.value=i),e[6]||(e[6]=i=>m.$emit("update:show",i))]},{default:o(()=>[s(T,{style:{width:"600px"},title:u.value?"编辑接口":"新增接口","header-style":{padding:"20px 24px"},"content-style":{padding:"0 24px 20px"}},{footer:o(()=>[s(t,{class:"!m-0"}),k("div",oe,[s(I,{size:"medium",onClick:g},{default:o(()=>[h("取消")]),_:1}),s(I,{size:"medium",type:"primary",onClick:b},{default:o(()=>[h(L(u.value?"确认修改":"确认添加"),1)]),_:1})])]),default:o(()=>[s(z,{model:l.value,"label-placement":"left","label-width":"120"},{default:o(()=>[s(t,{class:"!mb-6"},{default:o(()=>[h("基础配置")]),_:1}),s(n,{label:"接口类型",required:""},{default:o(()=>[s(a,{value:l.value.type,"onUpdate:value":e[0]||(e[0]=i=>l.value.type=i),options:S,placeholder:"请选择接口类型"},null,8,["value"])]),_:1}),s(n,{label:"接口中文名称",required:""},{default:o(()=>[s(r,{value:l.value.interfaceChineseName,"onUpdate:value":e[1]||(e[1]=i=>l.value.interfaceChineseName=i)},null,8,["value"])]),_:1}),s(n,{label:"接口名称",required:""},{default:o(()=>[s(r,{value:l.value.interfaceName,"onUpdate:value":e[2]||(e[2]=i=>l.value.interfaceName=i)},null,8,["value"])]),_:1}),s(n,{label:"接口值",required:""},{default:o(()=>[s(r,{value:l.value.value,"onUpdate:value":e[3]||(e[3]=i=>l.value.value=i)},null,8,["value"])]),_:1}),s(t,{class:"!mb-6"},{default:o(()=>[h("状态配置")]),_:1}),s(n,{label:"接口状态",required:""},{default:o(()=>[s(a,{value:l.value.status,"onUpdate:value":e[4]||(e[4]=i=>l.value.status=i),options:d,placeholder:"请选择状态"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),re=y=>(H("data-v-77bff28b"),y=y(),J(),y),ue={class:"system-setting p-4"},de={class:"flex items-center"},ce=re(()=>k("h1",{class:"text-xl font-semibold"},"接口管理",-1)),pe={class:"flex justify-end mb-4"},me=M({__name:"index",setup(y){const N=p([]),f=p({totalItems:100,pageSize:B,currentPage:1}),_=R(),u=async e=>{var t;try{_.warning({title:"状态切换确认",content:`确定要${e.status==="enable"?"停用":"启用"}该接口吗？`,positiveText:"确认",negativeText:"取消",onPositiveClick:async()=>{var r;let{data:a,error:n}=await W({id:e.id,status:e.status==="enable"?"stop":"enable"});n||(c(),(r=window.$message)==null||r.success(`${a}`))}})}catch(a){console.log("状态切换失败:",a),(t=window.$message)==null||t.error("操作失败，请检查接口状态")}},x=()=>[{title:"序号",key:"index",render:(t,a)=>a+1},{title:"接口类型",key:"type"},{title:"接口中文名称",key:"interfaceChineseName"},{title:"接口名",key:"interfaceName"},{title:"值",key:"value"},{title:"接口执行状态",key:"status",render:t=>t.status==="stop"?v("span",{style:"color: red;"},"停用"):v("span",{style:"color: #18a058;"},"使用中")},{title:"操作",key:"action",render:t=>v("div",{class:"flex gap-2"},[v(w,{size:"medium",type:"primary",onClick:()=>l(t)},{default:()=>"编辑"}),t.id!==1?v(w,{size:"medium",type:"error",onClick:()=>S(t.id)},{default:()=>"删除"}):null,t.id!==1?v(w,{type:t.status==="enable"?"error":"success",onClick:()=>u(t)},{default:()=>t.status==="enable"?"停用":"启用"}):null])}],l=e=>{var t;N.value=[e.id.toString()],(t=b.value)==null||t.open(e)},S=async e=>{_.warning({title:"删除确认",content:"是否删除此接口？",positiveText:"确认",negativeText:"取消",onPositiveClick:async()=>{var t,a;try{let{data:n,error:r}=await Q({IDlist:[e]});if(r)return;(t=window.$message)==null||t.success(n+""),c()}catch(n){console.error("删除失败:",n),(a=window.$message)==null||a.error("删除操作失败")}}})},d=p([]),c=async()=>{var e;try{const t=await K();t.data&&G(t.data)&&(d.value=t.data.map(a=>({...a,type:a.type,interfaceChineseName:a.interfaceChineseName,status:a.status})),f.value.totalItems=t.data.total||0)}catch(t){console.error("数据加载失败:",t),(e=window.$message)==null||e.error("接口数据加载失败")}};V(()=>{c()});const b=p(),$=()=>{var e;(e=b.value)==null||e.open()},g=p(!1),m=e=>{if(e.id){const t=d.value.findIndex(a=>a.id===e.id);t>-1&&d.value.splice(t,1,e)}else d.value=[...d.value,{id:Date.now(),...e}];c()};return(e,t)=>{const a=q;return D(),j("div",ue,[s(a,null,{default:o(()=>[k("div",de,[s(C(se),{class:"mr-1",size:"23"},{default:o(()=>[s(C(ae))]),_:1}),ce])]),_:1}),s(a,null,{default:o(()=>[k("div",pe,[s(C(w),{type:"primary",class:"mr-2",onClick:$},{default:o(()=>[h("新增")]),_:1})]),s(C(ne),{columns:x(),"row-key":n=>n.id,data:d.value},null,8,["columns","row-key","data"])]),_:1}),s(ie,{ref_key:"editInterfaceRef",ref:b,onSubmit:m,show:g.value,"onUpdate:show":t[0]||(t[0]=n=>g.value=n)},null,8,["show"])])}}});const Be=le(me,[["__scopeId","data-v-77bff28b"]]);export{Be as default};
