import{T as M}from"./table-paginate.js";import{p as A}from"./table-paginate2.js";import{f as O,b as Q,a as W,d as X,U as Y,c as Z}from"./dictionary.js";import{d as I,an as P,ao as S,ap as C,r as y,aq as ee,ar as n,aw as e,as as l,a7 as f,ax as _,a$ as q,aF as ae,h as F,k as te,o as le,az as B,cc as V}from"./index.js";import{a as G,N as k}from"./Grid.js";import{_ as K}from"./Form.js";import{_ as b}from"./FormItem.js";import{N as E}from"./DataTable.js";import{_ as H}from"./Input.js";import{N as ne}from"./Icon.js";import{a as oe,N as se}from"./Dropdown.js";import{_ as re}from"./_plugin-vue_export-helper.js";import"./next-frame-once.js";import"./get-slot.js";import"./format-length.js";import"./get.js";import"./Checkbox.js";import"./use-merged-state.js";import"./RadioGroup.js";import"./FocusDetector.js";import"./ChevronRight.js";import"./use-compitable.js";const ie={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ue=I({name:"CloseOutline",render:function(g,r){return P(),S("svg",ie,r[0]||(r[0]=[C("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M368 368L144 144"},null,-1),C("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M368 144L144 368"},null,-1)]))}}),ce={class:"mb-4 flex gap-2 justify-end"},de={class:"flex justify-between items-center"},pe=C("label",{class:"text-ml"},"添加耗材",-1),me=I({__name:"addDialog",emits:["confirm"],setup(R,{expose:g,emit:r}){const h=y(!1),U=y([]),s=y({code:"",name:"",spec:"",manufacturer:"",brand:"",type:"enable",page:0,pagesize:0}),v=y({totalItems:100,pageSize:A,currentPage:1}),x=y([]),p=async()=>{var m;try{const o=await O({...s.value,page:v.value.currentPage,pagesize:v.value.pageSize});o.data&&(x.value=o.data.items.map(d=>({...d,packageSpec:d.procPkgSpec||"",packageUnit:d.procPkgUnit||"",packageContent:d.procPkgUnitNum||0})),v.value.totalItems=o.data.total,v.value.currentPage=o.data.page,v.value.pageSize=o.data.pagesize)}catch(o){console.error("数据加载失败:",o),(m=window.$message)==null||m.error("数据加载失败")}},D=async m=>{v.value.currentPage=m,await p()},w=[{title:"耗材子编码",key:"subCode"},{title:"耗材名称",key:"name"},{title:"规格型号",key:"specifiacation"},{title:"生产厂家",key:"manufacturer"},{title:"品牌",key:"brand"},{title:"单位",key:"unit"},{title:"销售包装规格",key:"packageSpec"},{title:"销售包装含量",key:"packageContent"},{title:"销售包装单位",key:"packageUnit"},{title:"操作",key:"actions",render:m=>F(f,{type:"primary",text:!0,onClick:()=>z(m)},{default:()=>"添加到本地"})}],N=(m,o)=>{U.value=o},z=async m=>{var o;try{let{data:d,error:$}=await Q({...m});if($)return;r("confirm",[m]),h.value=!1}catch(d){console.error("添加失败:",d),(o=window.$message)==null||o.error("添加失败")}},L=()=>{s.value={code:"",name:"",spec:"",manufacturer:"",brand:"",type:"enable",page:1,pagesize:v.value.pageSize},p()};return g({open:()=>{h.value=!0,p()}}),(m,o)=>{const d=H,$=ne;return P(),ee(l(ae),{show:h.value,"onUpdate:show":o[6]||(o[6]=t=>h.value=t)},{default:n(()=>[e(l(q),{style:{width:"80vw","max-width":"1200px"},title:"添加耗材",bordered:!1},{header:n(()=>[C("div",de,[pe,e($,{class:"cursor-pointer hover:text-gray-600",onClick:o[5]||(o[5]=t=>h.value=!1)},{default:n(()=>[e(l(ue))]),_:1})])]),default:n(()=>[e(l(K),{model:s.value,"label-placement":"left"},{default:n(()=>[e(l(G),{cols:24,"x-gap":24},{default:n(()=>[e(l(k),{span:6},{default:n(()=>[e(l(b),{label:"耗材子编码"},{default:n(()=>[e(d,{value:s.value.code,"onUpdate:value":o[0]||(o[0]=t=>s.value.code=t)},null,8,["value"])]),_:1})]),_:1}),e(l(k),{span:6},{default:n(()=>[e(l(b),{label:"耗材名称"},{default:n(()=>[e(d,{value:s.value.name,"onUpdate:value":o[1]||(o[1]=t=>s.value.name=t)},null,8,["value"])]),_:1})]),_:1}),e(l(k),{span:6},{default:n(()=>[e(l(b),{label:"规格型号"},{default:n(()=>[e(d,{value:s.value.spec,"onUpdate:value":o[2]||(o[2]=t=>s.value.spec=t)},null,8,["value"])]),_:1})]),_:1}),e(l(k),{span:6},{default:n(()=>[e(l(b),{label:"品牌"},{default:n(()=>[e(d,{value:s.value.brand,"onUpdate:value":o[3]||(o[3]=t=>s.value.brand=t)},null,8,["value"])]),_:1})]),_:1}),e(l(k),{span:6},{default:n(()=>[e(l(b),{label:"生产厂家"},{default:n(()=>[e(d,{value:s.value.manufacturer,"onUpdate:value":o[4]||(o[4]=t=>s.value.manufacturer=t)},null,8,["value"])]),_:1})]),_:1})]),_:1}),C("div",ce,[e(l(f),{type:"primary",onClick:p},{default:n(()=>[_("查询")]),_:1}),e(l(f),{type:"default",onClick:L},{default:n(()=>[_("重置")]),_:1})])]),_:1},8,["model"]),e(l(E),{columns:w,data:x.value,"row-key":t=>t.id,"onUpdate:checkedRowKeys":N},null,8,["data","row-key"]),e(M,{total:v.value.totalItems,"page-size":v.value.pageSize,"current-page":v.value.currentPage,onPageChange:D},null,8,["total","page-size","current-page"])]),_:1})]),_:1},8,["show"])}}}),ve={class:"dictionary-view p-4"},ge={class:"mb-4 flex gap-2"},fe={class:"mb-4 flex gap-2 justify-end"},ye={class:"mb-4 flex gap-2 justify-end"},_e=I({__name:"index",setup(R){const g=y("local"),r=y({totalItems:100,pagesize:A,currentPage:1}),h=()=>{console.log("查询参数:",s.value),p()},U=t=>{console.log("当前页码:",t),r.value.currentPage=t,p()},s=y({code:"",name:"",spec:"",type:"",page:r.value.currentPage,pagesize:r.value.pagesize}),v=()=>{const t=[{title:"耗材子编码",key:"subCode"},{title:"耗材名称",key:"name"},{title:"规格型号",key:"specifiacation"},{title:"生产厂家",key:"manufacturer"},{title:"品牌",key:"brand"},{title:"单位",key:"unit"},{title:"销售包装规格",key:"procPkgSpec"},{title:"销售包装单位",key:"procPkgUnit"},{title:"销售包装含量",key:"procPkgUnitNum"},{title:"字典状态",key:"dictionaryStatus",render:a=>F(se,{type:a.dictionaryStatus?"success":"error"},{default:()=>a.dictionaryStatus?"使用中":"停用"})}];return g.value==="local"?[{type:"selection"},...t]:t},x=y([]),p=async()=>{var t;try{if(w.value=[],g.value==="all"){const{data:a,error:u}=await O({...s.value});if(u)return;a.items&&V(a.items)&&(x.value=a.items.map(i=>({...i,dictionaryStatus:i.dictionaryStatus?"enable":"stop"})),r.value.totalItems=a.total,r.value.currentPage=a.page,r.value.pagesize=a.pagesize)}else{const{data:a,error:u}=await W({...s.value});if(u)return;a&&V(a.items)&&(x.value=a.items,r.value.totalItems=a.total),r.value.totalItems=a.total,r.value.currentPage=a.page,r.value.pagesize=a.pagesize}}catch(a){console.error("数据加载失败:",a),(t=window.$message)==null||t.error("数据加载失败")}};te(g,t=>{$(),p()});const D=[{label:"使用中",value:"enable"},{label:"停用",value:"stop"}],w=y([]),N=t=>{w.value=t},z=y(),L=()=>{var t;(t=z.value)==null||t.open()},j=async t=>{var a;try{await p(),w.value=[],(a=window.$message)==null||a.success("添加成功")}catch(u){console.error("数据刷新失败:",u)}},m=()=>{var a,u;if(w.value.length===0){(a=window.$message)==null||a.warning("请选择要删除的内容");return}const t=x.value.filter(i=>w.value.includes(i.id)).map(i=>i.name).join("、");(u=window.$dialog)==null||u.warning({title:"删除确认",content:`是否确认删除耗材「${t}」？`,positiveText:"确认",negativeText:"取消",onPositiveClick:async()=>{var i,c;try{const{data:T,error:J}=await X({idList:w.value});if(J)return;(i=window.$message)==null||i.success(T+""),p(),w.value=[]}catch(T){console.error("删除失败:",T),(c=window.$message)==null||c.error("删除失败")}}})},o=async()=>{var t;(t=window.$dialog)==null||t.warning({title:"同步确认",content:"是否从SPD同步所有耗材信息？",positiveText:"确认",negativeText:"取消",onPositiveClick:async()=>{var a,u;try{const{data:i,error:c}=await Y();if(c)return;(a=window.$message)==null||a.success(i+""),p()}catch(i){console.error("同步失败:",i),(u=window.$message)==null||u.error("同步失败")}}})},d=()=>{var t;(t=window.$dialog)==null||t.warning({title:"清空确认",content:"是否清空所有耗材字典信息？",positiveText:"确认",negativeText:"取消",onPositiveClick:async()=>{var a,u;try{const{data:i,error:c}=await Z();if(c)return;(a=window.$message)==null||a.success(i+""),p()}catch(i){console.error("清空失败:",i),(u=window.$message)==null||u.error("清空失败")}}})};function $(){s.value={code:"",name:"",spec:"",type:"",page:1,pagesize:r.value.pagesize},p()}return le(()=>{p()}),(t,a)=>{const u=H,i=q;return P(),S("div",ve,[C("div",ge,[e(l(f),{type:g.value==="local"?"primary":"default",onClick:a[0]||(a[0]=c=>g.value="local")},{default:n(()=>[_("本地耗材字典")]),_:1},8,["type"]),e(l(f),{type:g.value==="all"?"primary":"default",onClick:a[1]||(a[1]=c=>g.value="all")},{default:n(()=>[_("所有耗材字典")]),_:1},8,["type"])]),e(i,{class:"mb-4"},{default:n(()=>[e(l(K),{model:s.value,"label-placement":"left"},{default:n(()=>[e(l(G),{cols:4,"x-gap":4},{default:n(()=>[e(l(k),{span:1},{default:n(()=>[e(l(b),{label:"耗材子编码"},{default:n(()=>[e(u,{value:s.value.code,"onUpdate:value":a[2]||(a[2]=c=>s.value.code=c),style:{width:"180px"}},null,8,["value"])]),_:1})]),_:1}),e(l(k),{span:1},{default:n(()=>[e(l(b),{label:"耗材名称"},{default:n(()=>[e(u,{value:s.value.name,"onUpdate:value":a[3]||(a[3]=c=>s.value.name=c),style:{width:"180px"}},null,8,["value"])]),_:1})]),_:1}),e(l(k),{span:1},{default:n(()=>[e(l(b),{label:"规格型号"},{default:n(()=>[e(u,{value:s.value.spec,"onUpdate:value":a[4]||(a[4]=c=>s.value.spec=c),style:{width:"180px"}},null,8,["value"])]),_:1})]),_:1}),e(l(k),{span:1},{default:n(()=>[e(l(b),{label:"字典状态"},{default:n(()=>[e(l(oe),{value:s.value.type,"onUpdate:value":a[5]||(a[5]=c=>s.value.type=c),options:D,style:{width:"180px"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),C("div",fe,[e(l(f),{type:"primary",onClick:h},{default:n(()=>[_("查询")]),_:1}),e(l(f),{type:"default",onClick:$},{default:n(()=>[_("重置")]),_:1})])]),_:1},8,["model"])]),_:1}),C("div",ye,[g.value==="local"?(P(),S(B,{key:0},[e(l(f),{type:"primary",onClick:L},{default:n(()=>[_("添加")]),_:1}),e(l(f),{type:"error",onClick:m},{default:n(()=>[_("删除")]),_:1})],64)):(P(),S(B,{key:1},[e(l(f),{type:"primary",onClick:o},{default:n(()=>[_("同步")]),_:1}),e(l(f),{type:"warning",onClick:d},{default:n(()=>[_("清空")]),_:1})],64))]),e(l(E),{columns:v(),"row-key":c=>c.id,data:x.value,"onUpdate:checkedRowKeys":N},null,8,["columns","row-key","data"]),e(M,{total:r.value.totalItems,"page-size":r.value.pagesize,"current-page":r.value.currentPage,onPageChange:U},null,8,["total","page-size","current-page"]),e(me,{ref_key:"addDialogRef",ref:z,onConfirm:j},null,512)])}}});const Oe=re(_e,[["__scopeId","data-v-00b869e6"]]);export{Oe as default};
