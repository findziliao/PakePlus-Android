import{T as U}from"./table-paginate.js";import{p as z}from"./table-paginate2.js";import{d as N}from"./warning.js";import{d as P,r as i,o as g,bK as b,an as A,ao as M,ap as a,aw as s,ar as c,as as o,a7 as v,ax as _,au as B,bS as O,bT as V,aC as j,aD as q}from"./index.js";import{_ as E}from"./DatePicker.js";import{a as D}from"./Dropdown.js";import{_ as w}from"./Input.js";import{_ as F}from"./Form.js";import{N as H}from"./DataTable.js";import{_ as K}from"./_plugin-vue_export-helper.js";import"./TimePicker.js";import"./FocusDetector.js";import"./next-frame-once.js";import"./use-merged-state.js";import"./use-compitable.js";import"./get.js";import"./format-length.js";import"./Icon.js";import"./ChevronRight.js";import"./Checkbox.js";import"./RadioGroup.js";import"./get-slot.js";const p=m=>(j("data-v-bf085497"),m=m(),q(),m),$={class:"query-area"},G={class:"grid grid-cols-4 gap-4"},J={class:"flex items-center"},L=p(()=>a("label",{class:"mr-2",style:{width:"5rem"}},"取用人",-1)),Q={class:"flex items-center"},R=p(()=>a("label",{class:"mr-2",style:{width:"5rem"}},"取用货柜",-1)),W={class:"flex items-center"},X=p(()=>a("label",{class:"mr-2",style:{width:"5rem"}},"耗材名称",-1)),Z={class:"flex items-center"},ee=p(()=>a("label",{class:"mr-2",style:{width:"5rem"}},"唯一码",-1)),te={class:"flex items-center"},ae=p(()=>a("label",{class:"mr-2",style:{width:"5rem"}},"取用时间",-1)),le={class:"flex justify-end mt-18"},se={class:"table-area"},oe={class:"mr-2",style:{width:"5rem",color:"#797979"}},ne=P({__name:"index",setup(m){const t=i({cabinetID:null,name:null,userID:null,rfid:null,date:null}),y=i([]),f=async()=>{try{const e=await O();e.data&&Array.isArray(e.data)&&(y.value=e.data)}catch(e){console.error("获取用户数据失败:",e)}};g(async()=>{await f(),d()});const h=i([]),x=async()=>{try{const e=await V();e.data&&Array.isArray(e.data)&&(h.value=e.data)}catch(e){console.error("获取货柜数据失败:",e)}};g(async()=>{await f(),await x(),d()});const n=i({totalItems:100,pageSize:z,currentPage:1}),I=e=>{console.log("当前页码:",e),n.value.currentPage=e,d()},k=i([{title:"耗材子编码",key:"code"},{title:"耗材名称",key:"name"},{title:"规格型号",key:"spec"},{title:"生产厂家",key:"manufacturer"},{title:"唯一码",key:"rfid"},{title:"批号",key:"batch"},{title:"取用人",key:"user.name"},{title:"取用时间",key:"time"},{title:"取用货柜",key:"cabinetName"},{title:"数量",key:"number"}]),u=i([]),d=async()=>{console.log("搜索参数:",t.value);try{const e=await N({userID:t.value.userID,cabinetID:t.value.cabinetID,name:t.value.name,rfid:t.value.rfid,date:t.value.date?[b(t.value.date[0]).format("YYYY-MM-DD"),b(t.value.date[1]).format("YYYY-MM-DD")]:[],page:n.value.currentPage,pagesize:n.value.pageSize});if(e.error){u.value=[],n.value.totalItems=0;return}console.log("接口返回 items:",e.data.items),u.value=e.data.items,n.value.totalItems=e.data.total}catch(e){console.error("获取取用记录列表失败:",e),u.value=[],n.value.totalItems=0}},C=()=>{t.value={cabinetID:null,name:null,userID:null,rfid:null,date:null},d()},S=()=>{const e=new Date().getTime();t.value.date=[e,e]},T=()=>{const e=new Date;e.setDate(e.getDate()-1),t.value.date=[e.getTime(),e.getTime()]},Y=e=>{const l=new Date().setHours(0,0,0,0);return e>l};return(e,l)=>(A(),M("div",null,[a("div",$,[s(o(F),{model:t.value,"label-width":100,"label-placement":"left",inline:""},{default:c(()=>[a("div",G,[a("div",J,[L,s(o(D),{value:t.value.userID,"onUpdate:value":l[0]||(l[0]=r=>t.value.userID=r),options:y.value,placeholder:"请选择取用人",style:{width:"180px"}},null,8,["value","options"])]),a("div",Q,[R,s(o(D),{value:t.value.cabinetID,"onUpdate:value":l[1]||(l[1]=r=>t.value.cabinetID=r),options:h.value,placeholder:"请选择取用货柜",style:{width:"180px"}},null,8,["value","options"])]),a("div",W,[X,s(o(w),{value:t.value.name,"onUpdate:value":l[2]||(l[2]=r=>t.value.name=r),placeholder:"请输入耗材名称",style:{width:"180px"}},null,8,["value"])]),a("div",Z,[ee,s(o(w),{value:t.value.rfid,"onUpdate:value":l[3]||(l[3]=r=>t.value.rfid=r),placeholder:"请输入唯一码",style:{width:"180px"}},null,8,["value"])]),a("div",te,[ae,s(o(E),{value:t.value.date,"onUpdate:value":l[4]||(l[4]=r=>t.value.date=r),type:"daterange",placeholder:"请选择日期范围","disabled-date":Y,style:{width:"245px"}},null,8,["value"])]),a("div",null,[s(o(v),{type:"primary",onClick:S,class:"mx-2"},{default:c(()=>[_("今天")]),_:1}),s(o(v),{type:"primary",onClick:T},{default:c(()=>[_("昨天")]),_:1})])]),a("div",le,[s(o(v),{type:"primary",onClick:d},{default:c(()=>[_("查询")]),_:1}),s(o(v),{type:"primary",style:{"margin-left":"10px"},onClick:C},{default:c(()=>[_("重置")]),_:1})])]),_:1},8,["model"])]),a("div",se,[a("div",null,[a("label",oe," 未归还耗材数："+B(u.value.length),1)]),s(o(H),{columns:k.value,data:u.value},null,8,["columns","data"]),s(U,{total:n.value.totalItems,"page-size":n.value.pageSize,"current-page":n.value.currentPage,onPageChange:I},null,8,["total","page-size","current-page"])])]))}});const Ye=K(ne,[["__scopeId","data-v-bf085497"]]);export{Ye as default};
