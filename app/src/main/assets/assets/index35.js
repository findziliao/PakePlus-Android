import{T as H}from"./table-paginate.js";import{p as q}from"./table-paginate2.js";import{j as F,m as K}from"./record.js";import{d as U,r as i,k as L,an as $,aq as N,ar as u,aw as o,ap as t,ax as c,au as g,as as n,aB as Q,a$ as G,a7 as y,aF as E,o as J,h as M,bK as D,ao as W,bS as X,bT as Z,aC as ee,aD as te}from"./index.js";import{N as Y}from"./DataTable.js";import{a as O}from"./Dropdown.js";import{_ as ae}from"./DatePicker.js";import{_ as le}from"./Form.js";import{_ as se}from"./Input.js";import{_ as oe}from"./_plugin-vue_export-helper.js";import"./format-length.js";import"./Checkbox.js";import"./use-merged-state.js";import"./RadioGroup.js";import"./get-slot.js";import"./FocusDetector.js";import"./next-frame-once.js";import"./get.js";import"./ChevronRight.js";import"./use-compitable.js";import"./Icon.js";import"./TimePicker.js";const ne=t("div",{class:"flex justify-between items-center w-full"},[t("h2",{class:"text-xl font-bold"},"申领详情")],-1),re={class:"grid grid-cols-2 gap-4"},ie=t("strong",null,"申领人:",-1),ue=t("strong",null,"申领单号:",-1),ce=t("strong",null,"申领类型:",-1),de=t("strong",null,"申领结果:",-1),pe=t("strong",null,"申领时间:",-1),me={class:"flex justify-end mt-4"},ve=U({__name:"dialog",props:{visible:{type:Boolean},rowData:{}},emits:["update:visible","submit","cancel"],setup(h,{emit:a}){const f=h,p=i({items:[]}),x=async l=>{var m;try{const d=await F({ID:l});if(d.error){p.value.items=[];return}p.value.items=((m=d.data)==null?void 0:m.items)||[]}catch(d){console.error("获取详情失败:",d),p.value.items=[]}},b=[{title:"耗材子编码",key:"code"},{title:"耗材名称",key:"name"},{title:"规格型号",key:"spec"},{title:"生产厂家",key:"manufacturer"},{title:"品牌",key:"brand"},{title:"单位",key:"unit"},{title:"当时库存量",key:"stockQuantity"},{title:"申领数量",key:"applyNumber"}];L(()=>f.visible,(l,m)=>{if(l&&!m&&f.rowData){const d=Number(f.rowData.id);x(d)}else l||(p.value.items=[])});const w=()=>{a("update:visible",!1),a("cancel")},T=()=>{console.log("执行重新申领操作")};return(l,m)=>{const d=G,v=y,_=E;return $(),N(_,{show:l.visible,"onUpdate:show":w,preset:"card",closable:"",style:{width:"80%",height:"45rem",margin:"0 auto"}},{header:u(()=>[ne]),default:u(()=>[o(d,null,{default:u(()=>[t("div",re,[t("div",null,[ie,c(" "+g(l.rowData.userName),1)]),t("div",null,[ue,c(" "+g(l.rowData.applyNo),1)]),t("div",null,[ce,c(" "+g(l.rowData.type==="manual"?"手动申领":"自动申领"),1)]),t("div",null,[de,c(" "+g(l.rowData.result==="true"?"成功":"失败"),1)]),t("div",null,[pe,c(" "+g(l.rowData.created_at),1)])]),o(n(Y),{columns:b,data:p.value.items,style:{"margin-top":"20px"},"max-height":415},null,8,["data"])]),_:1}),t("div",me,[o(v,{onClick:w},{default:u(()=>[c("返回")]),_:1}),l.rowData.result!=="true"?($(),N(v,{key:0,type:"primary",style:{"margin-left":"10px"},onClick:T},{default:u(()=>[c("重新申领")]),_:1})):Q("",!0)])]),_:1},8,["show"])}}});const k=h=>(ee("data-v-9ba586e2"),h=h(),te(),h),_e={class:"query-area"},ye={class:"grid grid-cols-5 gap-6"},he={class:"flex items-center"},fe=k(()=>t("label",{class:"mr-2",style:{width:"4rem"}},"异常类型",-1)),ge={class:"flex items-center"},be=k(()=>t("label",{class:"mr-2",style:{width:"4rem"}},"货柜",-1)),we={class:"flex items-center"},De=k(()=>t("label",{class:"mr-2",style:{width:"4rem"}},"处理方式",-1)),ke={class:"flex items-center"},xe={class:"flex items-center"},Te=k(()=>t("label",{class:"mr-2",style:{width:"4rem"}},"处理日期",-1)),Ie={class:"flex items-center ml-4"},Ce={class:"flex justify-end mt-18"},Me={class:"mt-2"},Oe={class:"mt-4"},$e=U({__name:"index",setup(h){const a=i({ErrorType:null,handlingMethod:null,cabinetID:null,date:null}),f=i([{label:"超量",value:"excess"},{label:"缺失",value:"shortage"}]),p=i([]),x=async()=>{try{const e=await X();e.data&&Array.isArray(e.data)&&(p.value=e.data)}catch(e){console.error("获取用户数据失败:",e)}},b=i([]),w=async()=>{try{const e=await Z();e.data&&Array.isArray(e.data)&&(b.value=e.data)}catch(e){console.error("获取货柜数据失败:",e)}};J(async()=>{await x(),await w(),_()});const T=i([{label:"取走耗材",value:"takeAway"},{label:"修正记录",value:"correctRecord"},{label:"放回耗材",value:"return"}]),l=i({totalItems:100,pageSize:q,currentPage:1}),m=e=>{l.value.currentPage=e,_()},d=i([{title:"货柜名称",key:"cabinet.name"},{title:"耗材名称",key:"name"},{title:"唯一码",key:"rfid"},{title:"异常类型",key:"errorType",render:e=>M("span",{excess:"超量",shortage:"缺失"}[e.errorType])},{title:"盘点时间",key:"callInventoryTime"},{title:"处理方式",key:"handlingMethod",render:e=>M("span",{takeAway:"取走耗材",correctRecord:"修正记录",return:"放回耗材"}[e.handleType])},{title:"说明",key:"description",render:e=>M(y,{type:"info",size:"small",onClick:()=>V(e)},"查看")},{title:"处理人员",key:"user.name"},{title:"处理时间",key:"handleTime"}]),v=i([]),_=async()=>{try{const e=await K({cabinet:a.value.cabinetID?{id:a.value.cabinetID}:{id:0},errorType:a.value.ErrorType,handleType:a.value.handlingMethod,date:a.value.date?[D(a.value.date[0]).format("YYYY-MM-DD"),D(a.value.date[1]).format("YYYY-MM-DD")]:null,page:l.value.currentPage,pagesize:l.value.pageSize});if(e.error){v.value=[],l.value.totalItems=0;return}v.value=e.data.items,l.value.totalItems=e.data.total}catch(e){console.error("获取盘点异常处理记录列表失败:",e),v.value=[],l.value.totalItems=0}},z=()=>{a.value={ErrorType:null,handlingMethod:null,cabinetID:null,date:null},_()},P=()=>{const e=D().startOf("day");a.value.date=[e.valueOf(),e.valueOf()]},R=()=>{const e=D().subtract(1,"day").startOf("day");a.value.date=[e.valueOf(),e.valueOf()]},A=e=>{const s=new Date().setHours(0,0,0,0);return e>s},S=i(!1),I=i(!1),C=i(""),B=i({}),V=e=>{C.value=e.description||"这是一个模拟的校正说明内容。在本次盘点异常处理中，系统检测到库存数据与实际情况存在差异。经过人工核实和校正，已对相关数据进行了调整和修正，确保库存信息的准确性。处理过程严格按照标准操作流程执行。",I.value=!0},j=()=>{_()};return(e,s)=>($(),W("div",null,[t("div",_e,[o(n(le),{model:a.value,"label-width":100,"label-placement":"left",inline:""},{default:u(()=>[t("div",ye,[t("div",he,[fe,o(n(O),{value:a.value.ErrorType,"onUpdate:value":s[0]||(s[0]=r=>a.value.ErrorType=r),options:f.value,placeholder:"请选择",style:{width:"180px"}},null,8,["value","options"])]),t("div",ge,[be,o(n(O),{value:a.value.cabinetID,"onUpdate:value":s[1]||(s[1]=r=>a.value.cabinetID=r),options:b.value,placeholder:"请选择",style:{width:"180px"}},null,8,["value","options"])]),t("div",we,[De,o(n(O),{value:a.value.handlingMethod,"onUpdate:value":s[2]||(s[2]=r=>a.value.handlingMethod=r),options:T.value,placeholder:"请选择",style:{width:"180px"}},null,8,["value","options"])]),t("div",ke,[t("div",xe,[Te,o(n(ae),{value:a.value.date,"onUpdate:value":s[3]||(s[3]=r=>a.value.date=r),type:"daterange",placeholder:"请选择日期范围","disabled-date":A,style:{width:"265px"}},null,8,["value"])]),t("div",Ie,[o(n(y),{type:"primary",style:{"margin-left":"10px"},onClick:P},{default:u(()=>[c("今日")]),_:1}),o(n(y),{type:"primary",style:{"margin-left":"5px"},onClick:R},{default:u(()=>[c("昨日")]),_:1})])])]),t("div",Ce,[o(n(y),{type:"primary",onClick:_},{default:u(()=>[c("查询")]),_:1}),o(n(y),{type:"primary",style:{"margin-left":"8px"},onClick:z},{default:u(()=>[c("重置")]),_:1})])]),_:1},8,["model"])]),t("div",Me,[o(n(y),{type:"primary",onClick:j},{default:u(()=>[c("刷新")]),_:1})]),t("div",Oe,[o(n(Y),{columns:d.value,data:v.value},null,8,["columns","data"])]),o(H,{total:l.value.totalItems,"page-size":l.value.pageSize,"current-page":l.value.currentPage,onPageChange:m},null,8,["total","page-size","current-page"]),o(ve,{visible:S.value,"onUpdate:visible":s[4]||(s[4]=r=>S.value=r),rowData:B.value},null,8,["visible","rowData"]),o(n(E),{show:I.value,"onUpdate:show":s[6]||(s[6]=r=>I.value=r),preset:"card",title:"校正说明",style:{width:"600px"}},{default:u(()=>[o(n(se),{value:C.value,"onUpdate:value":s[5]||(s[5]=r=>C.value=r),rows:8,readonly:"",placeholder:"暂无说明内容"},null,8,["value"])]),_:1},8,["show"])]))}});const Ze=oe($e,[["__scopeId","data-v-9ba586e2"]]);export{Ze as default};
