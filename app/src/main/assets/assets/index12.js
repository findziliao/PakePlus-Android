import{T as $}from"./table-paginate.js";import{p as S}from"./table-paginate2.js";import{d as D,r as p,k as z,an as C,aq as P,ar as s,aw as t,ap as f,ax as y,a7 as M,a$ as B,aF as N,o as T,h as k,ao as U,au as I}from"./index.js";import{_ as O}from"./Input.js";import{_ as q}from"./FormItem.js";import{a as x}from"./Dropdown.js";import{_ as A}from"./Form.js";import{b as R,c as L}from"./warning.js";import{N as j}from"./DataTable.js";import{_ as E}from"./_plugin-vue_export-helper.js";import"./use-merged-state.js";import"./format-length.js";import"./get.js";import"./use-compitable.js";import"./FocusDetector.js";import"./next-frame-once.js";import"./Icon.js";import"./ChevronRight.js";import"./Checkbox.js";import"./RadioGroup.js";import"./get-slot.js";const F={class:"flex justify-end gap-4"},H=D({__name:"dialog",props:{visible:{type:Boolean},rowData:{}},emits:["update:visible","submit","cancel"],setup(w,{emit:n}){const g=w,i=p({id:0,uniqueCode:"",name:"",subCode:"",spec:"",handlingMethod:null}),h=[{label:"协商退回",value:"negotiateReturn"},{label:"本次允许",value:"thisTimeAllowed"}];z(()=>g.rowData,e=>{e&&(i.value={id:e.id,uniqueCode:e.uniqueCode,name:e.name,subCode:e.code,spec:e.spec,handlingMethod:null})});const u=()=>{n("update:visible",!1),n("cancel")},v=()=>{var e;if(!i.value.handlingMethod){(e=window.$message)==null||e.error("请选择处理方式");return}n("submit",{id:g.rowData.id,handlingMethod:i.value.handlingMethod}),u()};return(e,o)=>{const c=O,d=q,b=x,a=M,r=A,m=B,_=N;return C(),P(_,{show:e.visible},{default:s(()=>[t(m,{style:{width:"600px"},title:"越权取用处理"},{default:s(()=>[t(r,{model:i.value,"label-placement":"left","label-width":100},{default:s(()=>[t(d,{label:"唯一码"},{default:s(()=>[t(c,{value:e.rowData.rfid,"onUpdate:value":o[0]||(o[0]=l=>e.rowData.rfid=l),disabled:""},null,8,["value"])]),_:1}),t(d,{label:"耗材名称"},{default:s(()=>[t(c,{value:e.rowData.name,"onUpdate:value":o[1]||(o[1]=l=>e.rowData.name=l),disabled:""},null,8,["value"])]),_:1}),t(d,{label:"耗材子编码"},{default:s(()=>[t(c,{value:e.rowData.code,"onUpdate:value":o[2]||(o[2]=l=>e.rowData.code=l),disabled:""},null,8,["value"])]),_:1}),t(d,{label:"规格型号"},{default:s(()=>[t(c,{value:e.rowData.spec,"onUpdate:value":o[3]||(o[3]=l=>e.rowData.spec=l),disabled:""},null,8,["value"])]),_:1}),t(d,{label:"处理方式"},{default:s(()=>[t(b,{value:i.value.handlingMethod,"onUpdate:value":o[4]||(o[4]=l=>i.value.handlingMethod=l),options:h,placeholder:"请选择处理方式"},null,8,["value"])]),_:1}),f("div",F,[t(a,{onClick:u},{default:s(()=>[y("取消")]),_:1}),t(a,{type:"primary",onClick:v},{default:s(()=>[y("提交")]),_:1})])]),_:1},8,["model"])]),_:1})]),_:1},8,["show"])}}}),G={class:"table-area"},J={class:"mr-2",style:{width:"5rem",color:"#797979"}},K=D({__name:"index",setup(w){const n=p({totalItems:100,pageSize:S,currentPage:1}),g=p({});T(()=>{v()});const i=a=>{console.log("当前页码:",a),n.value.currentPage=a,v()},h=p([{title:"耗材子编码",key:"code"},{title:"耗材名称",key:"name"},{title:"规格型号",key:"spec"},{title:"品牌",key:"brand"},{title:"单位",key:"unit"},{title:"唯一码",key:"rfid"},{title:"批号",key:"batch"},{title:"生产厂家",key:"manufacturer"},{title:"操作人",key:"user.name"},{title:"处理方式",key:"handlingMethod",render:a=>k("span",{negotiateReturn:"协商退回",thisTimeAllowed:"本次允许"}[a.handlingMethod])},{title:"操作",key:"actions",render(a){return k(M,{type:"primary",onClick:()=>c(a)},"处理")}}]),u=p([]),v=async()=>{try{const a=await R({page:n.value.currentPage,pagesize:n.value.pageSize,...g.value});a.data&&(u.value=a.data.items,n.value.totalItems=a.data.total)}catch(a){console.error("获取预警列表失败:",a),u.value=[],n.value.totalItems=0}},e=p(!1),o=p({}),c=a=>{o.value=a,e.value=!0},d=async a=>{var r,m;try{(await L({id:a.id,handlingMethod:a.handlingMethod})).error||((r=window.$message)==null||r.success("处理成功"),v())}catch(_){const l=_;(m=window.$message)==null||m.error(l.message||`请求失败 (${l.status||"无状态码"})`)}},b=()=>{e.value=!1};return(a,r)=>{const m=j;return C(),U("div",null,[f("div",G,[f("div",null,[f("label",J," 越权取用数量："+I(u.value.length),1)]),t(m,{columns:h.value,data:u.value},null,8,["columns","data"]),t($,{total:n.value.totalItems,"page-size":n.value.pageSize,"current-page":n.value.currentPage,onPageChange:i},null,8,["total","page-size","current-page"])]),t(H,{visible:e.value,"onUpdate:visible":r[0]||(r[0]=_=>e.value=_),"row-data":o.value,onSubmit:d,onCancel:b},null,8,["visible","row-data"])])}}});const ve=E(K,[["__scopeId","data-v-1c692cc3"]]);export{ve as default};
