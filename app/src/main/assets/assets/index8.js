import{b as oe}from"./dark-mode-switch.vue_vue_type_script_setup_true_lang.js";/* empty css                                                */import{aG as V,r as k,l as P,b0 as ne,b1 as ae,d as D,aS as T,aP as W,b2 as q,an as b,aq as B,ar as u,aw as s,as as g,ax as L,au as w,ap as o,a7 as G,b3 as se,ay as C,b4 as le,o as O,b5 as ie,C as re,ao as E,aB as j,aC as X,aD as Z,b6 as ce,aj as de,b7 as ue,b8 as pe,b9 as me,aJ as _e,T as ge,aQ as fe,a4 as F,aK as A,ba as x,aE as ve,a$ as he}from"./index.js";import{_ as we,a as ye}from"./account(x1).js";import{_ as J}from"./Input.js";import{_ as K}from"./FormItem.js";import{_ as Q}from"./Form.js";import{_ as Y}from"./Space.js";import{_ as M}from"./_plugin-vue_export-helper.js";import{N as xe}from"./Icon.js";import{_ as ke}from"./GradientText.js";import"./use-merged-state.js";import"./format-length.js";import"./get.js";import"./get-slot.js";import"./use-houdini.js";function be(n=!1){const{bool:_,setTrue:c,setFalse:a}=V(n);return{loading:_,startLoading:c,endLoading:a}}function Ce(n){if(n<=0&&n%1!==0)throw new Error("倒计时的时间应该为一个正整数！");const{bool:_,setTrue:c,setFalse:a}=V(!1),r=k(0),p=P(()=>!!r.value);let v;function d(h=n){r.value||(a(),r.value=h,v=setInterval(()=>{r.value-=1,r.value<=0&&(clearInterval(v),c())},1e3))}function m(){v=clearInterval(v),r.value=0}return ne(m),{counts:r,isCounting:p,start:d,stop:m,isComplete:_}}const ee=/^[1](([3][0-9])|([4][01456789])|([5][012356789])|([6][2567])|([7][0-8])|([8][0-9])|([9][012356789]))[0-9]{8}$/,$e=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,Se=/^(?![0-9]+$)(?![a-z]+$)(?![A-Z]+$)(?!([^(0-9a-zA-Z)]|[()])+$)(?!^.*[\u4E00-\u9FA5].*$)([^(0-9a-zA-Z)]|[()]|[a-z]|[A-Z]|[0-9]){6,18}$/,ze=/^\d{6}$/;function Pe(){const{loading:n,startLoading:_,endLoading:c}=be(),{counts:a,start:r,isCounting:p}=Ce(60),v="获取验证码",d=l=>`${l}秒后重新获取`,m=P(()=>{let l=v;return n.value&&(l=""),p.value&&(l=d(a.value)),l});function h(l){var i,f;let e=!0;return l.trim()===""?((i=window.$message)==null||i.error("手机号码不能为空！"),e=!1):ee.test(l)||((f=window.$message)==null||f.error("手机号码格式错误！"),e=!1),e}async function t(l){var f;if(!h(l)||n.value)return;_();const{data:i}=await ae(l);i&&((f=window.$message)==null||f.success("验证码发送成功！"),r()),c()}return{label:m,start:r,isCounting:p,getSmsCode:t,loading:n}}const U=(n="不能为空")=>({required:!0,message:n}),R={phone:[U("请输入手机号码"),{pattern:ee,message:"手机号码格式错误",trigger:"input"}],pwd:[U("请输入密码"),{pattern:Se,message:"密码为6-18位数字/字符/符号，至少2种组合",trigger:"input"}],code:[U("请输入验证码"),{pattern:ze,message:"验证码格式错误",trigger:"input"}],email:[{pattern:$e,message:"邮箱格式错误",trigger:"blur"}]};function Le(n){return n.trim()===""}function Ee(n){return[{required:!0,message:"请输入确认密码"},{validator:(c,a)=>!Le(a)&&a!==n.value?Promise.reject(c.message):Promise.resolve(),message:"输入的值与密码不一致",trigger:"input"}]}const Fe="/soy-admin/highvalue/login-background.png",te="/soy-admin/highvalue/fingerprint(x1).png",Ae="/soy-admin/highvalue/nfc(x1).png",Ie=o("div",{class:"flex-y-center justify-between"},null,-1),Re=D({__name:"index",setup(n){const _=T(),{login:c}=T();W();const a=k(),r=q({userName:"",password:""}),p={password:R.pwd};k(!1);async function v(){var h;await((h=a.value)==null?void 0:h.validate());const{userName:d,password:m}=r;c(d,m)}return(d,m)=>{const h=J,t=K,l=G,e=Y,i=Q;return b(),B(i,{ref_key:"formRef",ref:a,model:r,rules:p,size:"large","show-label":!1},{default:u(()=>[s(t,{path:"userName"},{default:u(()=>[s(h,{value:r.userName,"onUpdate:value":m[0]||(m[0]=f=>r.userName=f),placeholder:d.$t("page.login.common.userNamePlaceholder")},null,8,["value","placeholder"])]),_:1}),s(t,{path:"password"},{default:u(()=>[s(h,{value:r.password,"onUpdate:value":m[1]||(m[1]=f=>r.password=f),type:"password","show-password-on":"click",placeholder:d.$t("page.login.common.passwordPlaceholder")},null,8,["value","placeholder"])]),_:1}),s(e,{vertical:!0,size:24},{default:u(()=>[s(l,{type:"primary",size:"medium",style:{"min-width":"80px !important"},block:!0,round:!0,loading:g(_).loginLoading,onClick:v},{default:u(()=>[L(w(d.$t("page.login.common.confirm")),1)]),_:1},8,["loading"]),Ie]),_:1})]),_:1},8,["model"])}}}),De={class:"flex-y-center w-full"},Me=o("div",{class:"w-18px"},null,-1),H=D({__name:"index",setup(n){const{toLoginModule:_}=W(),{label:c,isCounting:a,loading:r,start:p}=Pe(),v=k(),d=q({phone:"",code:"",pwd:"",confirmPwd:""}),m={phone:R.phone,code:R.code,pwd:R.pwd,confirmPwd:Ee(se(d).pwd)};function h(){p()}async function t(){var l,e;await((l=v.value)==null?void 0:l.validate()),(e=window.$message)==null||e.success(C("page.login.common.validateSuccess"))}return(l,e)=>{const i=J,f=K,S=G,I=Y,z=Q;return b(),B(z,{ref_key:"formRef",ref:v,model:d,rules:m,size:"large","show-label":!1},{default:u(()=>[s(f,{path:"phone"},{default:u(()=>[s(i,{value:d.phone,"onUpdate:value":e[0]||(e[0]=y=>d.phone=y),placeholder:g(C)("page.login.common.phonePlaceholder")},null,8,["value","placeholder"])]),_:1}),s(f,{path:"code"},{default:u(()=>[o("div",De,[s(i,{value:d.code,"onUpdate:value":e[1]||(e[1]=y=>d.code=y),placeholder:g(C)("page.login.common.codePlaceholder")},null,8,["value","placeholder"]),Me,s(S,{size:"large",disabled:g(a),loading:g(r),onClick:h},{default:u(()=>[L(w(g(c)),1)]),_:1},8,["disabled","loading"])])]),_:1}),s(f,{path:"pwd"},{default:u(()=>[s(i,{value:d.pwd,"onUpdate:value":e[2]||(e[2]=y=>d.pwd=y),type:"password","show-password-on":"click",placeholder:g(C)("page.login.common.passwordPlaceholder")},null,8,["value","placeholder"])]),_:1}),s(f,{path:"confirmPwd"},{default:u(()=>[s(i,{value:d.confirmPwd,"onUpdate:value":e[3]||(e[3]=y=>d.confirmPwd=y),type:"password","show-password-on":"click",placeholder:g(C)("page.login.common.confirmPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1}),s(I,{vertical:!0,size:"large"},{default:u(()=>[s(S,{type:"primary",size:"large",block:!0,round:!0,onClick:t},{default:u(()=>[L(w(g(C)("page.login.common.confirm")),1)]),_:1}),s(S,{size:"large",block:!0,round:!0,onClick:e[4]||(e[4]=y=>g(_)("pwd-login"))},{default:u(()=>[L(w(g(C)("page.login.common.back")),1)]),_:1})]),_:1})]),_:1},8,["model"])}}}),Ne=n=>(X("data-v-44701a2e"),n=n(),Z(),n),Ue=Ne(()=>o("h3",null,"人脸登录",-1)),Te={key:0},Be={key:1,class:"error-message"},je={style:{position:"relative","margin-top":"-60px"}},He=D({__name:"index",setup(n){T(),le();const _=k(!1),c=k(""),a=k(null),r=k(null);let p=null;const v=async()=>{try{p=await navigator.mediaDevices.getUserMedia({video:!0}),a.value&&(a.value.srcObject=p)}catch{c.value="无法打开摄像头，请检查设备权限"}},d=()=>{p&&(p.getTracks().forEach(t=>t.stop()),p=null)};let m="";const h=async()=>{if(!_.value){_.value=!0,c.value="";try{if(a.value){const t=document.createElement("canvas");t.width=a.value.videoWidth,t.height=a.value.videoHeight;const l=t.getContext("2d");if(l){l.drawImage(a.value,0,0,t.width,t.height);const e=t.toDataURL("image/jpeg",.8);if(e===m){console.log("检测到相同人脸，跳过请求");return}m=e,console.log("开始人脸识别")}}}catch{c.value="人脸识别失败，请重试"}finally{_.value=!1}}};return O(()=>{ie(),v(),a.value&&r.value&&a.value.addEventListener("loadedmetadata",()=>{a.value&&a.value.videoWidth,a.value&&a.value.videoHeight;const t=r.value,l=t?parseInt(getComputedStyle(t).width,10):0,e=t?parseInt(getComputedStyle(t).height,10):0;t&&(t.width=l,t.height=e)}),h()}),re(()=>{d()}),(t,l)=>(b(),E("div",null,[Ue,_.value?(b(),E("div",Te,"识别中...")):j("",!0),c.value?(b(),E("div",Be,w(c.value),1)):j("",!0),o("div",je,[o("video",{ref_key:"videoElement",ref:a,autoplay:"",playsinline:""},null,512),o("canvas",{ref_key:"canvasElement",ref:r,style:{position:"absolute",top:"0",left:"0",width:"90%",height:"90%"}},null,512)])]))}});const Ve=M(He,[["__scopeId","data-v-44701a2e"]]),We={},qe={style:{background:"linear-gradient(to right, #CADFFF, #1A469A)","-webkit-background-clip":"text",color:"transparent","font-size":"16px"}};function Ge(n,_){return b(),E("div",qe,"请将手指放在指静脉模块上")}const Oe=M(We,[["render",Ge]]),Xe={},Ze={style:{background:"linear-gradient(to right, #CADFFF, #1A469A)","-webkit-background-clip":"text",color:"transparent","font-size":"16px"}};function Je(n,_){return b(),E("div",Ze,"请将手指放在指纹模块上")}const Ke=M(Xe,[["render",Je]]),$=n=>(X("data-v-735a17f7"),n=n(),Z(),n),Qe={class:"relative flex-center wh-full flex-col"},Ye=$(()=>o("img",{src:Fe,class:"absolute inset-0 w-full h-full object-cover"},null,-1)),et={class:"flex flex-col items-center gap-4 z-4"},tt={class:"text-center mb-[-80px]",style:{"margin-top":"50px"}},ot=$(()=>o("img",{src:we,class:"absolute inset-0 w-full h-full object-cover"},null,-1)),nt={class:"w-[clamp(260px,80vw,325px)]",style:{margin:"0 auto"}},at={class:"pt-24px"},st={class:"text-18px text-primary font-medium"},lt={class:"pt-24px"},it={class:"w-full px-4",style:{margin:"0 auto"}},rt={class:"alternative-login"},ct=$(()=>o("div",{class:"divider"},[o("span",{style:{color:"white !important"}},"或使用其他方式登录")],-1)),dt={class:"login-methods flex justify-center"},ut=$(()=>o("img",{src:ye,alt:"人脸识别",style:{width:"110px",height:"70px"}},null,-1)),pt={style:{color:"white !important"}},mt=$(()=>o("img",{src:te,alt:"指静脉识别",style:{width:"110px",height:"70px"}},null,-1)),_t={style:{color:"white !important"}},gt=$(()=>o("img",{src:Ae,alt:"NFC识别",style:{width:"110px",height:"70px"}},null,-1)),ft={style:{color:"white !important"}},vt=$(()=>o("img",{src:te,alt:"指纹识别",style:{width:"110px",height:"70px"}},null,-1)),ht={style:{color:"white !important"}},wt=D({__name:"index",props:{module:{}},setup(n){const _=n;ce();const c=de(),a=[{key:"pwd-login",label:x["pwd-login"],component:Re},{key:"fingerprint-login",label:x["fingerprint-login"],component:Oe},{key:"face-login",label:x["face-login"],component:Ve},{key:"reset-pwd",label:x["reset-pwd"],component:H},{key:"reset-pwd",label:x["reset-pwd"],component:H},{key:"fingermark-login",label:x["fingermark-login"],component:Ke}],r=k(_.module),p=P(()=>a.find(i=>i.key===r.value)||a[0]),v=P(()=>c.darkMode?ue(c.themeColor,7):c.themeColor);P(()=>{const e="#ffffff",i=c.darkMode?.5:.2;return pe(e,c.themeColor,i)});const d=()=>{const e=window.speechSynthesis,i=new SpeechSynthesisUtterance(C("page.login.nfcLogin.tips"));e.speak(i)},m=me(),h=P(()=>{var e;return((e=m.systemSettings)==null?void 0:e.systemName)||"智能柜管理系统"}),t=k(["pwd-login"]);O(async()=>{var e;await m.initSystemSettings(),(e=m.systemSettings)!=null&&e.systemLoginMethods&&(t.value=[...t.value,...m.systemSettings.systemLoginMethods.map(i=>{switch(i){case"face":return"face-login";case"finger":return"fingermark-login";case"vein":return"fingerprint-login";case"nfc":return"nfc-login";default:return""}}).filter(Boolean)])});const l=e=>{t.value.includes(e)&&(r.value=e)};return(e,i)=>{const f=oe,S=ke,I=he,z=xe,y=_e("login-bg");return b(),E("div",Qe,[Ye,s(f,{dark:g(c).darkMode,class:"absolute left-48px top-24px z-3 text-20px","onUpdate:dark":g(c).setDarkMode},null,8,["dark","onUpdate:dark"]),o("div",et,[o("div",tt,[s(S,{gradient:{from:"#CADFFF",to:"#1A469A"},size:28,style:{"font-size":"clamp(1rem, 4vw, 1.8rem)"}},{default:u(()=>[L(w(h.value),1)]),_:1})]),s(I,{bordered:!1,size:"large",class:"!w-auto rounded-20px shadow-sm mt-30 relative",style:{width:"90vw !important",maxWidth:"780px",height:"auto",minHeight:"400px",backgroundColor:"transparent",boxShadow:"none"}},{default:u(()=>[ot,o("div",nt,[o("main",at,[o("h3",st,[s(S,{gradient:{from:"#CADFFF",to:"#1A469A"},size:18,style:{"z-index":"9999 !important",position:"relative"}},{default:u(()=>[L(w(p.value.label),1)]),_:1})]),o("div",lt,[s(ge,{name:"fade-slide",mode:"out-in",appear:""},{default:u(()=>[(b(),B(fe(p.value.component)))]),_:1})])])])]),_:1}),s(I,{bordered:!1,size:"large",class:"!w-auto rounded-20px shadow-sm relative",style:ve({marginTop:"-7vh",width:"min(90vw, 780px)",height:"auto",minHeight:"300px",backgroundColor:"transparent",boxShadow:"none"})},{default:u(()=>[o("div",it,[o("div",rt,[ct,o("div",dt,[F(o("div",{class:"login-method",onClick:i[0]||(i[0]=N=>l("pwd-login"))},null,512),[[A,p.value.key!=="pwd-login"&&t.value.includes("pwd-login")]]),F(o("div",{class:"login-method",onClick:i[1]||(i[1]=N=>l("face-login"))},[s(z,{size:"80"},{default:u(()=>[ut]),_:1}),o("span",pt,w(g(x)["face-login"]),1)],512),[[A,p.value.key!=="face-login"&&t.value.includes("face-login")]]),F(o("div",{class:"login-method",onClick:i[2]||(i[2]=N=>l("fingerprint-login"))},[s(z,{size:"80"},{default:u(()=>[mt]),_:1}),o("span",_t,w(g(x)["fingerprint-login"]),1)],512),[[A,p.value.key!=="fingerprint-login"&&t.value.includes("fingerprint-login")]]),F(o("div",{class:"login-method",onClick:d},[s(z,{size:"80"},{default:u(()=>[gt]),_:1}),o("span",ft,w(g(x)["nfc-login"]),1)],512),[[A,p.value.key!=="nfc-login"&&t.value.includes("nfc-login")]]),F(o("div",{class:"login-method",onClick:i[3]||(i[3]=N=>l("fingermark-login"))},[s(z,{size:"80"},{default:u(()=>[vt]),_:1}),o("span",ht,w(g(x)["fingermark-login"]),1)],512),[[A,p.value.key!=="fingermark-login"&&t.value.includes("fingermark-login")]])])])])]),_:1},8,["style"]),s(y,{"theme-color":v.value},null,8,["theme-color"])])])}}});const Mt=M(wt,[["__scopeId","data-v-735a17f7"]]);export{Mt as default};
