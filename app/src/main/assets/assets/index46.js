import{f as at,ed as nt,bE as te,a9 as re,c as B,b as X,j as Y,c0 as ot,a as de,d as j,u as Le,n as we,by as st,l as K,c1 as it,a2 as q,q as He,r as C,h as p,v as lt,cu as ct,x as ut,af as dt,b$ as pt,N as ke,ee as Pe,ef as Se,eg as Ie,eh as ze,ei as ft,an as E,ao as H,ap as T,bb as le,b4 as Ge,bI as _e,b9 as Ve,aS as Xe,cL as L,k as be,aq as G,ar as d,aw as l,as as M,az as ie,ax as z,au as ne,aB as Z,ej as gt,ek as vt,a7 as O,a$ as oe,aF as ge,C as mt,a4 as Oe,aK as je,el as ht,at as yt,y as _t,em as bt,en as wt,eo as he,ep as xt,eq as Ct,er as $t,es as kt,aC as Pt,aD as St,o as Ce,et as It,eu as zt,ev as Dt,bT as Rt,ew as Nt,bh as Mt,ex as Bt,bS as At,ey as Tt,ez as Ut,eA as Et}from"./index.js";import{N as Ft}from"./Icon.js";import{_ as Ye}from"./text.js";import{N as fe,a as $e}from"./Dropdown.js";import{N as ye,a as Ke}from"./Grid.js";import{_ as Wt}from"./Space.js";import{f as se}from"./format-length.js";import{_ as Ze}from"./_plugin-vue_export-helper.js";import{_ as Je}from"./Divider.js";import{_ as pe}from"./Input.js";import{_ as ae}from"./FormItem.js";import{_ as De}from"./Form.js";import{N as Ot}from"./DataTable.js";import"./use-compitable.js";import"./use-merged-state.js";import"./FocusDetector.js";import"./next-frame-once.js";import"./get.js";import"./ChevronRight.js";import"./get-slot.js";import"./Checkbox.js";import"./RadioGroup.js";const jt=n=>{const{lineHeight:y,borderRadius:h,fontWeightStrong:m,baseColor:s,dividerColor:e,actionColor:u,textColor1:g,textColor2:a,closeColorHover:t,closeColorPressed:i,closeIconColor:o,closeIconColorHover:P,closeIconColorPressed:c,infoColor:_,successColor:v,warningColor:k,errorColor:S,fontSize:$}=n;return Object.assign(Object.assign({},nt),{fontSize:$,lineHeight:y,titleFontWeight:m,borderRadius:h,border:`1px solid ${e}`,color:u,titleTextColor:g,iconColor:a,contentTextColor:a,closeBorderRadius:h,closeColorHover:t,closeColorPressed:i,closeIconColor:o,closeIconColorHover:P,closeIconColorPressed:c,borderInfo:`1px solid ${te(s,re(_,{alpha:.25}))}`,colorInfo:te(s,re(_,{alpha:.08})),titleTextColorInfo:g,iconColorInfo:_,contentTextColorInfo:a,closeColorHoverInfo:t,closeColorPressedInfo:i,closeIconColorInfo:o,closeIconColorHoverInfo:P,closeIconColorPressedInfo:c,borderSuccess:`1px solid ${te(s,re(v,{alpha:.25}))}`,colorSuccess:te(s,re(v,{alpha:.08})),titleTextColorSuccess:g,iconColorSuccess:v,contentTextColorSuccess:a,closeColorHoverSuccess:t,closeColorPressedSuccess:i,closeIconColorSuccess:o,closeIconColorHoverSuccess:P,closeIconColorPressedSuccess:c,borderWarning:`1px solid ${te(s,re(k,{alpha:.33}))}`,colorWarning:te(s,re(k,{alpha:.08})),titleTextColorWarning:g,iconColorWarning:k,contentTextColorWarning:a,closeColorHoverWarning:t,closeColorPressedWarning:i,closeIconColorWarning:o,closeIconColorHoverWarning:P,closeIconColorPressedWarning:c,borderError:`1px solid ${te(s,re(S,{alpha:.25}))}`,colorError:te(s,re(S,{alpha:.08})),titleTextColorError:g,iconColorError:S,contentTextColorError:a,closeColorHoverError:t,closeColorPressedError:i,closeIconColorError:o,closeIconColorHoverError:P,closeIconColorPressedError:c})},qt={name:"Alert",common:at,self:jt},Lt=qt,Ht=B("alert",`
 line-height: var(--n-line-height);
 border-radius: var(--n-border-radius);
 position: relative;
 transition: background-color .3s var(--n-bezier);
 background-color: var(--n-color);
 text-align: start;
 word-break: break-word;
`,[X("border",`
 border-radius: inherit;
 position: absolute;
 left: 0;
 right: 0;
 top: 0;
 bottom: 0;
 transition: border-color .3s var(--n-bezier);
 border: var(--n-border);
 pointer-events: none;
 `),Y("closable",[B("alert-body",[X("title",`
 padding-right: 24px;
 `)])]),X("icon",{color:"var(--n-icon-color)"}),B("alert-body",{padding:"var(--n-padding)"},[X("title",{color:"var(--n-title-text-color)"}),X("content",{color:"var(--n-content-text-color)"})]),ot({originalTransition:"transform .3s var(--n-bezier)",enterToProps:{transform:"scale(1)"},leaveToProps:{transform:"scale(0.9)"}}),X("icon",`
 position: absolute;
 left: 0;
 top: 0;
 align-items: center;
 justify-content: center;
 display: flex;
 width: var(--n-icon-size);
 height: var(--n-icon-size);
 font-size: var(--n-icon-size);
 margin: var(--n-icon-margin);
 `),X("close",`
 transition:
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 position: absolute;
 right: 0;
 top: 0;
 margin: var(--n-close-margin);
 `),Y("show-icon",[B("alert-body",{paddingLeft:"calc(var(--n-icon-margin-left) + var(--n-icon-size) + var(--n-icon-margin-right))"})]),Y("right-adjust",[B("alert-body",{paddingRight:"calc(var(--n-close-size) + var(--n-padding) + 2px)"})]),B("alert-body",`
 border-radius: var(--n-border-radius);
 transition: border-color .3s var(--n-bezier);
 `,[X("title",`
 transition: color .3s var(--n-bezier);
 font-size: 16px;
 line-height: 19px;
 font-weight: var(--n-title-font-weight);
 `,[de("& +",[X("content",{marginTop:"9px"})])]),X("content",{transition:"color .3s var(--n-bezier)",fontSize:"var(--n-font-size)"})]),X("icon",{transition:"color .3s var(--n-bezier)"})]),Gt=Object.assign(Object.assign({},we.props),{title:String,showIcon:{type:Boolean,default:!0},type:{type:String,default:"default"},bordered:{type:Boolean,default:!0},closable:Boolean,onClose:Function,onAfterLeave:Function,onAfterHide:Function}),Vt=j({name:"Alert",inheritAttrs:!1,props:Gt,setup(n){const{mergedClsPrefixRef:y,mergedBorderedRef:h,inlineThemeDisabled:m,mergedRtlRef:s}=Le(n),e=we("Alert","-alert",Ht,Lt,n,y),u=st("Alert",s,y),g=K(()=>{const{common:{cubicBezierEaseInOut:c},self:_}=e.value,{fontSize:v,borderRadius:k,titleFontWeight:S,lineHeight:$,iconSize:b,iconMargin:D,iconMarginRtl:N,closeIconSize:A,closeBorderRadius:U,closeSize:F,closeMargin:r,closeMarginRtl:f,padding:x}=_,{type:I}=n,{left:W,right:J}=it(D);return{"--n-bezier":c,"--n-color":_[q("color",I)],"--n-close-icon-size":A,"--n-close-border-radius":U,"--n-close-color-hover":_[q("closeColorHover",I)],"--n-close-color-pressed":_[q("closeColorPressed",I)],"--n-close-icon-color":_[q("closeIconColor",I)],"--n-close-icon-color-hover":_[q("closeIconColorHover",I)],"--n-close-icon-color-pressed":_[q("closeIconColorPressed",I)],"--n-icon-color":_[q("iconColor",I)],"--n-border":_[q("border",I)],"--n-title-text-color":_[q("titleTextColor",I)],"--n-content-text-color":_[q("contentTextColor",I)],"--n-line-height":$,"--n-border-radius":k,"--n-font-size":v,"--n-title-font-weight":S,"--n-icon-size":b,"--n-icon-margin":D,"--n-icon-margin-rtl":N,"--n-close-size":F,"--n-close-margin":r,"--n-close-margin-rtl":f,"--n-padding":x,"--n-icon-margin-left":W,"--n-icon-margin-right":J}}),a=m?He("alert",K(()=>n.type[0]),g,n):void 0,t=C(!0),i=()=>{const{onAfterLeave:c,onAfterHide:_}=n;c&&c(),_&&_()};return{rtlEnabled:u,mergedClsPrefix:y,mergedBordered:h,visible:t,handleCloseClick:()=>{var c;Promise.resolve((c=n.onClose)===null||c===void 0?void 0:c.call(n)).then(_=>{_!==!1&&(t.value=!1)})},handleAfterLeave:()=>{i()},mergedTheme:e,cssVars:m?void 0:g,themeClass:a==null?void 0:a.themeClass,onRender:a==null?void 0:a.onRender}},render(){var n;return(n=this.onRender)===null||n===void 0||n.call(this),p(pt,{onAfterLeave:this.handleAfterLeave},{default:()=>{const{mergedClsPrefix:y,$slots:h}=this,m={class:[`${y}-alert`,this.themeClass,this.closable&&`${y}-alert--closable`,this.showIcon&&`${y}-alert--show-icon`,!this.title&&this.closable&&`${y}-alert--right-adjust`,this.rtlEnabled&&`${y}-alert--rtl`],style:this.cssVars,role:"alert"};return this.visible?p("div",Object.assign({},lt(this.$attrs,m)),this.closable&&p(ct,{clsPrefix:y,class:`${y}-alert__close`,onClick:this.handleCloseClick}),this.bordered&&p("div",{class:`${y}-alert__border`}),this.showIcon&&p("div",{class:`${y}-alert__icon`,"aria-hidden":"true"},ut(h.icon,()=>[p(ke,{clsPrefix:y},{default:()=>{switch(this.type){case"success":return p(ze,null);case"info":return p(Ie,null);case"warning":return p(Se,null);case"error":return p(Pe,null);default:return null}}})])),p("div",{class:[`${y}-alert-body`,this.mergedBordered&&`${y}-alert-body--bordered`]},dt(h.header,s=>{const e=s||this.title;return e?p("div",{class:`${y}-alert-body__title`},e):null}),h.default&&p("div",{class:`${y}-alert-body__content`},h))):null}})}}),Xt=de([B("progress",{display:"inline-block"},[B("progress-icon",`
 color: var(--n-icon-color);
 transition: color .3s var(--n-bezier);
 `),Y("line",`
 width: 100%;
 display: block;
 `,[B("progress-content",`
 display: flex;
 align-items: center;
 `,[B("progress-graph",{flex:1})]),B("progress-custom-content",{marginLeft:"14px"}),B("progress-icon",`
 width: 30px;
 padding-left: 14px;
 height: var(--n-icon-size-line);
 line-height: var(--n-icon-size-line);
 font-size: var(--n-icon-size-line);
 `,[Y("as-text",`
 color: var(--n-text-color-line-outer);
 text-align: center;
 width: 40px;
 font-size: var(--n-font-size);
 padding-left: 4px;
 transition: color .3s var(--n-bezier);
 `)])]),Y("circle, dashboard",{width:"120px"},[B("progress-custom-content",`
 position: absolute;
 left: 50%;
 top: 50%;
 transform: translateX(-50%) translateY(-50%);
 display: flex;
 align-items: center;
 justify-content: center;
 `),B("progress-text",`
 position: absolute;
 left: 50%;
 top: 50%;
 transform: translateX(-50%) translateY(-50%);
 display: flex;
 align-items: center;
 color: inherit;
 font-size: var(--n-font-size-circle);
 color: var(--n-text-color-circle);
 font-weight: var(--n-font-weight-circle);
 transition: color .3s var(--n-bezier);
 white-space: nowrap;
 `),B("progress-icon",`
 position: absolute;
 left: 50%;
 top: 50%;
 transform: translateX(-50%) translateY(-50%);
 display: flex;
 align-items: center;
 color: var(--n-icon-color);
 font-size: var(--n-icon-size-circle);
 `)]),Y("multiple-circle",`
 width: 200px;
 color: inherit;
 `,[B("progress-text",`
 font-weight: var(--n-font-weight-circle);
 color: var(--n-text-color-circle);
 position: absolute;
 left: 50%;
 top: 50%;
 transform: translateX(-50%) translateY(-50%);
 display: flex;
 align-items: center;
 justify-content: center;
 transition: color .3s var(--n-bezier);
 `)]),B("progress-content",{position:"relative"}),B("progress-graph",{position:"relative"},[B("progress-graph-circle",[de("svg",{verticalAlign:"bottom"}),B("progress-graph-circle-fill",`
 stroke: var(--n-fill-color);
 transition:
 opacity .3s var(--n-bezier),
 stroke .3s var(--n-bezier),
 stroke-dasharray .3s var(--n-bezier);
 `,[Y("empty",{opacity:0})]),B("progress-graph-circle-rail",`
 transition: stroke .3s var(--n-bezier);
 overflow: hidden;
 stroke: var(--n-rail-color);
 `)]),B("progress-graph-line",[Y("indicator-inside",[B("progress-graph-line-rail",`
 height: 16px;
 line-height: 16px;
 border-radius: 10px;
 `,[B("progress-graph-line-fill",`
 height: inherit;
 border-radius: 10px;
 `),B("progress-graph-line-indicator",`
 background: #0000;
 white-space: nowrap;
 text-align: right;
 margin-left: 14px;
 margin-right: 14px;
 height: inherit;
 font-size: 12px;
 color: var(--n-text-color-line-inner);
 transition: color .3s var(--n-bezier);
 `)])]),Y("indicator-inside-label",`
 height: 16px;
 display: flex;
 align-items: center;
 `,[B("progress-graph-line-rail",`
 flex: 1;
 transition: background-color .3s var(--n-bezier);
 `),B("progress-graph-line-indicator",`
 background: var(--n-fill-color);
 font-size: 12px;
 transform: translateZ(0);
 display: flex;
 vertical-align: middle;
 height: 16px;
 line-height: 16px;
 padding: 0 10px;
 border-radius: 10px;
 position: absolute;
 white-space: nowrap;
 color: var(--n-text-color-line-inner);
 transition:
 right .2s var(--n-bezier),
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 `)]),B("progress-graph-line-rail",`
 position: relative;
 overflow: hidden;
 height: var(--n-rail-height);
 border-radius: 5px;
 background-color: var(--n-rail-color);
 transition: background-color .3s var(--n-bezier);
 `,[B("progress-graph-line-fill",`
 background: var(--n-fill-color);
 position: relative;
 border-radius: 5px;
 height: inherit;
 width: 100%;
 max-width: 0%;
 transition:
 background-color .3s var(--n-bezier),
 max-width .2s var(--n-bezier);
 `,[Y("processing",[de("&::after",`
 content: "";
 background-image: var(--n-line-bg-processing);
 animation: progress-processing-animation 2s var(--n-bezier) infinite;
 `)])])])])])]),de("@keyframes progress-processing-animation",`
 0% {
 position: absolute;
 left: 0;
 top: 0;
 bottom: 0;
 right: 100%;
 opacity: 1;
 }
 66% {
 position: absolute;
 left: 0;
 top: 0;
 bottom: 0;
 right: 0;
 opacity: 0;
 }
 100% {
 position: absolute;
 left: 0;
 top: 0;
 bottom: 0;
 right: 0;
 opacity: 0;
 }
 `)]),Yt={success:p(ze,null),error:p(Pe,null),warning:p(Se,null),info:p(Ie,null)},Kt=j({name:"ProgressLine",props:{clsPrefix:{type:String,required:!0},percentage:{type:Number,default:0},railColor:String,railStyle:[String,Object],fillColor:String,status:{type:String,required:!0},indicatorPlacement:{type:String,required:!0},indicatorTextColor:String,unit:{type:String,default:"%"},processing:{type:Boolean,required:!0},showIndicator:{type:Boolean,required:!0},height:[String,Number],railBorderRadius:[String,Number],fillBorderRadius:[String,Number]},setup(n,{slots:y}){const h=K(()=>se(n.height)),m=K(()=>n.railBorderRadius!==void 0?se(n.railBorderRadius):n.height!==void 0?se(n.height,{c:.5}):""),s=K(()=>n.fillBorderRadius!==void 0?se(n.fillBorderRadius):n.railBorderRadius!==void 0?se(n.railBorderRadius):n.height!==void 0?se(n.height,{c:.5}):"");return()=>{const{indicatorPlacement:e,railColor:u,railStyle:g,percentage:a,unit:t,indicatorTextColor:i,status:o,showIndicator:P,fillColor:c,processing:_,clsPrefix:v}=n;return p("div",{class:`${v}-progress-content`,role:"none"},p("div",{class:`${v}-progress-graph`,"aria-hidden":!0},p("div",{class:[`${v}-progress-graph-line`,{[`${v}-progress-graph-line--indicator-${e}`]:!0}]},p("div",{class:`${v}-progress-graph-line-rail`,style:[{backgroundColor:u,height:h.value,borderRadius:m.value},g]},p("div",{class:[`${v}-progress-graph-line-fill`,_&&`${v}-progress-graph-line-fill--processing`],style:{maxWidth:`${n.percentage}%`,backgroundColor:c,height:h.value,lineHeight:h.value,borderRadius:s.value}},e==="inside"?p("div",{class:`${v}-progress-graph-line-indicator`,style:{color:i}},y.default?y.default():`${a}${t}`):null)))),P&&e==="outside"?p("div",null,y.default?p("div",{class:`${v}-progress-custom-content`,style:{color:i},role:"none"},y.default()):o==="default"?p("div",{role:"none",class:`${v}-progress-icon ${v}-progress-icon--as-text`,style:{color:i}},a,t):p("div",{class:`${v}-progress-icon`,"aria-hidden":!0},p(ke,{clsPrefix:v},{default:()=>Yt[o]}))):null)}}}),Zt={success:p(ze,null),error:p(Pe,null),warning:p(Se,null),info:p(Ie,null)},Jt=j({name:"ProgressCircle",props:{clsPrefix:{type:String,required:!0},status:{type:String,required:!0},strokeWidth:{type:Number,required:!0},fillColor:String,railColor:String,railStyle:[String,Object],percentage:{type:Number,default:0},offsetDegree:{type:Number,default:0},showIndicator:{type:Boolean,required:!0},indicatorTextColor:String,unit:String,viewBoxWidth:{type:Number,required:!0},gapDegree:{type:Number,required:!0},gapOffsetDegree:{type:Number,default:0}},setup(n,{slots:y}){function h(m,s,e){const{gapDegree:u,viewBoxWidth:g,strokeWidth:a}=n,t=50,i=0,o=t,P=0,c=2*t,_=50+a/2,v=`M ${_},${_} m ${i},${o}
      a ${t},${t} 0 1 1 ${P},${-c}
      a ${t},${t} 0 1 1 ${-P},${c}`,k=Math.PI*2*t,S={stroke:e,strokeDasharray:`${m/100*(k-u)}px ${g*8}px`,strokeDashoffset:`-${u/2}px`,transformOrigin:s?"center":void 0,transform:s?`rotate(${s}deg)`:void 0};return{pathString:v,pathStyle:S}}return()=>{const{fillColor:m,railColor:s,strokeWidth:e,offsetDegree:u,status:g,percentage:a,showIndicator:t,indicatorTextColor:i,unit:o,gapOffsetDegree:P,clsPrefix:c}=n,{pathString:_,pathStyle:v}=h(100,0,s),{pathString:k,pathStyle:S}=h(a,u,m),$=100+e;return p("div",{class:`${c}-progress-content`,role:"none"},p("div",{class:`${c}-progress-graph`,"aria-hidden":!0},p("div",{class:`${c}-progress-graph-circle`,style:{transform:P?`rotate(${P}deg)`:void 0}},p("svg",{viewBox:`0 0 ${$} ${$}`},p("g",null,p("path",{class:`${c}-progress-graph-circle-rail`,d:_,"stroke-width":e,"stroke-linecap":"round",fill:"none",style:v})),p("g",null,p("path",{class:[`${c}-progress-graph-circle-fill`,a===0&&`${c}-progress-graph-circle-fill--empty`],d:k,"stroke-width":e,"stroke-linecap":"round",fill:"none",style:S}))))),t?p("div",null,y.default?p("div",{class:`${c}-progress-custom-content`,role:"none"},y.default()):g!=="default"?p("div",{class:`${c}-progress-icon`,"aria-hidden":!0},p(ke,{clsPrefix:c},{default:()=>Zt[g]})):p("div",{class:`${c}-progress-text`,style:{color:i},role:"none"},p("span",{class:`${c}-progress-text__percentage`},a),p("span",{class:`${c}-progress-text__unit`},o))):null)}}});function qe(n,y,h=100){return`m ${h/2} ${h/2-n} a ${n} ${n} 0 1 1 0 ${2*n} a ${n} ${n} 0 1 1 0 -${2*n}`}const Qt=j({name:"ProgressMultipleCircle",props:{clsPrefix:{type:String,required:!0},viewBoxWidth:{type:Number,required:!0},percentage:{type:Array,default:[0]},strokeWidth:{type:Number,required:!0},circleGap:{type:Number,required:!0},showIndicator:{type:Boolean,required:!0},fillColor:{type:Array,default:()=>[]},railColor:{type:Array,default:()=>[]},railStyle:{type:Array,default:()=>[]}},setup(n,{slots:y}){const h=K(()=>n.percentage.map((s,e)=>`${Math.PI*s/100*(n.viewBoxWidth/2-n.strokeWidth/2*(1+2*e)-n.circleGap*e)*2}, ${n.viewBoxWidth*8}`));return()=>{const{viewBoxWidth:m,strokeWidth:s,circleGap:e,showIndicator:u,fillColor:g,railColor:a,railStyle:t,percentage:i,clsPrefix:o}=n;return p("div",{class:`${o}-progress-content`,role:"none"},p("div",{class:`${o}-progress-graph`,"aria-hidden":!0},p("div",{class:`${o}-progress-graph-circle`},p("svg",{viewBox:`0 0 ${m} ${m}`},i.map((P,c)=>p("g",{key:c},p("path",{class:`${o}-progress-graph-circle-rail`,d:qe(m/2-s/2*(1+2*c)-e*c,s,m),"stroke-width":s,"stroke-linecap":"round",fill:"none",style:[{strokeDashoffset:0,stroke:a[c]},t[c]]}),p("path",{class:[`${o}-progress-graph-circle-fill`,P===0&&`${o}-progress-graph-circle-fill--empty`],d:qe(m/2-s/2*(1+2*c)-e*c,s,m),"stroke-width":s,"stroke-linecap":"round",fill:"none",style:{strokeDasharray:h.value[c],strokeDashoffset:0,stroke:g[c]}})))))),u&&y.default?p("div",null,p("div",{class:`${o}-progress-text`},y.default())):null)}}}),er=Object.assign(Object.assign({},we.props),{processing:Boolean,type:{type:String,default:"line"},gapDegree:Number,gapOffsetDegree:Number,status:{type:String,default:"default"},railColor:[String,Array],railStyle:[String,Array],color:[String,Array],viewBoxWidth:{type:Number,default:100},strokeWidth:{type:Number,default:7},percentage:[Number,Array],unit:{type:String,default:"%"},showIndicator:{type:Boolean,default:!0},indicatorPosition:{type:String,default:"outside"},indicatorPlacement:{type:String,default:"outside"},indicatorTextColor:String,circleGap:{type:Number,default:1},height:Number,borderRadius:[String,Number],fillBorderRadius:[String,Number],offsetDegree:Number}),tr=j({name:"Progress",props:er,setup(n){const y=K(()=>n.indicatorPlacement||n.indicatorPosition),h=K(()=>{if(n.gapDegree||n.gapDegree===0)return n.gapDegree;if(n.type==="dashboard")return 75}),{mergedClsPrefixRef:m,inlineThemeDisabled:s}=Le(n),e=we("Progress","-progress",Xt,ft,n,m),u=K(()=>{const{status:a}=n,{common:{cubicBezierEaseInOut:t},self:{fontSize:i,fontSizeCircle:o,railColor:P,railHeight:c,iconSizeCircle:_,iconSizeLine:v,textColorCircle:k,textColorLineInner:S,textColorLineOuter:$,lineBgProcessing:b,fontWeightCircle:D,[q("iconColor",a)]:N,[q("fillColor",a)]:A}}=e.value;return{"--n-bezier":t,"--n-fill-color":A,"--n-font-size":i,"--n-font-size-circle":o,"--n-font-weight-circle":D,"--n-icon-color":N,"--n-icon-size-circle":_,"--n-icon-size-line":v,"--n-line-bg-processing":b,"--n-rail-color":P,"--n-rail-height":c,"--n-text-color-circle":k,"--n-text-color-line-inner":S,"--n-text-color-line-outer":$}}),g=s?He("progress",K(()=>n.status[0]),u,n):void 0;return{mergedClsPrefix:m,mergedIndicatorPlacement:y,gapDeg:h,cssVars:s?void 0:u,themeClass:g==null?void 0:g.themeClass,onRender:g==null?void 0:g.onRender}},render(){const{type:n,cssVars:y,indicatorTextColor:h,showIndicator:m,status:s,railColor:e,railStyle:u,color:g,percentage:a,viewBoxWidth:t,strokeWidth:i,mergedIndicatorPlacement:o,unit:P,borderRadius:c,fillBorderRadius:_,height:v,processing:k,circleGap:S,mergedClsPrefix:$,gapDeg:b,gapOffsetDegree:D,themeClass:N,$slots:A,onRender:U}=this;return U==null||U(),p("div",{class:[N,`${$}-progress`,`${$}-progress--${n}`,`${$}-progress--${s}`],style:y,"aria-valuemax":100,"aria-valuemin":0,"aria-valuenow":a,role:n==="circle"||n==="line"||n==="dashboard"?"progressbar":"none"},n==="circle"||n==="dashboard"?p(Jt,{clsPrefix:$,status:s,showIndicator:m,indicatorTextColor:h,railColor:e,fillColor:g,railStyle:u,offsetDegree:this.offsetDegree,percentage:a,viewBoxWidth:t,strokeWidth:i,gapDegree:b===void 0?n==="dashboard"?75:0:b,gapOffsetDegree:D,unit:P},A):n==="line"?p(Kt,{clsPrefix:$,status:s,showIndicator:m,indicatorTextColor:h,railColor:e,fillColor:g,railStyle:u,percentage:a,processing:k,indicatorPlacement:o,unit:P,fillBorderRadius:_,railBorderRadius:c,height:v},A):n==="multiple-circle"?p(Qt,{clsPrefix:$,strokeWidth:i,railColor:e,fillColor:g,railStyle:u,viewBoxWidth:t,percentage:a,showIndicator:m,circleGap:S},A):null)}}),rr={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},ar=j({name:"ExclamationCircleFilled",render:function(y,h){return E(),H("svg",rr,h[0]||(h[0]=[T("path",{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448s448-200.6 448-448S759.4 64 512 64zm-32 232c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v272c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V296zm32 440a48.01 48.01 0 0 1 0-96a48.01 48.01 0 0 1 0 96z",fill:"currentColor"},null,-1)]))}}),nr={class:"flex flex-col items-center gap-4"},or=T("p",null,"未检测到NFC卡，请将卡片贴近读卡器",-1),sr={class:"flex gap-3 mt-4"},ir=j({__name:"nfcDialog",props:{userData:{}},emits:["submit","save-success"],setup(n,{expose:y,emit:h}){const m=C(!1),s=C(""),e=C(!1),u=le();Ge(),_e();const g=C(""),a=C(null),t=Ve();Xe();const i=()=>{m.value=!1,e.value=!1,t.setnfcAuthStatus("logging"),t.resetNfcCardNumber()};y({open:(c,_="logging")=>{t.setnfcAuthStatus("registering"),a.value=c,s.value=c.nfc.cardNumber||"",e.value=!!c.nfcCard,m.value=!0,L(_==="registering"&&!s.value?"请将NFC卡贴近读卡器":"")},close:i}),be(()=>t.getNfcCardNumber,c=>{c&&c!==s.value&&(g.value=c,e.value=!0,L("检测到新卡号，请确认保存"))},{immediate:!0});const o=async()=>{var c,_,v;try{if(g.value===""){u.error("请先检测到新卡号");return}if(s.value===g.value){u.error("新卡号与原卡号相同");return}let k={cardNumber:g.value,userId:(c=a.value)==null?void 0:c.id};(_=a.value.nfc)!=null&&_.id&&(k={...k,id:Number((v=a.value.nfc)==null?void 0:v.id)});let{error:S}=await gt(k);if(t.resetNfcCardNumber(),S)return;m.value=!1,h("save-success",g.value)}catch{u.error("保存失败")}},P=async()=>{var c;try{if(!((c=a.value)!=null&&c.id)){u.error("用户信息不完整");return}const{error:_}=await vt({targetUserId:a.value.id});if(_)throw new Error;u.success("解绑成功"),s.value="",e.value=!1,h("save-success","")}catch{u.error("解绑失败")}};return(c,_)=>{const v=Ft,k=Ye,S=fe,$=O,b=oe,D=ge;return E(),G(D,{show:m.value,"onUpdate:show":_[0]||(_[0]=N=>m.value=N)},{default:d(()=>[l(b,{style:{width:"500px"},title:"NFC卡注册"},{default:d(()=>[T("div",nr,[!s.value&&!e.value?(E(),H(ie,{key:0},[l(v,{size:"64",component:M(ar)},null,8,["component"]),or],64)):(E(),H(ie,{key:1},[l(k,{strong:""},{default:d(()=>[z("已检测到卡片：")]),_:1}),l(S,{type:"success",size:"large"},{default:d(()=>[z(ne(e.value?g.value:s.value),1)]),_:1}),e.value?Z("",!0):(E(),G(S,{key:0,type:"warning",size:"medium",class:"ml-2"},{default:d(()=>[z(" 已注册 ")]),_:1}))],64)),T("div",sr,[l($,{disabled:!s.value,onClick:P,type:"error",ghost:""},{default:d(()=>[z(" 解绑 ")]),_:1},8,["disabled"]),l($,{disabled:!e.value,type:"primary",onClick:o},{default:d(()=>[z("保存")]),_:1},8,["disabled"]),l($,{onClick:i},{default:d(()=>[z("返回")]),_:1})])])]),_:1})]),_:1},8,["show"])}}}),lr={key:0,class:"text-3xl text-white font-bold text-center absolute inset-0 flex items-center justify-center",style:{width:"46 vw",height:"44vh","text-shadow":"0 1px 1px rgba(0,0,0,0.5)",background:"rgba(0,0,0,0.3)"}},cr={class:"animate-pulse"},ur=T("div",{class:"text-sm mt-2"},"请保持正对摄像头",-1),dr=["src"],pr=j({__name:"faceContent",props:{userId:{}},emits:["success","cancel"],setup(n,{expose:y,emit:h}){const m=n,s=C(),e=C(),u=C(),g=C(0),a=C(!1),t=C(!1),i=C(""),o=async()=>{try{u.value=await navigator.mediaDevices.getUserMedia({video:{width:480,height:400}}),s.value&&(s.value.srcObject=u.value,_())}catch(S){console.error("摄像头访问失败:",S)}};let P;const c=S=>{const $=document.createElement("canvas");$.width=S.videoWidth,$.height=S.videoHeight;const b=$.getContext("2d");if(!b)return!1;b.drawImage(S,0,0,$.width,$.height);const D=b.getImageData(0,0,$.width,$.height);let N=!1;for(let A=0;A<D.data.length;A+=4){const[U,F,r]=D.data.slice(A,A+3);if(U>95&&F>40&&r>20&&U>F&&U>r&&Math.abs(U-F)>15){N=!0;break}}return N},_=()=>{P=window.setInterval(async()=>{if(!s.value||!e.value)return;if(c(s.value)&&!a.value){clearInterval(P),a.value=!0,g.value=3;const $=setInterval(()=>{if(g.value<=0){clearInterval($),v(),a.value=!1;return}g.value--},1e3)}},1e3)},v=async()=>{if(!s.value||!e.value)return;const S=e.value.getContext("2d");if(S){e.value.width=s.value.videoWidth,e.value.height=s.value.videoHeight,S.drawImage(s.value,0,0);try{a.value=!0;const $=e.value.toDataURL("image/jpeg",.8);t.value=!0,k();const{error:b,data:D}=await ht({userId:m.userId||0,image:"data:image/jpeg;base64,"+$.split(",")[1]});if(b)return;h("success",$),i.value=$,k()}finally{a.value=!1,g.value=0}}},k=()=>{var S;(S=u.value)==null||S.getTracks().forEach($=>$.stop()),clearInterval(P)};return mt(k),y({startCamera:o,stopCamera:k}),(S,$)=>{const b=ye,D=Ke,N=oe;return E(),G(N,{title:"",class:"mt-0 w-[90%] mx-auto",bordered:!1},{default:d(()=>[l(D,{cols:"24","x-gap":"12",class:"h-[50vh]"},{default:d(()=>[Oe(l(b,{span:24,"s-span":24,"m-span":12},{default:d(()=>[T("video",{ref_key:"videoEl",ref:s,autoplay:"",class:"w-[50vw] mx-auto h-[40vh] object-cover"},null,512),g.value>0?(E(),H("div",lr,[T("div",cr,[z(ne(g.value)+" 秒 ",1),ur])])):Z("",!0)]),_:1},512),[[je,!t.value]]),Oe(l(b,{span:24,"s-span":24,"m-span":12},{default:d(()=>[T("canvas",{ref_key:"canvasEl",ref:e,class:"w-[40vw] mx-auto h-[38vh] object-contain"},null,512),i.value?(E(),H("img",{key:0,src:i.value,class:"mt-4 w-full rounded-lg shadow-md"},null,8,dr)):Z("",!0)]),_:1},512),[[je,t.value]])]),_:1})]),_:1})}}}),fr={key:0,class:"flex flex-col items-center mt-6",style:{width:"46vw",height:"38vh"}},gr=["src"],vr=T("span",{class:"text-gray-500 text-sm mt-8"},"已录入人脸信息",-1),mr={key:1},hr=T("span",{class:"text-gray-400 text-center text-sm px-2",style:{display:"block"}},"暂无人脸信息，请点击「开始录入」注册",-1),yr=j({__name:"faceDialog",props:{userData:{}},emits:["submit","save-success"],setup(n,{expose:y,emit:h}){const m=C(!1),s=C(!1),e=le(),u=C(null),g=()=>{var v;m.value=!1,s.value=!1,(v=i.value)==null||v.stopCamera()},a=v=>{const k=v.target;k.style.display="none"};y({open:v=>{u.value=v,s.value=!!v.face.id,m.value=!0,t.value=!v.face.id},close:g});const t=C(!1),i=C(),o=C(!1),P=()=>{L("请正对摄像头开始采集人脸信息"),t.value=!0,o.value=!0,_t(()=>{var v;(v=i.value)==null||v.startCamera()})},c=v=>{u.value.face={id:Date.now(),face_img:v},s.value=!0,t.value=!1,o.value=!1,e.success("人脸注册成功"),h("save-success",v),g()},_=async()=>{var v;try{if(!((v=u.value)!=null&&v.id))return;const{error:k}=await bt(u.value.id);if(k)return;e.success("人脸解绑成功"),u.value.face=null,s.value=!1,t.value=!1}catch(k){console.error("人脸解绑失败:",k),e.error("解绑请求失败")}};return(v,k)=>{const S=O,$=Wt,b=oe,D=ge;return E(),G(D,{show:m.value,"onUpdate:show":k[1]||(k[1]=N=>m.value=N)},{default:d(()=>[l(b,{style:{width:"50vw",height:"60vh"},title:"人脸录入"},{default:d(()=>{var N,A,U,F,r;return[t.value?(E(),H("div",mr,[l(pr,{ref_key:"faceContentRef",ref:i,"user-id":(r=u.value)==null?void 0:r.id,style:{width:"46vw",height:"38vh"},onSuccess:c,onCancel:k[0]||(k[0]=f=>t.value=!1)},null,8,["user-id"]),hr])):(E(),H("div",fr,[(A=(N=u.value)==null?void 0:N.face)!=null&&A.id?(E(),H(ie,{key:0},[T("img",{src:(F=(U=u.value)==null?void 0:U.face)==null?void 0:F.face_img,alt:"人脸图片",class:"w-45 h-45 rounded-full mb-2",onError:a},null,40,gr),vr],64)):Z("",!0)])),l($,{justify:"center",class:"mt-6"},{default:d(()=>{var f,x;return[l(S,{type:"primary",onClick:P,class:yt(["w-32",{"opacity-75":o.value}])},{default:d(()=>[z(ne(t.value?"开始录入":"重新采集"),1)]),_:1},8,["class"]),(x=(f=u.value)==null?void 0:f.face)!=null&&x.id?(E(),G(S,{key:0,type:"error",onClick:_,class:"w-32"},{default:d(()=>[z(" 解绑人脸 ")]),_:1})):Z("",!0),l(S,{onClick:g},{default:d(()=>[z("返回")]),_:1})]}),_:1})]}),_:1})]),_:1},8,["show"])}}}),_r="/soy-admin/fingerprint.jpg",Qe=n=>(Pt("data-v-fe528cfe"),n=n(),St(),n),br={class:"flex flex-col items-center gap-4"},wr=Qe(()=>T("p",{class:"text-center mb-4"},[z("依次点击开始注册按钮，根据语音提示："),T("br"),z("每个角度都要轻放3次，指尖要碰到前端的凹槽")],-1)),xr=Qe(()=>T("img",{src:_r,style:{width:"420px",height:"150px"}},null,-1)),Cr={class:"flex flex-col items-center gap-4 mt-4",style:{width:"100%"}},$r={class:"w-full px-6"},kr={class:"progress-text"},Pr={class:"flex gap-3 mt-4"},Sr=3,Ir=j({__name:"fingerprintDialog",props:{userData:{}},emits:["submit","save-success","update:vein"],setup(n,{expose:y,emit:h}){const m=C(!1),s=C(!1),e=le(),u=C(null),g=C();Ge(),_e(),Ve();const a=wt(),t=C(0),i=C(!1),o=C(""),P=C("等待开始注册"),c=C(0),_=C(0);be(()=>a.registerAttempts,async b=>{P.value=`当前进度：第 ${b} 次录入`,t.value=b,b>=6?(e.success("指静脉录入完成"),s.value=!0,i.value=!1):b>0&&e.info(`正在进行第 ${b} 次录入...`)}),be(()=>a.errorMessages,b=>{b.length>=3?(o.value="连续注册失败次数过多（3次），已自动终止流程",i.value=!1,a.resetRegistration()):b.length>0&&(o.value=`第 ${b.length} 次失败：${b[b.length-1]}`)});async function v(){var b,D,N,A,U,F,r;a.setDetectionMode("register"),a.stopDetection(),i.value=!0,o.value="",t.value=0,c.value=0,_.value=0;try{P.value="正在初始化...",L("请将手指放入指静脉识别模块",1.3);try{let{data:I}=await he({ip:g.value.ipAddress});I!=null&&I.Success||e.success("清除上一次缓存成功")}catch(I){e.error(`清除缓冲区: ${I.message}（可能缓冲区本来就是空的）`),P.value="清除缓冲区失败, 请重试",i.value=!1;return}const f=await xt({ip:g.value.ipAddress});if((b=f.data)!=null&&b.Success&&((D=f.data)!=null&&D.MatchedId)){e.error("该指静脉已存在，无法重复录入"),await L("指静脉信息已存在",1.2),i.value=!1,P.value="指静脉信息已存在,，无法重复录入";return}let x=1;for(;x<=6;){P.value=`第 ${x} 次录入中...`,await L(`请进行第 ${x} 次录入`,1.3);const I=await Ct({ip:g.value.ipAddress,fingerId:u.value.id,groupId:1});if(!((N=I.data)!=null&&N.Success)){if(((A=I.data)==null?void 0:A.ConfirmCode)===15||(F=(U=I.data)==null?void 0:U.Message)!=null&&F.includes("注册模板缓存区满")){e.error(`缓冲区清除重试次数已达上限（${Sr}次），停止注册`);try{await he({ip:g.value.ipAddress,value:0}),await new Promise(J=>setTimeout(J,500));let{data:W}=await he({ip:g.value.ipAddress});W!=null&&W.Success||e.success("缓冲区清除成功"),await new Promise(J=>setTimeout(J,1e3))}catch(W){L("缓冲区清除失败，请重试",1.5),e.error(`清除缓冲区异常：${W.message}`);return}}if(c.value++,o.value=`第 ${x} 次录入失败（已失败 ${c.value} 次）`,c.value>=3)throw o.value="连续注册失败次数过多（3次），已自动终止流程",new Error("累计失败次数超过限制");await L("录入失败，请重新放置手指",1.3),e.warning(((r=I.data)==null?void 0:r.Message)||"录入失败，请重新放置手指");continue}if(_.value++,t.value=x,a.registerAttempts=x,x++,x===6){try{let{data:W}=await he({ip:g.value.ipAddress,value:1});if(W!=null&&W.Success){e.success("指静脉录入成功"),s.value=!0,L("指静脉录入完成",1.2);let{error:J,message:xe}=await $t({fingerID:u.value.id});if(J)return;e.success(""+xe)}else throw new Error((W==null?void 0:W.Message)||"保存注册数据失败")}catch(W){e.error("保存注册数据失败："+W.message),L("保存注册数据失败",1.5)}return}}}catch(f){o.value=f.message||"注册流程异常",L("录入失败，请重试",1.5)}finally{i.value=!1,P.value="",a.resetRegistration()}}const k=()=>{var b,D;a.setDetectionMode("login"),a.initDevices(),a.startDetection(),m.value=!1,s.value=!1,h("update:vein",{id:(D=(b=u.value)==null?void 0:b.vein)==null?void 0:D.id})};async function S(){var b;if(!((b=u.value)!=null&&b.id)){e.error("用户信息不完整");return}}y({open:b=>{var A;if(!b){e.error("用户信息不完整");return}const N=_e().getMainCabinet;if(!N){e.error("未找到主柜信息"),L("未找到主柜信息"),m.value=!1;return}g.value={ipAddress:N.ipAddress||"",macAddress:N.macAddress||"",name:N.name||"",type:N.type||"main",id:N.id||0},a.stopDetection(),u.value=b,s.value=(A=b.vein)==null?void 0:A.id,m.value=!0},close:k});const $=async()=>{var b;try{if(!((b=u.value)!=null&&b.id)){e.error("用户信息不完整");return}const{error:D}=await kt({userFID:u.value.id});if(D)throw new Error;e.success("解绑成功"),s.value=!1,h("save-success","")}catch{e.error("解绑失败")}};return(b,D)=>{const N=tr,A=Vt,U=Ye,F=O,r=fe,f=oe,x=ge;return E(),G(x,{show:m.value,"onUpdate:show":D[0]||(D[0]=I=>m.value=I)},{default:d(()=>[l(f,{style:{width:"535px"},title:"指静脉录入"},{default:d(()=>[T("div",br,[s.value?(E(),H(ie,{key:1},[l(U,{strong:""},{default:d(()=>[z("已采集指静脉信息：")]),_:1}),l(r,{type:"success",size:"large"},{default:d(()=>[z("已录入")]),_:1})],64)):(E(),H(ie,{key:0},[wr,xr,T("div",Cr,[T("div",$r,[i.value?(E(),G(N,{key:0,type:"line",percentage:Math.round(t.value/6*100),height:30,"border-radius":8,"fill-border-radius":4,status:"success","indicator-placement":"inside",class:"progress-bar",style:{"--n-color":"linear-gradient(90deg, #4CAF50 0%, #66BB6A 100%)","--n-rail-color":"#E8F5E9","--n-indicator-text-color":"white"}},{default:d(()=>[T("span",kr,ne(t.value)+"/6 次采集",1)]),_:1},8,["percentage"])):Z("",!0),i.value&&o.value?(E(),G(A,{key:1,type:"error",class:"mt-2"},{default:d(()=>[z(ne(o.value),1)]),_:1})):Z("",!0),l(U,{depth:"3",class:"mt-2"},{default:d(()=>[z(ne(P.value),1)]),_:1})]),l(F,{type:"primary",ghost:"",style:{width:"96px"},onClick:v},{default:d(()=>[z(" 开始注册 ")]),_:1})])],64)),T("div",Pr,[l(F,{disabled:!s.value,onClick:$,type:"error",ghost:""},{default:d(()=>[z(" 解绑 ")]),_:1},8,["disabled"]),l(F,{disabled:s.value,type:"primary",onClick:S},{default:d(()=>[z("同步指静脉")]),_:1},8,["disabled"]),l(F,{onClick:k},{default:d(()=>[z("返回")]),_:1})])])]),_:1})]),_:1},8,["show"])}}});const zr=Ze(Ir,[["__scopeId","data-v-fe528cfe"]]),Dr={class:"flex gap-4 justify-center mb-6"},Rr={class:"flex justify-end gap-3 px-4 py-3"},Nr=j({__name:"editAccountDialog",props:{currentUser:{}},emits:["submit","refresh"],setup(n,{expose:y,emit:h}){const m=_e(),s=C(),e=C(),u=C(),g=C(!1),a=C(!1),t=le(),i=C({}),o=C({name:"",role:"",deptID:null,password:"A123456p+",dictionaryManagementPermission:"",specifyCabinetID:[]}),P=C([]),c=C([]),_=[{label:"货柜组",value:"cabinetGroup"},{label:"指定货柜",value:"specifyCabinet"},{label:"按耗材取用权限",value:"byOutboundOrder"}],v=C([]),k=()=>{var w;if(x.value===!1){t.warning("未查询到主柜信息，请先设置主柜");return}if(Object.keys(i.value).length===0){t.warning("请先保存用户信息");return}(w=u==null?void 0:u.value)==null||w.open(i.value)},S=()=>{var w;if(x.value===!1){t.warning("未查询到主柜信息，请先设置主柜");return}if(Object.keys(i.value).length===0){t.warning("请先保存用户信息");return}(w=s==null?void 0:s.value)==null||w.open(i.value)},$=w=>{i.value&&(i.value.vein=w)},b=()=>{var R;if(x.value===!1){t.warning("未查询到主柜信息，请先设置主柜");return}const w=i.value;if(Object.keys(i.value).length===0){t.warning("请先保存用户信息");return}(R=e.value)==null||R.open(w,"registering")},D=()=>{o.value={name:"",role:"",deptID:null,password:"A123456p+",dictionaryManagementPermission:"",specifyCabinetID:[]}},N=async()=>{const w=[{field:"name",label:"用户名",type:"string"},{field:"role",label:"用户角色",type:"number"},{field:"deptID",label:"所属科室",type:"number"},{field:"dictionaryManagementPermission",label:"用户权限",type:"string"}];if(o.value.dictionaryManagementPermission==="specifyCabinet"&&o.value.specifyCabinetID.length===0){t.error('当选择"指定货柜"权限时，必须选择至少一个货柜');return}for(const{field:R,label:ee,type:ce}of w){const Q=o.value[R];if(!Q||typeof Q!==ce&&ce!=="array"){t.error(`请正确填写${ee}`);return}}try{const{data:R,error:ee}=await It({...o.value,dictionaryManagementPermission:o.value.dictionaryManagementPermission,status:SystemManagement.Status.Enable,type:""});if(ee)return;t.success(a.value?"用户修改成功":"用户添加成功"),h("refresh"),g.value=!1}catch(R){console.error("操作失败:",R),t.error(a.value?"用户修改失败":"用户添加失败")}};function A(w){w?(i.value=w,a.value=!0,o.value={id:w.id,name:w.name,password:w.password,deptID:w.deptID,specifyCabinetID:w.specifyCabinetID,role:w.role.id,dictionaryManagementPermission:w.dictionaryManagementPermission}):(a.value=!1,D()),g.value=!0}function U(){a.value=!1,g.value=!1,D()}const F=async()=>{try{const{data:w,error:R}=await zt();if(R){console.error("获取用户角色列表失败:",R);return}P.value=w||[]}catch(w){console.error("获取用户角色列表失败:",w)}},r=async()=>{try{const{data:w,error:R}=await Dt();if(R){console.error("获取用户部门列表失败:",R);return}c.value=w||[]}catch(w){console.error("获取用户部门列表失败:",w)}},f=async()=>{try{const{data:w,error:R}=await Rt();if(R){console.error("获取货柜列表失败:",R);return}w&&Array.isArray(w)&&(v.value=w||[])}catch(w){console.error("获取用货柜列表失败:",w)}};be(()=>o.value.dictionaryManagementPermission,w=>{w==="specifyCabinet"&&f()}),Ce(()=>{F(),r()}),y({open:A,close:U});const x=K(()=>m.devices.some(w=>w.type==="main"&&w.status==="online")),I=w=>{var R;if(i.value){if(i.value.nfc=w,w===""){i.value.nfc={};return}i.value.nfc={id:(R=i.value.nfc)==null?void 0:R.id,cardNumber:w,userId:i.value.id}}},W=w=>{i.value?i.value.face.face_img=w:t.warning("用户信息获取失败，请先保存用户信息")},J=w=>{i.value&&(i.value.fingerprint=w)},xe=()=>{g.value=!1,h("refresh")};return(w,R)=>{const ee=Je,ce=pe,Q=ae,ve=$e,ue=O,et=De,tt=oe,rt=ge;return E(),G(rt,{show:g.value,"onUpdate:show":R[6]||(R[6]=me=>g.value=me)},{default:d(()=>[T("div",null,[l(tt,{style:{width:"600px"},title:a.value?"编辑用户信息":"添加新用户","header-style":{padding:"20px 24px"},"content-style":{padding:"0 24px 20px"}},{footer:d(()=>[l(ee,{class:"!m-0"}),T("div",Rr,[l(ue,{size:"medium",onClick:xe},{default:d(()=>[z("返回")]),_:1}),l(ue,{size:"medium",type:"primary",onClick:N},{default:d(()=>[z(ne(a.value?"确认修改":"确认添加"),1)]),_:1})])]),default:d(()=>[l(et,{model:o.value,"label-placement":"left","label-width":"120"},{default:d(()=>{var me,Re,Ne,Me,Be,Ae,Te,Ue,Ee,Fe,We;return[l(ee,{class:"!mb-6"},{default:d(()=>[z("用户基本信息")]),_:1}),l(Q,{label:"用户名",required:""},{default:d(()=>[l(ce,{value:o.value.name,"onUpdate:value":R[0]||(R[0]=V=>o.value.name=V)},null,8,["value"])]),_:1}),l(Q,{label:"用户角色",required:""},{default:d(()=>[l(ve,{value:o.value.role,"onUpdate:value":R[1]||(R[1]=V=>o.value.role=V),options:P.value},null,8,["value","options"])]),_:1}),a.value?Z("",!0):(E(),G(Q,{key:0,label:"初始密码"},{default:d(()=>[l(ce,{value:o.value.password,"onUpdate:value":R[2]||(R[2]=V=>o.value.password=V),placeholder:"A123456p+",disabled:""},null,8,["value"])]),_:1})),l(Q,{label:"所属科室",required:""},{default:d(()=>[l(ve,{value:o.value.deptID,"onUpdate:value":R[3]||(R[3]=V=>o.value.deptID=V),options:c.value},null,8,["value","options"])]),_:1}),l(ee,{class:"!mb-6"},{default:d(()=>[z("耗材管理权限")]),_:1}),l(Q,{label:"用户权限",required:""},{default:d(()=>[l(ve,{value:o.value.dictionaryManagementPermission,"onUpdate:value":R[4]||(R[4]=V=>o.value.dictionaryManagementPermission=V),options:_},null,8,["value"])]),_:1}),o.value.dictionaryManagementPermission==="specifyCabinet"?(E(),G(Q,{key:1,label:"指定货柜"},{default:d(()=>[l(ve,{value:o.value.specifyCabinetID,"onUpdate:value":R[5]||(R[5]=V=>o.value.specifyCabinetID=V),options:v.value,multiple:""},null,8,["value","options"])]),_:1})):Z("",!0),a.value?(E(),H(ie,{key:2},[l(ee,{class:"!mb-6"},{default:d(()=>[z("生物信息录入")]),_:1}),T("div",Dr,[l(ue,{type:(Re=(me=i.value)==null?void 0:me.face)!=null&&Re.id?"primary":"tertiary",ghost:!((Me=(Ne=i.value)==null?void 0:Ne.face)!=null&&Me.id),onClick:k},{default:d(()=>[z(" 人脸录入 ")]),_:1},8,["type","ghost"]),l(ue,{type:(Be=i.value)!=null&&Be.vein.id?"primary":"tertiary",ghost:!((Te=(Ae=i.value)==null?void 0:Ae.vein)!=null&&Te.id),onClick:S},{default:d(()=>[z("指静脉录入")]),_:1},8,["type","ghost"]),l(ue,{type:(Ee=(Ue=i.value)==null?void 0:Ue.nfc)!=null&&Ee.cardNumber?"primary":"tertiary",ghost:!((We=(Fe=i.value)==null?void 0:Fe.nfc)!=null&&We.cardNumber),onClick:b},{default:d(()=>[z(" NFC卡录入 ")]),_:1},8,["type","ghost"])])],64)):Z("",!0)]}),_:1},8,["model"])]),_:1},8,["title"]),l(ir,{ref_key:"nfcDialogRef",ref:e,onSaveSuccess:I},null,512),l(yr,{ref_key:"faceDialogRef",ref:u,onSaveSuccess:W},null,512),l(zr,{ref_key:"fingerprintDialogRef",ref:s,"onUpdate:vein":$,onSaveSuccess:J},null,512)])]),_:1},8,["show"])}}}),Mr={class:"flex justify-end gap-3 px-4 py-3"},Br=j({__name:"editPassword",emits:["submit"],setup(n,{expose:y,emit:h}){const m=C(!1),s=C(null),e=le(),u=C({originalPassword:"",newPassword:"",confirmNewPassword:""}),g=async()=>{if(u.value.newPassword!==u.value.confirmNewPassword){e.error("两次输入的新密码不一致");return}const a=/[\u4e00-\u9fa5]/,t=/[^a-zA-Z0-9!@#$&*\\+]/;if(a.test(u.value.newPassword)||t.test(u.value.newPassword)){e.error("密码不能包含非法字符，特殊符号范围是 ! @ # $ & * +");return}try{let{error:i}=await Nt({userID:s.value.id,originalPassword:u.value.originalPassword,newPassword:u.value.newPassword,confirmNewPassword:u.value.confirmNewPassword});if(i)return;e.success("密码修改成功"),m.value=!1}catch(i){console.error("密码修改失败:",i),i instanceof Error?e.error("密码修改失败: "+i.message):e.error("密码修改失败: 未知错误")}};return y({open:a=>{s.value={id:a.id,username:a.username},u.value={originalPassword:"",newPassword:"",confirmNewPassword:""},m.value=!0}}),(a,t)=>{const i=Je;return E(),G(M(ge),{show:m.value,"onUpdate:show":t[4]||(t[4]=o=>m.value=o)},{default:d(()=>[l(M(oe),{style:{width:"500px"},title:"修改密码","header-style":{padding:"20px 24px"},"content-style":{padding:"0 24px 20px"}},{footer:d(()=>[l(i,{class:"!m-0"}),T("div",Mr,[l(M(O),{onClick:t[3]||(t[3]=o=>m.value=!1)},{default:d(()=>[z("取消")]),_:1}),l(M(O),{type:"primary",onClick:g},{default:d(()=>[z("确认修改")]),_:1})])]),default:d(()=>[l(M(De),{model:u.value,"label-placement":"left","label-width":"100"},{default:d(()=>[l(M(ae),{label:"用户名"},{default:d(()=>{var o;return[l(M(pe),{value:(o=s.value)==null?void 0:o.username,disabled:""},null,8,["value"])]}),_:1}),l(M(ae),{label:"旧密码",required:""},{default:d(()=>[l(M(pe),{value:u.value.originalPassword,"onUpdate:value":t[0]||(t[0]=o=>u.value.originalPassword=o),type:"password",placeholder:"请输入当前密码","show-password-on":"click"},null,8,["value"])]),_:1}),l(M(ae),{label:"新密码",required:""},{default:d(()=>[l(M(pe),{value:u.value.newPassword,"onUpdate:value":t[1]||(t[1]=o=>u.value.newPassword=o),type:"password",placeholder:"6-18位，含大小字母、数字、特殊符号!@#$&*+","show-password-on":"click"},null,8,["value"])]),_:1}),l(M(ae),{label:"确认密码",required:""},{default:d(()=>[l(M(pe),{value:u.value.confirmNewPassword,"onUpdate:value":t[2]||(t[2]=o=>u.value.confirmNewPassword=o),type:"password",placeholder:"请再次输入新密码","show-password-on":"click"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show"])}}}),Ar={class:"user-management p-4"},Tr={class:"flex justify-end;margin-left:30px"},Ur={class:"mb-4 flex justify-end gap-2"},Er=j({__name:"index",setup(n){const y=Mt(),h=le(),m=Xe();function s(r){y.info({title:"确认重置密码",content:`确定要重置用户 ${r.name} 的密码吗？`,positiveText:"确认重置",negativeText:"取消",onPositiveClick:async()=>{console.log("重置密码","targetUserId",r.id);try{const{data:f,error:x}=await Et({operatorUserId:Number(m.userInfo.userId),targetUserId:r.id});if(x)return;h.success("密码重置成功")}catch(f){h.error("密码重置失败: "+(f instanceof Error?f.message:"未知错误"))}}})}const e=C({name:null,dictionaryManagementPermission:null,page:1,pagesize:10}),u=[{label:"货柜组",value:"cabinetGroup"},{label:"按耗材取用权限",value:"specifyCabinet"},{label:"按耗材取用权限",value:"byOutboundOrder"}],g=[{title:"序号",key:"index",render:(r,f)=>f+1},{title:"用户名",key:"name"},{title:"用户角色",key:"role",render:r=>r.role.name},{title:"所属科室",key:"dept"},{title:"耗材权限",key:"dictionaryManagementPermission",render:r=>{const f={byOutboundOrder:"按出库单",cabinetGroup:"货柜组",specifyCabinet:"按耗材取用权限"},I=["byOutboundOrder","cabinetGroup","specifyCabinet"].includes(r.dictionaryManagementPermission)?f[r.dictionaryManagementPermission]:"未授权";return p("span",{},{default:()=>I})}},{title:"指静脉",key:"vein",render:r=>{var f;return p(fe,{type:(f=r.vein)!=null&&f.id?"success":"default"},{default:()=>r.vein&&r.vein.id!==null?"已录入":"未录入"})}},{title:"人脸",key:"face",render:r=>{var f;return p(fe,{type:(f=r.face)!=null&&f.id?"success":"default"},{default:()=>r.face&&r.face.id!==null?"已录入":"未录入"})}},{title:"NFC",key:"nfc",render:r=>{var f;return p(fe,{type:(f=r.nfc)!=null&&f.id?"success":"default"},{default:()=>r.nfc&&r.nfc.id!==null?"已录入":"未录入"})}},{title:"操作",key:"actions",render:r=>p("div",{class:"flex gap-2"},[p(O,{size:"small",onClick:()=>b(r)},"编辑"),p(O,{size:"small",onClick:()=>N(r)},"修改密码"),p(O,{size:"small",onClick:()=>s(r)},"重置密码"),r.id!==1&&p(O,{size:"small",type:"error",onClick:()=>P(r)},"删除")].filter(Boolean))}],a=C([]),t=async()=>{var r;try{const f=await Bt({name:e.value.name||void 0,dictionaryManagementPermission:e.value.dictionaryManagementPermission||void 0,page:e.value.page,pagesize:e.value.pagesize});if(f.error)return;a.value=(((r=f.data)==null?void 0:r.items)||[]).map(x=>{var I;return{id:x.id,name:x.name,mobile:x.mobile,status:x.status==="disabled"?"已禁用":"正常",role:x.role,dept:((I=x.dept)==null?void 0:I.name)||"",deptID:x.deptID||"",dictionaryManagementPermission:x.dictionaryManagementPermission,specifyCabinetID:x.specifyCabinetID,vein:x.vein,face:x.face,nfc:x.nfc}})}catch(f){console.error("用户数据加载失败:",f),h.error("用户数据加载失败")}};Ce(()=>{t()});const i=C([]),o=async()=>{try{const{error:r,data:f}=await At();if(r)return;Array.isArray(f)&&f.length>0&&(i.value=f.map(x=>({label:x.label,value:x.label})))}catch(r){console.error("获取用户下拉数据失败:",r),h.error("获取用户下拉数据失败")}};Ce(()=>{t(),o()});async function P(r){y.error({title:"删除用户确认",content:`确定要删除用户「${r.name}」吗？此操作不可恢复！`,positiveText:"确认删除",negativeText:"取消",onPositiveClick:async()=>{try{const{error:f,data:x}=await Tt({id:r.id});if(f)return;await t(),await o(),h.success((x==null?void 0:x.message)||"用户删除成功")}catch(f){console.error("删除失败:",f),h.error("用户删除失败: "+(f instanceof Error?f.message:"未知错误"))}}})}function c(){console.log("查询参数:",e.value),t()}function _(){e.value={name:null,dictionaryManagementPermission:null,page:1,pagesize:10},t()}const v=C(),k=()=>{var r;(r=v.value)==null||r.open()},S=r=>{if(r.id){const f=a.value.findIndex(x=>x.id===r.id);f>-1&&(a.value[f]={...a.value[f],...r,dictionaryManagementPermission:r.dictionaryManagementPermissionType==="已授权"})}else a.value=[...a.value,{id:Date.now(),...r,dictionaryManagementPermission:r.dictionaryManagementPermissionType==="已授权",vein:r.biometrics.vein,face:r.biometrics.face,nfc:r.biometrics.nfc}]},$=()=>console.log("同步SPD人员信息"),b=r=>{var f;console.log("变价",r),(f=v.value)==null||f.open(r)},D=C(),N=r=>{var f;(f=D.value)==null||f.open({id:r.id,username:r.name})},A=r=>{console.log("提交密码修改:",r)},U=async()=>{try{const r=h.loading("正在刷新数据...",{duration:0});await t(),await o(),r.destroy(),h.success("数据刷新成功")}catch(r){console.error("刷新失败:",r),h.error("数据刷新失败")}},F=()=>{y.warning({title:"清空用户确认",content:"确定要清空所有用户数据吗？此操作不可恢复！",positiveText:"确认清空",negativeText:"取消",onPositiveClick:async()=>{try{const{data:r,error:f}=await Ut();if(f)return;await t();const x=r.data||"用户数据清空成功";h.success(x)}catch(r){console.error("清空失败:",r);let f="用户数据清空失败: 未知错误";r instanceof Error&&(f="用户数据清空失败: "+r.message),h.error(f)}}})};return(r,f)=>{const x=oe;return E(),H("div",Ar,[l(x,{class:"mb-4"},{default:d(()=>[l(M(De),{model:e.value,"label-placement":"left"},{default:d(()=>[l(M(Ke),{cols:5,"x-gap":3},{default:d(()=>[l(M(ye),{span:1},{default:d(()=>[l(M(ae),{label:"用户名"},{default:d(()=>[l(M($e),{value:e.value.name,"onUpdate:value":f[0]||(f[0]=I=>e.value.name=I),options:i.value,filterable:"",placeholder:"请选择用户",clearable:"",style:{width:"180px"}},null,8,["value","options"])]),_:1})]),_:1}),l(M(ye),{span:1},{default:d(()=>[l(M(ae),{label:"耗材权限"},{default:d(()=>[l(M($e),{value:e.value.dictionaryManagementPermission,"onUpdate:value":f[1]||(f[1]=I=>e.value.dictionaryManagementPermission=I),options:u,clearable:"",style:{width:"180px"}},null,8,["value"])]),_:1})]),_:1}),l(M(ye),{span:1},{default:d(()=>[T("div",Tr,[l(M(O),{type:"primary",onClick:c},{default:d(()=>[z("查询")]),_:1}),l(M(O),{type:"default",class:"ml-2",onClick:_},{default:d(()=>[z("重置")]),_:1})])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),T("div",Ur,[l(M(O),{onClick:U},{default:d(()=>[z("刷新")]),_:1}),l(M(O),{type:"primary",onClick:k},{default:d(()=>[z("添加用户")]),_:1}),l(M(O),{type:"info",onClick:$},{default:d(()=>[z("同步SPD人员信息")]),_:1}),l(M(O),{type:"warning",onClick:F},{default:d(()=>[z("清空用户")]),_:1})]),l(M(Ot),{columns:g,data:a.value,"row-key":I=>I.id},null,8,["data","row-key"]),l(Nr,{ref_key:"createDialog",ref:v,onSubmit:S,onRefresh:U},null,512),l(Br,{ref_key:"passwordDialog",ref:D,onSubmit:A},null,512)])}}});const ia=Ze(Er,[["__scopeId","data-v-f02eacd5"]]);export{ia as default};
