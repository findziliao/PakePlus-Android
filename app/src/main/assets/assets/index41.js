import{T as q}from"./table-paginate.js";import{p as A}from"./table-paginate2.js";import{n as F,o as E}from"./record.js";import{d as M,r as u,k as H,an as U,aq as K,ar as d,aw as s,as as r,ap as l,h as b,a$ as L,aF as Y,o as G,a7 as v,bK as g,ao as J,ax as h,bS as Q,aC as W,aD as X}from"./index.js";import{N as z}from"./DataTable.js";import{a as O}from"./Dropdown.js";import{_ as Z}from"./DatePicker.js";import{_ as ee}from"./Form.js";import{_ as te}from"./Input.js";import{_ as ae}from"./_plugin-vue_export-helper.js";import"./format-length.js";import"./Checkbox.js";import"./use-merged-state.js";import"./RadioGroup.js";import"./get-slot.js";import"./FocusDetector.js";import"./next-frame-once.js";import"./get.js";import"./ChevronRight.js";import"./use-compitable.js";import"./Icon.js";import"./TimePicker.js";const se=l("div",{class:"flex justify-between items-center w-full"},[l("h2",{class:"text-xl font-bold"},"取用归还详情")],-1),le=M({__name:"dialog",props:{visible:{type:Boolean},rowData:{}},emits:["update:visible","submit"],setup(_,{emit:a}){const f=_,m=u({items:[]}),k=async c=>{var p;try{const o=await F({ID:c});if(o.error){m.value.items=[];return}m.value.items=((p=o.data)==null?void 0:p.items)||[]}catch(o){console.error("获取详情失败:",o),m.value.items=[]}},n=[{title:"耗材子编码",key:"code"},{title:"耗材名称",key:"name"},{title:"规格型号",key:"spec"},{title:"生产厂家",key:"manufacturer"},{title:"品牌",key:"brand"},{title:"单位",key:"unit"},{title:"唯一码",key:"rfid"},{title:"批号",key:"batch"},{title:"耗材数量",key:"number"},{title:"操作人",key:"user.name"},{title:"操作类型",key:"operationType",render:c=>b("span",{take:"取用",return:"归还"}[c.operationType])},{title:"操作时间",key:"operationDate"}];return H(()=>f.visible,(c,p)=>{if(c&&!p&&f.rowData){const o=Number(f.rowData.id);k(o)}else c||(m.value.items=[])}),(c,p)=>{const o=L,w=Y;return U(),K(w,{show:c.visible,"onUpdate:show":p[0]||(p[0]=D=>a("update:visible",D)),preset:"card",closable:"",style:{width:"80%",height:"45rem",margin:"0 auto"}},{header:d(()=>[se]),default:d(()=>[s(o,null,{default:d(()=>[s(r(z),{columns:n,data:m.value.items,style:{"margin-top":"20px"},"max-height":415},null,8,["data"])]),_:1})]),_:1},8,["show"])}}});const C=_=>(W("data-v-1edfb6ac"),_=_(),X(),_),oe={class:"query-area"},re={class:"grid grid-cols-5 gap-6"},ne={class:"flex items-center"},ie=C(()=>l("label",{class:"mr-2",style:{width:"4rem"}},"确认类型",-1)),ue={class:"flex items-center"},ce=C(()=>l("label",{class:"mr-2",style:{width:"4rem"}},"确认人",-1)),pe={class:"flex items-center"},de={class:"flex items-center"},me=C(()=>l("label",{class:"mr-2",style:{width:"4rem"}},"确认日期",-1)),ve={class:"flex items-center ml-4"},_e={class:"flex justify-end mt-18"},fe={class:"mt-2"},ye={class:"mt-4"},he=M({__name:"index",setup(_){const a=u({confirmType:null,userID:null,date:null}),f=u([{label:"有异议",value:"true"},{label:"确认无误",value:"false"}]),m=u([]),k=async()=>{try{const e=await Q();e.data&&Array.isArray(e.data)&&(m.value=e.data)}catch(e){console.error("获取用户数据失败:",e)}};G(async()=>{await k(),y()});const n=u({totalItems:100,pageSize:A,currentPage:1}),c=e=>{n.value.currentPage=e,y()},p=u([{title:"取用日期",key:"takeDate"},{title:"取用数量",key:"takeNum"},{title:"确认时间",key:"confirmDate"},{title:"确认类型",key:"confirmType",render:e=>b("span",{true:"有异议",false:"确认无误"}[e.confirmType])},{title:"说明",key:"description",render:e=>b(v,{type:"info",size:"small",onClick:()=>V(e)},"查看")},{title:"确认人员",key:"user.name"},{title:"操作",key:"actions",render:e=>b(v,{type:"primary",onClick:()=>$(e)},"详情")}]),o=u([]),w=e=>e==="true"?!0:e==="false"?!1:null,D=e=>e.toString(),y=async()=>{try{const e=await E({userID:a.value.userID,confirmType:w(a.value.confirmType),date:a.value.date?[g(a.value.date[0]).format("YYYY-MM-DD"),g(a.value.date[1]).format("YYYY-MM-DD")]:null,page:n.value.currentPage,pagesize:n.value.pageSize});if(e.error){o.value=[],n.value.totalItems=0;return}o.value=e.data.items.map(t=>({...t,confirmType:D(t.confirmType)})),n.value.totalItems=e.data.total}catch(e){console.error("获取取用归还确认记录列表失败:",e),o.value=[],n.value.totalItems=0}},B=()=>{a.value={confirmType:null,userID:null,date:null},y()},N=()=>{const e=g().startOf("day");a.value.date=[e.valueOf(),e.valueOf()]},P=()=>{const e=g().subtract(1,"day").startOf("day");a.value.date=[e.valueOf(),e.valueOf()]},R=e=>{const t=new Date().setHours(0,0,0,0);return e>t},x=u(!1),T=u(!1),I=u(""),S=u({}),$=e=>{S.value=e,x.value=!0},V=e=>{I.value=e.description||"这是一个模拟的校正说明内容。用户在此次操作中进行了相关的确认和校正，具体包括物品的核对、数量的确认以及相关异议的处理。本次操作已按照标准流程执行完毕。",T.value=!0},j=()=>{console.log("执行表格刷新逻辑"),y()};return(e,t)=>(U(),J("div",null,[l("div",oe,[s(r(ee),{model:a.value,"label-width":100,"label-placement":"left",inline:""},{default:d(()=>[l("div",re,[l("div",ne,[ie,s(r(O),{value:a.value.confirmType,"onUpdate:value":t[0]||(t[0]=i=>a.value.confirmType=i),options:f.value,placeholder:"请选择",style:{width:"180px"},clearable:""},null,8,["value","options"])]),l("div",ue,[ce,s(r(O),{value:a.value.userID,"onUpdate:value":t[1]||(t[1]=i=>a.value.userID=i),options:m.value,placeholder:"请选择",style:{width:"180px"},clearable:""},null,8,["value","options"])]),l("div",pe,[l("div",de,[me,s(r(Z),{value:a.value.date,"onUpdate:value":t[2]||(t[2]=i=>a.value.date=i),type:"daterange",placeholder:"请选择日期范围","disabled-date":R,style:{width:"265px"}},null,8,["value"])]),l("div",ve,[s(r(v),{type:"primary",style:{"margin-left":"10px"},onClick:N},{default:d(()=>[h("今日")]),_:1}),s(r(v),{type:"primary",style:{"margin-left":"5px"},onClick:P},{default:d(()=>[h("昨日")]),_:1})])])]),l("div",_e,[s(r(v),{type:"primary",onClick:y},{default:d(()=>[h("查询")]),_:1}),s(r(v),{type:"primary",style:{"margin-left":"8px"},onClick:B},{default:d(()=>[h("重置")]),_:1})])]),_:1},8,["model"])]),l("div",fe,[s(r(v),{type:"primary",onClick:j},{default:d(()=>[h("刷新")]),_:1})]),l("div",ye,[s(r(z),{columns:p.value,data:o.value},null,8,["columns","data"])]),s(q,{total:n.value.totalItems,"page-size":n.value.pageSize,"current-page":n.value.currentPage,onPageChange:c},null,8,["total","page-size","current-page"]),s(le,{visible:x.value,"onUpdate:visible":t[3]||(t[3]=i=>x.value=i),rowData:S.value},null,8,["visible","rowData"]),s(r(Y),{show:T.value,"onUpdate:show":t[5]||(t[5]=i=>T.value=i),preset:"card",title:"校正说明",style:{width:"600px"}},{default:d(()=>[s(r(te),{value:I.value,"onUpdate:value":t[4]||(t[4]=i=>I.value=i),rows:8,readonly:"",placeholder:"暂无说明内容"},null,8,["value"])]),_:1},8,["show"])]))}});const qe=ae(he,[["__scopeId","data-v-1edfb6ac"]]);export{qe as default};
